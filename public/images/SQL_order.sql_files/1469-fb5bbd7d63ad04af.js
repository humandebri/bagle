!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="8cc73b72-6f94-4007-9b45-8944ab9a7bfc",e._sentryDebugIdIdentifier="sentry-dbid-8cc73b72-6f94-4007-9b45-8944ab9a7bfc")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1469],{4027:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(47370).A)("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]])},4576:e=>{var t="\ud800-\udfff",a="\\u2700-\\u27bf",n="a-z\\xdf-\\xf6\\xf8-\\xff",s="A-Z\\xc0-\\xd6\\xd8-\\xde",r="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",l="['’]",i="["+r+"]",o="["+n+"]",d="[^"+t+r+"\\d+"+a+n+s+"]",c="(?:\ud83c[\udde6-\uddff]){2}",u="[\ud800-\udbff][\udc00-\udfff]",p="["+s+"]",m="(?:"+o+"|"+d+")",f="(?:"+p+"|"+d+")",x="(?:"+l+"(?:d|ll|m|re|s|t|ve))?",h="(?:"+l+"(?:D|LL|M|RE|S|T|VE))?",y="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\ud83c[\udffb-\udfff])?",g="[\\ufe0e\\ufe0f]?",v="(?:\\u200d(?:"+["[^"+t+"]",c,u].join("|")+")"+g+y+")*",j="(?:"+["["+a+"]",c,u].join("|")+")"+(g+y+v),b=RegExp([p+"?"+o+"+"+x+"(?="+[i,p,"$"].join("|")+")",f+"+"+h+"(?="+[i,p+m,"$"].join("|")+")",p+"?"+m+"+"+x,p+"+"+h,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])","\\d+",j].join("|"),"g");e.exports=function(e){return e.match(b)||[]}},6065:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(47370).A)("CircleStop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{width:"6",height:"6",x:"9",y:"9",key:"1wrtvo"}]])},6897:(e,t,a)=>{"use strict";a.d(t,{c3:()=>l,e9:()=>o});var n=a(17702),s=a(3807),r=a(51696);let l=100;async function i(e,t){let{projectRef:a,cursor:n,sort:r,name:i}=e;if(void 0===a)throw Error("projectRef is required");let{data:o,error:d}=await (0,s.Jt)("/platform/projects/{ref}/content/folders",{params:{path:{ref:a},query:{type:"sql",cursor:n,limit:l.toString(),sort_by:r,sort_order:"name"===r?"asc":"desc",name:i,visibility:"user"}},signal:t});return d&&(0,s.H4)(d),{...o.data,cursor:o.cursor}}let o=function(e){let{projectRef:t,name:a,sort:s}=e,{enabled:l=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.q)(r.M.folders(t,{name:a,sort:s}),e=>{let{signal:n,pageParam:r}=e;return i({projectRef:t,cursor:r,name:a,sort:s},n)},{enabled:l&&void 0!==t,getNextPageParam:e=>e.cursor,...o})}},10670:(e,t,a)=>{"use strict";a.d(t,{$:()=>P});var n=a(80263),s=a(7086),r=a(82489),l=a(96591),i=a(2),o=a(88601),d=a(95903),c=a(36085),u=a(10170),p=a(3732);function m(e){let{hideTabs:t}=e,{showSidebar:a,setShowSidebar:s}=(0,u.qM)();return(0,n.jsxs)(p.m_,{"data-sentry-element":"Tooltip","data-sentry-component":"CollapseButton","data-sentry-source-file":"CollapseButton.tsx",children:[(0,n.jsx)(p.k$,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"CollapseButton.tsx",children:(0,n.jsx)("button",{className:(0,i.cn)("flex items-center justify-center w-10 h-10 hover:bg-surface-100 shrink-0",!t&&"border-b border-b-default"),onClick:()=>s(!a),children:a?(0,n.jsx)(d.A,{size:16,strokeWidth:1.5,className:"text-foreground-lighter hover:text-foreground-light"}):(0,n.jsx)(c.A,{size:16,strokeWidth:1.5,className:"text-foreground-lighter hover:text-foreground-light"})})}),(0,n.jsxs)(p.ZI,{side:"bottom","data-sentry-element":"TooltipContent","data-sentry-source-file":"CollapseButton.tsx",children:["Collapse"," sidebar"]})]})}var f=a(26779),x=a(47625),h=a(88712),y=a(37055),g=a(97318),v=a(23278),j=a(52385),b=a(79175),S=a(93479),w=a(62517),N=a(87604),M=a(53239),q=a(58604);let C=e=>{var t;let{tab:a,index:s,openTabs:l,onClose:o}=e,d=(0,j.useRouter)(),{ref:c}=(0,r.g)(),u=d.query.schema||"public",{attributes:p,listeners:m,setNodeRef:f,transform:g,transition:w,isDragging:C}=(0,x.gl)({id:a.id}),E={transform:N.Ks.Transform.toString(g),transition:w,zIndex:+!!C},k=(0,M.useMemo)(()=>"r"===a.type&&l.filter(e=>"r"===e.type).some(e=>{var t;return(null==(t=e.metadata)?void 0:t.schema)!==u}),[l,u,a.type]);return(0,n.jsxs)(y.P.div,{ref:f,style:E,...p,layoutId:a.id,transition:{duration:.045},animate:{opacity:+!C},className:(0,i.cn)("flex items-center h-10 first-of-type:border-l"),"data-sentry-element":"unknown","data-sentry-component":"SortableTab","data-sentry-source-file":"SortableTab.tsx",children:[(0,n.jsxs)(S.Xi,{value:a.id,onDoubleClick:()=>(0,b.UH)(c,a.id),className:(0,i.cn)("flex items-center gap-2 pl-3 pr-2.5 text-xs","bg-dash-sidebar/50 dark:bg-surface-100/50","data-[state=active]:bg-dash-sidebar dark:data-[state=active]:bg-surface-100","border-b border-default","data-[state=active]:border-b-background-dash-sidebar dark:data-[state=active]:border-b-background-surface-100","relative group h-full","hover:bg-surface-300 dark:hover:bg-surface-100",a.isPreview&&"italic font-light"),...m,"data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"SortableTab.tsx",children:[(0,n.jsx)(q.L,{type:a.type,"data-sentry-element":"EntityTypeIcon","data-sentry-source-file":"SortableTab.tsx"}),(0,n.jsxs)("div",{className:"flex items-center gap-0",children:[(0,n.jsx)(h.N,{mode:"popLayout",initial:!0,"data-sentry-element":"AnimatePresence","data-sentry-source-file":"SortableTab.tsx",children:k&&(0,n.jsxs)(y.P.span,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},transition:{duration:.15},className:"text-foreground-muted group-data-[state=active]:text-foreground-lighter",children:[null==a||null==(t=a.metadata)?void 0:t.schema,"."]})}),(0,n.jsx)("span",{children:a.label||"Untitled"})]}),(0,n.jsx)("span",{role:"button",onClick:e=>{e.preventDefault(),e.stopPropagation()},className:"p-0.5 ml-1 opacity-0 group-hover:opacity-100 hover:bg-200 rounded-sm cursor-pointer",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onPointerDown:e=>{e.preventDefault(),e.stopPropagation(),o(a.id)},children:(0,n.jsx)(v.A,{size:12,className:"text-foreground-light","data-sentry-element":"X","data-sentry-source-file":"SortableTab.tsx"})}),(0,n.jsx)("div",{className:"absolute w-full top-0 left-0 right-0 h-px bg-foreground opacity-0 group-data-[state=active]:opacity-100"})]}),s<l.length&&(0,n.jsx)("div",{role:"separator",className:"h-full w-px bg-border"},"separator-".concat(a.id))]})};var E=a(12532);let k=e=>{let{tab:t}=e,{ref:a}=(0,r.g)(),s=(0,b.IT)(a),l=(0,E.s)(s).tabsMap[t];return l?(0,n.jsxs)(y.P.div,{layoutId:t,transition:{duration:.045},animate:{opacity:.7},className:"flex relative items-center gap-2 px-3 text-xs bg-dash-sidebar dark:bg-surface-100 shadow-lg rounded-sm h-10","data-sentry-element":"unknown","data-sentry-component":"TabPreview","data-sentry-source-file":"TabPreview.tsx",children:[(0,n.jsx)(q.L,{type:l.type,"data-sentry-element":"EntityTypeIcon","data-sentry-source-file":"TabPreview.tsx"}),(0,n.jsx)("span",{children:l.label||"Untitled"}),(0,n.jsx)("div",{className:"absolute w-full top-0 left-0 right-0 h-px bg-foreground-muted"})]}):null},L=()=>{var e;let{ref:t}=(0,r.g)(),a=(0,j.useRouter)(),s=(0,u.qM)(),l=(0,w.l)(),o=(0,b.ZG)(t),d=(0,f.FR)((0,f.MS)(f.AN,{activationConstraint:{distance:1}})),c=o.openTabs.map(e=>o.tabsMap[e]).filter(e=>void 0!==e),p=a.asPath.includes("/new"),N=l?c.filter(e=>{var t;return null==(t=b.qm[l])?void 0:t.includes(e.type)}):[],M=e=>{(0,b.cO)({ref:t,id:e,router:a,editor:l,onClearDashboardHistory:()=>{t&&l&&s.setDashboardHistory(t,"table"===l?"editor":l,void 0)}})};return(0,n.jsxs)(f.Mp,{sensors:d,onDragEnd:e=>{let{active:n,over:s}=e;if(!s||n.id===s.id)return;let r=o.openTabs.indexOf(n.id.toString()),l=o.openTabs.indexOf(s.id.toString());r!==l&&(0,b.Lz)(t,r,l,n.id.toString(),a)},"data-sentry-element":"DndContext","data-sentry-component":"EditorTabs","data-sentry-source-file":"Tabs.tsx",children:[(0,n.jsxs)(S.tU,{className:"w-full flex",value:p?"new":null!=(e=o.activeTab)?e:void 0,onValueChange:e=>{(0,b.I1)(t,e,a)},"data-sentry-element":"Tabs_Shadcn_","data-sentry-source-file":"Tabs.tsx",children:[(0,n.jsx)(m,{hideTabs:!1,"data-sentry-element":"CollapseButton","data-sentry-source-file":"Tabs.tsx"}),(0,n.jsxs)(S.j7,{className:"bg-surface-200 dark:bg-alternative rounded-b-none gap-0 h-10 flex items-center w-full z-[1] border-none overflow-clip overflow-x-auto ","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"Tabs.tsx",children:[(0,n.jsx)(x.gB,{items:N.map(e=>e.id),strategy:x.m$,"data-sentry-element":"SortableContext","data-sentry-source-file":"Tabs.tsx",children:N.map((e,t)=>(0,n.jsx)(C,{tab:e,index:t,openTabs:c,onClose:()=>M(e.id)},e.id))}),p&&(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(S.Xi,{value:"new",className:(0,i.cn)("flex items-center gap-2 px-3 text-xs","bg-dash-sidebar/50 dark:bg-surface-100/50","data-[state=active]:bg-dash-sidebar dark:data-[state=active]:bg-surface-100","relative group h-full border-t-2 !border-b-0","hover:bg-surface-300 dark:hover:bg-surface-100"),children:[(0,n.jsx)(g.A,{size:16,strokeWidth:1.5,className:"text-foreground-lighter"}),(0,n.jsx)("div",{className:"flex items-center gap-0",children:(0,n.jsx)("span",{children:"New"})}),(0,n.jsx)("span",{role:"button",onClick:e=>{e.preventDefault(),e.stopPropagation()},className:"ml-1 opacity-0 group-hover:opacity-100 hover:bg-200 rounded-sm cursor-pointer",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onPointerDown:e=>{e.preventDefault(),e.stopPropagation(),M("new")},children:(0,n.jsx)(v.A,{size:12,className:"text-foreground-light"})})," ",(0,n.jsx)("div",{className:"absolute w-full -bottom-[1px] left-0 right-0 h-px bg-dash-sidebar dark:bg-surface-100 opacity-0 group-data-[state=active]:opacity-100"})]})}),(0,n.jsx)(h.N,{initial:!1,"data-sentry-element":"AnimatePresence","data-sentry-source-file":"Tabs.tsx",children:!p&&(0,n.jsx)(y.P.button,{className:"flex items-center justify-center w-10 h-10 hover:bg-surface-100 shrink-0 border-b",onClick:()=>a.push("/project/".concat(a.query.ref,"/").concat("table"===l?"editor":"sql","/new?skip=true")),initial:{opacity:0,scale:.8,x:-10},animate:{opacity:1,scale:1,x:0},transition:{duration:.2},children:(0,n.jsx)(g.A,{size:16,strokeWidth:1.5,className:"text-foreground-lighter hover:text-foreground-light"})})}),(0,n.jsx)("div",{className:"grow h-full border-b pr-6"})]})]}),(0,n.jsx)(f.Hd,{dropAnimation:null,"data-sentry-element":"DragOverlay","data-sentry-source-file":"Tabs.tsx",children:o.activeTab?(0,n.jsx)(k,{tab:o.activeTab}):null})]})},P=e=>{let{children:t,title:a,product:d,...c}=e,{ref:u}=(0,r.g)(),p=(0,s.usePathname)(),f=(0,w.l)(),x=(0,l.mh)(),h=(0,l.Uq)(),y=p==="/project/".concat(u,"/editor")||p==="/project/".concat(u,"/sql");return(0,n.jsx)(o.S,{resizableSidebar:!0,title:a,product:d,...c,"data-sentry-element":"ProjectLayoutWithAuth","data-sentry-component":"EditorBaseLayout","data-sentry-source-file":"EditorBaseLayout.tsx",children:(0,n.jsxs)("div",{className:"flex flex-col h-full",children:["table"===f&&x||"sql"===f&&h?(0,n.jsx)("div",{className:(0,i.cn)("h-10 flex items-center",y?"bg-surface-100":"bg-surface-200 dark:bg-alternative"),children:y?(0,n.jsx)(m,{hideTabs:y}):(0,n.jsx)(L,{})}):null,(0,n.jsx)("div",{className:"h-full",children:t})]})})}},15196:e=>{var t=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;e.exports=function(e){return e.match(t)||[]}},27321:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(47370).A)("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]])},34398:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(80263),s=a(53239),r=a(81250);let l=(0,s.memo)(function(){return(0,n.jsx)("div",{className:"px-4 flex flex-col gap-0",children:[{width:"w-40",opacity:"opacity-100"},{width:"w-32",opacity:"opacity-100"},{width:"w-20",opacity:"opacity-75"},{width:"w-40",opacity:"opacity-50"},{width:"w-20",opacity:"opacity-25"}].map((e,t)=>(0,n.jsxs)("div",{className:"flex flex-row h-6 items-center gap-3 ".concat(e.opacity),children:[(0,n.jsx)(r.E,{className:"h-4 w-5"}),(0,n.jsx)(r.E,{className:"h-4 ".concat(e.width)})]},t))})})},43171:e=>{e.exports=function(e,t,a,n){var s=-1,r=null==e?0:e.length;for(n&&r&&(a=e[++s]);++s<r;)a=t(a,e[s],s,e);return a}},45740:(e,t,a)=>{"use strict";a.d(t,{I:()=>o});var n=a(17702),s=a(3807),r=a(51696),l=a(6897);async function i(e,t){let{projectRef:a,cursor:n,visibility:r,favorite:i,name:o,sort:d}=e;if(void 0===a)throw Error("projectRef is required for getSqlSnippets");let{data:c,error:u}=await (0,s.Jt)("/platform/projects/{ref}/content",{params:{path:{ref:a},query:{type:"sql",cursor:n,visibility:r,favorite:i,name:o,limit:l.c3.toString(),sort_by:d,sort_order:"name"===d?"asc":"desc"}},signal:t});if(u)throw u;return{cursor:c.cursor,contents:c.data}}let o=function(e){let{projectRef:t,sort:a,name:s,visibility:l,favorite:o}=e,{enabled:d=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.q)(r.M.sqlSnippets(t,{sort:a,name:s,visibility:l,favorite:o}),e=>{let{signal:n,pageParam:r}=e;return i({projectRef:t,cursor:r,sort:a,name:s,visibility:l,favorite:o},n)},{enabled:d&&void 0!==t,getNextPageParam:e=>e.cursor,...c})}},46312:(e,t,a)=>{"use strict";a.d(t,{K:()=>i,Q:()=>l});var n=a(56947),s=a(3807),r=a(51696);async function l(e,t){let{projectRef:a,id:n}=e;if(void 0===a)throw Error("projectRef is required");if(void 0===n)throw Error("Content ID is required");let{data:r,error:l}=await (0,s.Jt)("/platform/projects/{ref}/content/item/{id}",{params:{path:{ref:a,id:n}},signal:t});if(l)throw(0,s.H4)(l);return r}let i=function(e){let{projectRef:t,id:a}=e,{enabled:s=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.I)(r.M.resource(t,a),e=>{let{signal:n}=e;return l({projectRef:t,id:a},n)},{enabled:s&&void 0!==t&&void 0!==a,...i})}},52793:(e,t,a)=>{e.exports=a(55950)(function(e,t,a){return e+(a?"_":"")+t.toLowerCase()})},53689:(e,t,a)=>{var n=a(57658),s=a(15743),r=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,l=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");e.exports=function(e){return(e=s(e))&&e.replace(r,n).replace(l,"")}},55950:(e,t,a)=>{var n=a(43171),s=a(53689),r=a(76316),l=RegExp("['’]","g");e.exports=function(e){return function(t){return n(r(s(t).replace(l,"")),e,"")}}},56189:e=>{e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},57658:(e,t,a)=>{e.exports=a(56189)({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"})},58149:(e,t,a)=>{"use strict";a.d(t,{Z:()=>tt});var n=a(80263),s=a(60045),r=a(56404),l=a(23278),i=a(97318),o=a(99951),d=a(70813),c=a(52385),u=a(53239),p=a(73969),m=a(82489),f=a(65904),x=a(89756),h=a(83634),y=a(58897),g=a(11649),v=a(10170),j=a(45248),b=a(3732),S=a(33656),w=a(16601),N=a(63505);let M=["templates","quickstarts"];function q(){let{ref:e}=(0,m.g)(),t=(0,c.useRouter)();return(0,n.jsx)("div",{"data-sentry-component":"SqlEditorMenuStaticLinks","data-sentry-source-file":"SqlEditorMenuStaticLinks.tsx",children:M.map(a=>{let s=t.asPath==="/project/".concat(e,"/sql/").concat(a);return(0,n.jsx)(N.ag,{title:"Templates",isActive:s,isOpened:!1,href:"/project/".concat(e,"/sql/").concat(a),className:"capitalize",children:a},a)})})}var C=a(11352),E=a(63320),k=a.n(E),L=a(94330),P=a(56947),A=a(3807),_=a(51696);async function Q(e,t){let{projectRef:a,cumulative:n,type:s,name:r}=e;if(void 0===a)throw Error("projectRef is required");let{data:l,error:i}=await (0,A.Jt)("/platform/projects/{ref}/content/count",{params:{path:{ref:a},query:{...s&&{type:s},...r&&{name:r}}},...n?{}:{headers:{Version:"2"}},signal:t});if(i)throw(0,A.H4)(i);return l}let I=function(e){let{projectRef:t,cumulative:a,type:n,name:s}=e,{enabled:r=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,P.I)(_.M.count(t,n,{cumulative:a,name:s}),e=>{let{signal:r}=e;return Q({projectRef:t,cumulative:a,type:n,name:s},r)},{enabled:r&&void 0!==t,...l})};var D=a(17702);async function T(e,t){let{projectRef:a,type:n,name:s,limit:r=10,sort:l,cursor:i}=e;if(void 0===a)throw Error("projectRef is required for getContent");let{data:o,error:d}=await (0,A.Jt)("/platform/projects/{ref}/content",{params:{path:{ref:a},query:{type:n,name:s,sort_by:l,limit:r.toString(),cursor:i}},signal:t});return d&&(0,A.H4)(d),{cursor:o.cursor,content:o.data}}let R=function(e){let{projectRef:t,type:a,name:n,limit:s,sort:r}=e,{enabled:l=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,D.q)(_.M.infiniteList(t,{type:a,name:n,limit:s,sort:r}),e=>{let{signal:l,pageParam:i}=e;return T({projectRef:t,type:a,name:n,limit:s,sort:r,cursor:i},l)},{enabled:l&&void 0!==t,getNextPageParam:e=>e.cursor,...i})};var z=a(6897),O=a(2),F=a(52491),B=a(62719);let W=e=>{var t;let{search:a}=e,{ref:s}=(0,m.g)(),{data:r,isLoading:l,hasNextPage:i,fetchNextPage:o,isFetchingNextPage:d}=R({projectRef:s,type:"sql",limit:z.c3,name:0===a.length?void 0:a},{keepPreviousData:!0}),{data:c}=I({projectRef:s,cumulative:!0,type:"sql",name:a},{keepPreviousData:!0}),p=null!=(t=null==c?void 0:c.count)?t:0,f=(0,u.useMemo)(()=>null==r?void 0:r.pages.flatMap(e=>e.content),[null==r?void 0:r.pages]);return(0,n.jsxs)("div",{className:"flex flex-col flex-grow","data-sentry-component":"SearchList","data-sentry-source-file":"SearchList.tsx",children:[l?(0,n.jsx)("div",{className:"px-4 py-1 pb-2.5",children:(0,n.jsx)(C.A,{className:"animate-spin",size:14})}):c?(0,n.jsxs)("p",{className:"px-4 pb-2 text-sm text-foreground-lighter",children:[p," result",p>1?"s":""," found"]}):null,l?(0,n.jsxs)("div",{className:"px-4 flex flex-col gap-y-1",children:[(0,n.jsx)(B.A,{className:"py-2.5"}),(0,n.jsx)(B.A,{className:"py-2.5 w-5/6"}),(0,n.jsx)(B.A,{className:"py-2.5 w-3/4"})]}):(0,n.jsx)(L.A,{items:f,ItemComponent:e=>(0,n.jsx)(U,{snippet:e.item}),itemProps:{},getItemSize:()=>28,hasNextPage:i,isLoadingNextPage:d,onLoadNextPage:()=>o()})]})},U=e=>{let{snippet:t}=e,{ref:a,id:s}=(0,m.g)(),r=t.id===s;return(0,n.jsxs)(k(),{className:(0,O.cn)("h-full flex items-center gap-x-3 pl-4 hover:bg-control transition",r&&"!bg-selection [&>svg]:fill-foreground [&>p]:text-foreground"),href:"/project/".concat(a,"/sql/").concat(t.id),"data-sentry-element":"Link","data-sentry-component":"SearchListItem","data-sentry-source-file":"SearchList.tsx",children:[(0,n.jsx)(F.ty,{size:16,strokeWidth:1.5,className:"w-5 h-5 -ml-0.5 transition-colors fill-foreground-muted group-aria-selected:fill-foreground","data-sentry-element":"SQL_ICON","data-sentry-source-file":"SearchList.tsx"}),(0,n.jsx)("p",{className:"transition text-sm text-foreground-light truncate",children:t.name})]})};var H=a(96591),$=a(52793),V=a.n($),Z=a(66452),G=a(73891),K=a(55335),J=a(75125),Y=a(78873),X=a(57947),ee=a(48969);let et=e=>{var t;let{id:a,...s}=e,r=null==(t=(0,j.aP)().snippets[a])?void 0:t.snippet,l=V()(null==r?void 0:r.name),[i,o]=(0,u.useState)("CLI"),d=[{id:"migration",label:"Migration",title:"Download as migration",description:"Download the snippet in a new migration named `".concat(l,"`"),cli:(0,ee.h8)(a,l),npm:(0,ee.h8)(a,l,!0)},{id:"seed",label:"Seed file",title:"Download as seed file",description:"If your query consists of sample data, append the snippet to the end of `supabase/seed.sql`",cli:(0,ee.mG)(a),npm:(0,ee.mG)(a,!0)},{id:"sql",label:"SQL file",title:"Download as SQL file",description:"Download the snippet directly into a new SQL file named `".concat(l,".sql`"),cli:(0,ee.xL)(a,l),npm:(0,ee.xL)(a,l,!0)}];return(0,n.jsx)(K.A,{hideFooter:!0,showCloseButton:!0,size:"xlarge",header:(0,n.jsx)("p",{children:"Download snippet as local migration file via the Supabase CLI."}),...s,"data-sentry-element":"Modal","data-sentry-component":"DownloadSnippetModal","data-sentry-source-file":"DownloadSnippetModal.tsx",children:(0,n.jsxs)("div",{className:"flex flex-col items-start justify-between gap-4 relative pt-2",children:[(0,n.jsx)(J.A,{type:"underlined",listClassNames:"pl-5","data-sentry-element":"Tabs","data-sentry-source-file":"DownloadSnippetModal.tsx",children:d.map(e=>(0,n.jsx)(J.A.Panel,{id:e.id,label:e.label,children:(0,n.jsxs)(K.A.Content,{className:"!py-0",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,n.jsx)("p",{className:"text-base",children:e.title}),(0,n.jsx)(X.o,{className:"text-sm text-scale-1000 [&>p>code]:!break-normal",content:e.description})]}),(0,n.jsx)(G.A,{width:50,options:["CLI","NPM"],activeOption:i,borderOverride:"border-muted",onClickOption:()=>"CLI"===i?o("NPM"):o("CLI")})]}),(0,n.jsx)("pre",{children:(0,n.jsx)(Y.N,{language:"bash",className:"language-bash prose dark:prose-dark max-w-none",children:"CLI"===i?e.cli:e.npm})})]})},e.id))}),(0,n.jsxs)(K.A.Content,{className:"w-full flex items-center justify-between pt-0","data-sentry-element":"unknown","data-sentry-source-file":"DownloadSnippetModal.tsx",children:[(0,n.jsx)("p",{className:"text-xs text-lighter",children:"Run this command from your project directory"}),(0,n.jsxs)("div",{className:"flex justify-between items-center gap-x-2",children:[(0,n.jsx)(w.$,{asChild:!0,type:"default",icon:(0,n.jsx)(Z.A,{strokeWidth:1.5}),"data-sentry-element":"Button","data-sentry-source-file":"DownloadSnippetModal.tsx",children:(0,n.jsx)(k(),{href:"https://supabase.com/docs/guides/deployment/database-migrations",target:"_blank",rel:"noreferrer","data-sentry-element":"Link","data-sentry-source-file":"DownloadSnippetModal.tsx",children:"About migrations"})}),(0,n.jsx)(w.$,{asChild:!0,type:"default",icon:(0,n.jsx)(Z.A,{strokeWidth:1.5}),"data-sentry-element":"Button","data-sentry-source-file":"DownloadSnippetModal.tsx",children:(0,n.jsx)(k(),{href:"https://supabase.com/docs/guides/cli/local-development",target:"_blank",rel:"noreferrer","data-sentry-element":"Link","data-sentry-source-file":"DownloadSnippetModal.tsx",children:"About CLI"})})]})]})]})})};var ea=a(32981),en=a(5219),es=a(64238),er=a(87494),el=a(39353),ei=a(46312),eo=a(83041),ed=a(87938),ec=a(34587),eu=a(85669),ep=a(27863),em=a(10738),ef=a(50854),ex=a(83405),eh=a(49189);let ey=e=>{var t;let{visible:a,snippets:s=[],onClose:r}=e,{ref:l}=(0,m.g)(),o=(0,j.aP)(),[d,c]=(0,u.useState)(!1),[f,x]=(0,u.useState)(),{mutateAsync:h,isLoading:y}=(0,ed.W)(),{mutateAsync:g,isLoading:v}=(0,eo.v)({onError:e=>{p.oR.error("Failed to move query: ".concat(e.message))}}),b="new-folder"===f?el.Ik({name:el.Yj().min(1,"Please provide a name for the folder")}).refine(e=>!o.allFolderNames.includes(e.name),{message:"This folder name already exists",path:["name"]}):el.Ik({}),S=(0,er.mN)({mode:"onSubmit",reValidateMode:"onSubmit",resolver:(0,ea.u)(b),defaultValues:{name:""}}),N=(0,j.mD)(l),M="root"===f?"Root of the editor":"new-folder"===f?"Create a new folder":null==(t=N.find(e=>e.id===f))?void 0:t.name,q=1===s.length&&(!s[0].folder_id&&"root"===f||s[0].folder_id===f),C=1===s.length&&(!s[0].folder_id&&"root"===f||s[0].folder_id===f),E=async e=>{if(!l)return console.error("Project ref is required");try{let t=f;if("new-folder"===f&&"name"in e){let{id:a}=await h({projectRef:l,name:e.name});t=a}await Promise.all(s.map(async e=>{let a=null==e?void 0:e.content;if(void 0===a){let{content:t}=await (0,ei.Q)({projectRef:l,id:e.id});"sql"in t&&(a=t)}if(void 0===a)return p.oR.error("Failed to save snippet: Unable to retrieve snippet contents");await g({projectRef:l,payload:{id:e.id,type:"sql",name:e.name,description:e.description,visibility:e.visibility,project_id:e.project_id,owner_id:e.owner_id,folder_id:"root"===f?null:t,content:a}})})),p.oR.success("Successfully moved ".concat(1===s.length?'"'.concat(s[0].name,'"'):"".concat(s.length," snippets")," to ").concat("root"===f?"the root of the editor":M)),s.forEach(e=>{o.updateSnippet({id:e.id,snippet:{...e,folder_id:"root"===f?null:t},skipSave:!0})}),r()}catch(e){p.oR.error("Failed to create new folder: ".concat(e.message))}};return(0,u.useEffect)(()=>{if(a&&void 0!==s){if(1===s.length){var e;x(null!=(e=s[0].folder_id)?e:"root")}else x("root");S.reset({name:""})}},[a,s]),(0,n.jsx)(ec.lG,{open:a,onOpenChange:()=>r(),"data-sentry-element":"Dialog","data-sentry-component":"MoveQueryModal","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsx)(ec.Cf,{"data-sentry-element":"DialogContent","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsx)(eu.lV,{...S,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsxs)("form",{id:"move-snippet",onSubmit:S.handleSubmit(E),children:[(0,n.jsxs)(ec.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsxs)(ec.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"MoveQueryModal.tsx",children:["Move ",1===s.length?'"'.concat(s[0].name,'"'):"".concat(s.length)," ","snippet",s.length>1?"s":""," to a folder"]}),(0,n.jsxs)(ec.rr,{"data-sentry-element":"DialogDescription","data-sentry-source-file":"MoveQueryModal.tsx",children:["Select which folder to move your quer",s.length>1?"ies":"y"," to"]})]}),(0,n.jsx)(ec.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"MoveQueryModal.tsx"}),(0,n.jsxs)(ec.OO,{className:"py-5 flex flex-col gap-y-4","data-sentry-element":"DialogSection","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,n.jsx)(ep.J,{className:"text-foreground-light","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:"Select a folder"}),(0,n.jsxs)(em.AM,{open:d,onOpenChange:c,modal:!1,"data-sentry-element":"Popover_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsx)(em.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsx)(w.$,{block:!0,size:"small",type:"default",className:"pr-2 justify-between",iconRight:(0,n.jsx)(en.A,{className:"text-foreground-light rotate-90",strokeWidth:2,size:12}),"data-sentry-element":"Button","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[M,q&&" (Current)"]})})}),(0,n.jsx)(em.hl,{className:"p-0",side:"bottom",align:"start",sameWidthAsTrigger:!0,"data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsxs)(ef.uB,{"data-sentry-element":"Command_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsx)(ef.G7,{placeholder:"Find folder...","data-sentry-element":"CommandInput_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx"}),(0,n.jsxs)(ef.oI,{"data-sentry-element":"CommandList_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsx)(ef.xL,{"data-sentry-element":"CommandEmpty_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:"No folders found"}),(0,n.jsx)(ef.L$,{"data-sentry-element":"CommandGroup_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsxs)(ex.FK,{className:(N||[]).length>6?"h-[210px]":"","data-sentry-element":"ScrollArea","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsxs)(ef.h_,{value:"root",className:"cursor-pointer w-full justify-between",onSelect:()=>{c(!1),x("root")},onClick:()=>{c(!1),x("root")},"data-sentry-element":"CommandItem_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsxs)("span",{children:["Root of the editor",1===s.length&&null===s[0].folder_id&&" (Current)"]}),"root"===f&&(0,n.jsx)(es.A,{size:14})]},"root"),null==N?void 0:N.map(e=>(0,n.jsxs)(ef.h_,{value:e.name,className:"cursor-pointer w-full justify-between",onSelect:()=>{c(!1),x(e.id)},onClick:()=>{c(!1),x(e.id)},children:[(0,n.jsxs)("span",{children:[e.name,1===s.length&&s[0].folder_id===e.id&&" (Current)"]}),e.id===f&&(0,n.jsx)(es.A,{size:14})]},e.id))]})}),(0,n.jsx)(ef.fx,{"data-sentry-element":"CommandSeparator_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx"}),(0,n.jsx)(ef.L$,{"data-sentry-element":"CommandGroup_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:(0,n.jsxs)(ef.h_,{className:"cursor-pointer w-full justify-start gap-x-2",onSelect:e=>{c(!1),x("new-folder")},onClick:()=>{c(!1),x("new-folder")},"data-sentry-element":"CommandItem_Shadcn_","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsx)(i.A,{size:14,strokeWidth:1.5,"data-sentry-element":"Plus","data-sentry-source-file":"MoveQueryModal.tsx"}),(0,n.jsx)("p",{children:"New folder"})]})})]})]})})]})]}),"new-folder"===f&&(0,n.jsx)("div",{className:"flex flex-col gap-y-2",children:(0,n.jsx)(eu.zB,{name:"name",control:S.control,render:e=>{let{field:t}=e;return(0,n.jsxs)(eu.eI,{className:"flex flex-col gap-y-2",children:[(0,n.jsx)(eu.lR,{children:"Provide a name for your new folder"}),(0,n.jsx)(eu.MJ,{children:(0,n.jsx)(eh.p,{autoFocus:!0,...t,autoComplete:"off",disabled:v||y})}),(0,n.jsx)(eu.C5,{})]})}})})]}),(0,n.jsxs)(ec.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"MoveQueryModal.tsx",children:[(0,n.jsx)(w.$,{type:"default",disabled:v||y,onClick:()=>r(),"data-sentry-element":"Button","data-sentry-source-file":"MoveQueryModal.tsx",children:"Cancel"}),(0,n.jsx)(w.$,{type:"primary",htmlType:"submit",disabled:C,loading:v||y,"data-sentry-element":"Button","data-sentry-source-file":"MoveQueryModal.tsx",children:"Move file"})]})]})})})})};var eg=a(7724),ev=a(22392),ej=a(25718),eb=a(79175),eS=a(80109),ew=a(71171),eN=a(19061),eM=a(73401);let eq=e=>{let{snippet:t={},visible:a,onCancel:s,onComplete:r}=e,{ref:l}=(0,m.g)(),i=(0,ej.a)(),o=(0,j.aP)(),{data:d}=(0,ev.j5)({orgSlug:null==i?void 0:i.slug},{enabled:a}),c="sql"===t.type,f=(0,H.Uq)(),x=(0,eM.BP)(d),{id:h,name:y,description:g}=t,[v,b]=(0,u.useState)(y),[S,N]=(0,u.useState)(g),{mutate:M,isLoading:q}=(0,eg.G)({onSuccess:e=>{let{title:t,description:a}=e;b(t),S||N(a)},onError:e=>{p.oR.error("Failed to rename query: ".concat(e.message))}}),C=async()=>{if("content"in t&&c)M({sql:t.content.sql});else try{let{content:e}=await (0,ei.Q)({projectRef:l,id:t.id});"sql"in e&&M({sql:e.sql})}catch(e){p.oR.error("Unable to generate title based on query contents")}},{mutateAsync:E}=(0,eo.v)(),k=async(e,a)=>{let{setSubmitting:n}=a;if(!l)return console.error("Project ref is required");if(!h)return console.error("Snippet ID is required");n(!0);try{let e=t;if("content"in e||(e=await (0,ei.Q)({projectRef:l,id:h}),o.addSnippet({projectRef:l,snippet:e})),await E({projectRef:l,payload:{...e,name:v,description:S}}),o.renameSnippet({id:h,name:v,description:S}),f&&l){let e=(0,eb.lW)("sql",{id:h});(0,eb.Nt)(l,e,{label:v})}p.oR.success("Successfully renamed snippet!"),r&&r()}catch(e){n(!1),p.oR.error("Failed to rename snippet: ".concat(e.message))}};return(0,u.useEffect)(()=>{b(y),N(g)},[t.id]),(0,n.jsx)(K.A,{visible:a,onCancel:s,hideFooter:!0,header:"Rename",size:"small","data-sentry-element":"Modal","data-sentry-component":"RenameQueryModal","data-sentry-source-file":"RenameQueryModal.tsx",children:(0,n.jsx)(eS.A,{onReset:s,validateOnBlur:!0,initialValues:{name:null!=y?y:"",description:null!=g?g:""},validate:()=>{let e={};return v||(e.name="Please enter a query name"),e},onSubmit:k,"data-sentry-element":"Form","data-sentry-source-file":"RenameQueryModal.tsx",children:e=>{let{isSubmitting:t}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(K.A.Content,{className:"space-y-4",children:[(0,n.jsx)(ew.A,{label:"Name",id:"name",name:"name",value:v,onChange:e=>b(e.target.value)}),(0,n.jsx)("div",{className:"flex w-full justify-end mt-2",children:!x&&(0,n.jsx)(w.$,{type:"default",onClick:()=>C(),size:"tiny",disabled:q,children:(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("div",{className:"scale-75",children:(0,n.jsx)(eN.M,{loading:q})}),(0,n.jsx)("span",{children:"Rename with Supabase AI"})]})})}),(0,n.jsx)(ew.A.TextArea,{label:"Description",id:"description",placeholder:"Describe query",size:"medium",textAreaClassName:"resize-none",value:S,onChange:e=>N(e.target.value)})]}),(0,n.jsx)(K.A.Separator,{}),(0,n.jsxs)(K.A.Content,{className:"flex items-center justify-end gap-2",children:[(0,n.jsx)(w.$,{htmlType:"reset",type:"default",onClick:s,disabled:t,children:"Cancel"}),(0,n.jsx)(w.$,{htmlType:"submit",loading:t,disabled:t,children:"Rename query"})]})]})}})})};var eC=a(12593),eE=a(2767);let ek=()=>(0,n.jsx)(N.Q5,{title:"No private queries created yet",description:"Queries will be automatically saved once you start writing in the editor",className:"mx-4","data-sentry-element":"InnerSideBarEmptyPanel","data-sentry-component":"EmptyPrivateQueriesPanel","data-sentry-source-file":"PrivateSqlSnippetEmpty.tsx",children:(0,n.jsx)("div",{className:"top-0 left-6 flex flex-col opacity-50 cursor-not-allowed bg-dash-sidebar h-content -mb-7 pointer-events-none scale-75",children:(0,n.jsxs)("div",{className:"relative h-content",children:[(0,n.jsxs)("div",{className:"absolute inset-0 pointer-events-none z-10",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent from-80% to-100% to-background-surface-100 dark:to-background-surface-75"}),(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent from-50% to-100% to-background-surface-100 dark:to-background-surface-75"})]}),(0,n.jsx)("div",{className:"absolute left-[128px] bottom-[21px] text-foreground-muted z-10 pointer-events-none",children:(0,n.jsx)(eE.A,{size:16,className:"text-foreground-light",strokeWidth:1.5,"data-sentry-element":"Pointer","data-sentry-source-file":"PrivateSqlSnippetEmpty.tsx"})}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsx)("div",{className:"border-l pointer-events-none",children:(0,n.jsx)(F.Z7,{isSelected:2===t,id:"dummy-".concat(t+1),name:"dummy_query_".concat(t+1),level:1,xPadding:16})},"dummy-".concat(t+1)))]})})});var eL=a(34398),eP=a(78960),eA=a(81737),e_=a(32144),eQ=a(80251);async function eI(e,t){let{projectRef:a,ids:n}=e,{data:s,error:r}=await (0,A.yH)("/platform/projects/{ref}/content/folders",{params:{path:{ref:a},query:{ids:n}},signal:t});if(r)throw(0,A.H4)(r);return s}let eD=function(){let{onError:e,onSuccess:t,invalidateQueriesOnSuccess:a=!0,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,e_.jE)();return(0,eQ.n)(e=>eI(e),{async onSuccess(e,n,r){let{projectRef:l}=n;a&&await s.invalidateQueries(_.M.folders(l)),await (null==t?void 0:t(e,n,r))},async onError(t,a,n){void 0===e?p.oR.error("Failed to delete folder: ".concat(t.message)):e(t,a,n)},...n})};var eT=a(45740),eR=a(6137),ez=a(73634),eO=a(40435),eF=a(19692),eB=a(71547),eW=a(16580),eU=a(36212),eH=a(81250);let e$=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3",children:[(0,n.jsx)(eH.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,n.jsx)(eH.E,{className:"w-40 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]}),(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3",children:[(0,n.jsx)(eH.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,n.jsx)(eH.E,{className:"w-32 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]}),(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-75",children:[(0,n.jsx)(eH.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,n.jsx)(eH.E,{className:"w-20 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]}),(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-50",children:[(0,n.jsx)(eH.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,n.jsx)(eH.E,{className:"w-40 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]}),(0,n.jsxs)("div",{className:"flex flex-row h-6 px-3 items-center gap-3 opacity-25",children:[(0,n.jsx)(eH.E,{className:"h-4 w-5","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"}),(0,n.jsx)(eH.E,{className:"w-20 h-4","data-sentry-element":"Skeleton","data-sentry-source-file":"SQLEditorLoadingSnippets.tsx"})]})]}),eV={id:0,name:"",parent:null,children:[]},eZ=e=>{var t,a;if(void 0===e)return[eV];let{folders:n,contents:s}=e,r=(null==n?void 0:n.map(e=>{var t;let{id:a,name:n}=e;return{id:a,name:n,parent:0,isBranch:!0,children:null!=(t=null==s?void 0:s.filter(e=>e.folder_id===a).map(e=>e.id))?t:[],metadata:e}}))||[],l=(null==s?void 0:s.map(e=>{let{id:t,name:a,folder_id:n}=e;return{id:t,name:a,parent:null!=n?n:0,children:[],metadata:e}}))||[];return[{id:0,name:"",parent:null,children:[...null==(t=n||[])?void 0:t.map(e=>e.id),...null==(a=(s||[]).filter(e=>!e.folder_id))?void 0:a.map(e=>e.id)]},...r,...l]};function eG(e){let t=new Set,a=e.filter(e=>0===e.parent);if(a.length>0){let e=a[a.length-1];"string"==typeof e.id&&t.add(e.id),a.forEach(e=>{if(e.children.length>0){let a=e.children[e.children.length-1];"string"==typeof a&&t.add(a)}})}return t}var eK=a(69610);async function eJ(e,t){let{projectRef:a,folderId:n,cursor:s,sort:r,name:l}=e;if(void 0===a)throw Error("projectRef is required");if(void 0===n)throw Error("folderId is required");let{data:i,error:o}=await (0,A.Jt)("/platform/projects/{ref}/content/folders/{id}",{params:{path:{ref:a,id:n},query:{cursor:s,limit:z.c3.toString(),sort_by:r,sort_order:"name"===r?"asc":"desc",name:l}},signal:t});return o&&(0,A.H4)(o),{...i.data,cursor:i.cursor}}let eY=function(e){let{projectRef:t,folderId:a,name:n,sort:s}=e,{enabled:r=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,D.q)(_.M.folderContents(t,a,{name:n,sort:s}),e=>{let{signal:r,pageParam:l}=e;return eJ({projectRef:t,folderId:a,cursor:l,name:n,sort:s},r)},{enabled:r&&void 0!==t&&void 0!==a,getNextPageParam:e=>e.cursor,...l})};var eX=a(19423),e0=a(12015),e1=a(94328),e2=a(4027);let e5=(0,a(47370).A)("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);var e3=a(26629),e4=a(87467),e7=a(10822),e6=a(62528);let e9=e=>{let{element:t,isBranch:a,isExpanded:r,level:l,status:o,isSelected:d,isMultiSelected:p,getNodeProps:x,onSelectCreate:h,onSelectDelete:y,onSelectRename:v,onSelectMove:b,onSelectShare:S,onSelectUnshare:N,onSelectDownload:M,onSelectDuplicate:q,onEditSave:C,onMultiSelect:E,isLastItem:L,hasNextPage:P,fetchNextPage:A,isFetchingNextPage:_,sort:Q,name:I,onFolderContentsChange:D,...T}=e,R=(0,c.useRouter)(),{id:z,ref:O}=(0,eK.g)(),{profile:B}=(0,g.xc)(),{className:W,onClick:U}=x(),H=(0,j.aP)(),$=(null==B?void 0:B.id)===(null==t?void 0:t.metadata.owner_id),V="project"===t.metadata.visibility,G="editing"===o,K=(0,f.SE)(s.aG.CREATE,"user_content",{resource:{type:"sql",owner_id:null==B?void 0:B.id},subject:{id:null==B?void 0:B.id}}),J=0===t.parent?void 0:t.parent,Y=a&&r,{data:X,isSuccess:ee,isLoading:et,isFetchingNextPage:ea,hasNextPage:en,fetchNextPage:es,isPreviousData:er,isFetching:el}=eY({projectRef:O,folderId:null!=J?J:t.id,name:I,sort:Q},{enabled:Y,keepPreviousData:!0});(0,u.useEffect)(()=>{O&&ee&&X.pages.forEach(e=>{var t;null==(t=e.contents)||t.forEach(e=>{H.addSnippet({projectRef:O,snippet:e})})})},[O,null==X?void 0:X.pages]);let ei=(0,eX.A)(D);(0,u.useEffect)(()=>{if(Y){var e;null==(e=ei.current)||e.call(ei,{isLoading:et||er&&el,snippets:null==X?void 0:X.pages.flatMap(e=>{var t;return null!=(t=e.contents)?t:[]})})}},[null==X?void 0:X.pages,el,et,er,Y]);let eo=void 0!==J;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e6.tz,{modal:!1,"data-sentry-element":"ContextMenu_Shadcn_","data-sentry-source-file":"SQLEditorTreeViewItem.tsx",children:[(0,n.jsx)(e6.Rc,{asChild:!0,"data-sentry-element":"ContextMenuTrigger_Shadcn_","data-sentry-source-file":"SQLEditorTreeViewItem.tsx",children:(0,n.jsx)(F.Z7,{className:W,level:l,isExpanded:r,isBranch:a,isSelected:d,isPreview:T.isPreview,isEditing:G,isLoading:Y&&et||"saving"===o,onEditSubmit:e=>{void 0!==C&&C(e)},onClick:e=>{a?G||U(e):e.shiftKey&&"new"!==z?null==E||E(t.id):R.push("/project/".concat(O,"/sql/").concat(t.id))},...T,name:t.name,xPadding:16,"data-sentry-element":"TreeViewItem","data-sentry-source-file":"SQLEditorTreeViewItem.tsx"})}),(0,n.jsx)(e6.Ip,{onCloseAutoFocus:e=>e.stopPropagation(),"data-sentry-element":"ContextMenuContent_Shadcn_","data-sentry-source-file":"SQLEditorTreeViewItem.tsx",children:a?(0,n.jsxs)(n.Fragment,{children:[void 0!==h&&(0,n.jsxs)(e6.kt,{className:"gap-x-2",onSelect:()=>h(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(i.A,{size:14}),"Create new snippet"]}),void 0!==v&&$&&(0,n.jsxs)(e6.kt,{className:"gap-x-2",onSelect:()=>v(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(e0.A,{size:14}),"Rename folder"]}),void 0!==y&&$&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e6.K5,{}),(0,n.jsxs)(e6.kt,{className:"gap-x-2",onSelect:()=>y(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(e1.A,{size:14}),"Delete folder"]})]})]}):p?(0,n.jsxs)(n.Fragment,{children:[void 0!==b&&(0,n.jsxs)(e6.kt,{className:"gap-x-2",onSelect:()=>b(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(e2.A,{size:14}),"Move selected queries"]}),(0,n.jsx)(e6.K5,{}),void 0!==y&&(0,n.jsxs)(e6.kt,{className:"gap-x-2",onSelect:()=>y(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(e1.A,{size:14}),"Delete selected queries"]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e6.kt,{asChild:!0,className:"gap-x-2",onSelect:()=>{},onFocusCapture:e=>e.stopPropagation(),children:(0,n.jsxs)(k(),{href:"/project/".concat(O,"/sql/").concat(t.id),target:"_blank",rel:"noreferrer",children:[(0,n.jsx)(Z.A,{size:14}),"Open in new tab"]})}),(0,n.jsx)(e6.K5,{}),void 0!==v&&$&&(0,n.jsxs)(e6.kt,{className:"gap-x-2",onSelect:()=>v(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(e0.A,{size:14}),"Rename query"]}),void 0!==b&&$&&(0,n.jsxs)(e6.kt,{className:"gap-x-2",onSelect:()=>b(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(e2.A,{size:14}),"Move query"]}),void 0!==S&&!V&&K&&(0,n.jsxs)(e6.kt,{className:"gap-x-2",onSelect:()=>S(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(e5,{size:14}),"Share query with team"]}),void 0!==N&&V&&$&&(0,n.jsxs)(e6.kt,{className:"gap-x-2",onSelect:()=>N(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(e3.A,{size:14}),"Unshare query with team"]}),void 0!==q&&K&&(0,n.jsxs)(e6.kt,{className:"gap-x-2",onSelect:()=>q(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(e4.A,{size:14}),"Duplicate query"]}),void 0!==M&&m.pe&&(0,n.jsxs)(e6.kt,{className:"gap-x-2",onSelect:()=>M(),onFocusCapture:e=>e.stopPropagation(),children:[(0,n.jsx)(e7.A,{size:14}),"Download as migration file"]}),void 0!==y&&$&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e6.K5,{}),(0,n.jsxs)(e6.kt,{className:"gap-x-2",onSelect:()=>y(),children:[(0,n.jsx)(e1.A,{size:14}),"Delete query"]})]})]})})]}),(eo?en:P)&&"string"==typeof t.id&&L&&(0,n.jsx)("div",{className:"px-4 py-1",style:{paddingLeft:!t.isBranch&&t.level>1?48*(t.level-1):void 0},children:(0,n.jsx)(w.$,{type:"outline",size:"tiny",block:!0,loading:eo?ea:_,disabled:eo?ea:_,onClick:function(){eo?es():"function"==typeof A&&A()},children:"Load More"})})]})},e8={shared:!1,favorite:!1,private:!0},te=e=>{var t,a,s,r,l,i,o,d,f;let{sort:v="inserted_at"}=e,b=(0,c.useRouter)(),{ref:S,id:w}=(0,m.g)(),{profile:M}=(0,g.xc)(),q=(0,h.KT)(),C=(0,j.aP)(),E=(0,eb.IT)(S),k=(0,eb.ZG)(S),L=(0,H.Uq)(),[P,A]=(0,x.M)(y.rS.SQL_EDITOR_SECTION_STATE(null!=S?S:""),e8),{shared:_,favorite:Q,private:D}=P,[T,R]=(0,u.useState)(!1),[O,B]=(0,u.useState)(!1),[W,U]=(0,u.useState)(!1),[$,V]=(0,u.useState)([]),[Z,G]=(0,u.useState)([]),[K,J]=(0,u.useState)(),[Y,X]=(0,u.useState)(),[ea,en]=(0,u.useState)(),[es,er]=(0,u.useState)(),[el,ed]=(0,u.useState)(),ec=null==(t=C.snippets[w])?void 0:t.snippet,{data:eu,isSuccess:ep,isLoading:em,isPreviousData:ef,isFetching:ex,hasNextPage:eh,fetchNextPage:eg,isFetchingNextPage:ev}=(0,z.e9)({projectRef:S,sort:v},{keepPreviousData:!0}),[ej,eS]=(0,u.useState)({}),ew=(0,u.useMemo)(()=>{var e;let t=null!=(e=null==eu?void 0:eu.pages.flatMap(e=>{var t;return null!=(t=e.contents)?t:[]}))?e:[],a=Object.values(ej).reduce((e,t)=>{var a;let n=(null!=(a=t.snippets)?a:[]).filter(t=>!e.snippetIds.has(t.id)),s=new Set(n.map(e=>e.id));return{snippets:[...e.snippets,...n],isLoading:e.isLoading||t.isLoading,snippetIds:new Set([...e.snippetIds,...s])}},{snippets:t,isLoading:em||ef&&ex,snippetIds:new Set(t.map(e=>e.id))});return ec&&"user"===ec.visibility&&!a.snippetIds.has(ec.id)&&(a.snippetIds.add(ec.id),a.snippets=[...a.snippets,ec]),a},[null==eu?void 0:eu.pages,ej,em,ef,ex,ec]),eN=(0,u.useMemo)(()=>{var e,t;return null!=(t=null==(e=ew.snippets)?void 0:e.filter(e=>"user"===e.visibility).sort((e,t)=>"name"===v?e.name.localeCompare(t.name):new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()))?t:[]},[ew.snippets,v]),eM=(0,j.mD)(S),{data:eE}=I({projectRef:S,type:"sql"}),e_=null!=(r=null==eE?void 0:eE.private)?r:0,eQ=(0,u.useMemo)(()=>0===eM.length&&0===eN.length?[eV]:eZ({folders:eM,contents:eN}),[eM,eN]),eI=(0,u.useMemo)(()=>eG(eQ),[eQ]),{data:eH,isLoading:eK,hasNextPage:eJ,fetchNextPage:eY,isFetchingNextPage:eX,isSuccess:e0}=(0,eT.I)({projectRef:S,favorite:!0,sort:v},{enabled:Q,keepPreviousData:!0}),e1=(0,u.useMemo)(()=>{var e,t;let a=null!=(e=null==eH?void 0:eH.pages.flatMap(e=>{var t;return null!=(t=e.contents)?t:[]}))?e:[];return ec&&ec.favorite&&!a.find(e=>e.id===ec.id)&&a.push(ec),null!=(t=a.map(e=>({...e,folder_id:void 0})).sort((e,t)=>"name"===v?e.name.localeCompare(t.name):new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()))?t:[]},[null==eH?void 0:eH.pages,ec,v]),e2=null!=(l=null==eE?void 0:eE.favorites)?l:0,e5=(0,u.useMemo)(()=>0===e1.length?[eV]:eZ({contents:e1}),[e1]),e3=(0,u.useMemo)(()=>eG(e5),[e5]),{data:e4,isLoading:e7,hasNextPage:e6,fetchNextPage:te,isFetchingNextPage:tt,isSuccess:ta}=(0,eT.I)({projectRef:S,visibility:"project",sort:v},{enabled:_,keepPreviousData:!0}),tn=(0,u.useMemo)(()=>{var e,t;let a=null!=(e=null==e4?void 0:e4.pages.flatMap(e=>{var t;return null!=(t=e.contents)?t:[]}))?e:[];return ec&&"project"===ec.visibility&&!a.find(e=>e.id===ec.id)&&a.push(ec),null!=(t=a.sort((e,t)=>"name"===v?e.name.localeCompare(t.name):new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()))?t:[]},[null==e4?void 0:e4.pages,ec,v]),ts=null!=(i=null==eE?void 0:eE.shared)?i:0,tr=(0,u.useMemo)(()=>0===tn.length?[eV]:eZ({contents:tn}),[tn]),tl=(0,u.useMemo)(()=>eG(tr),[tr]),ti=[...null!=(o=null==eu?void 0:eu.pages.flatMap(e=>e.contents))?o:[],...null!=(d=null==e4?void 0:e4.pages.flatMap(e=>e.contents))?d:[]],{mutate:to,isLoading:td}=(0,eo.v)({onError:e=>{p.oR.error("Failed to update query: ".concat(e.message))}}),{mutate:tc,isLoading:tu}=(0,eA.$)({onSuccess:e=>{if(L){let t=e.map(e=>(0,eb.lW)("sql",{id:e}));(0,eb.Xn)(S,t)}},onError:(e,t)=>{e.message.includes("Contents not found")?tf(t.ids):p.oR.error("Failed to delete query: ".concat(e.message))}}),{mutate:tp,isLoading:tm}=eD({onSuccess:(e,t)=>{p.oR.success("Successfully deleted folder");let{ids:a}=t;C.removeFolder(a[0]),ed(void 0)}}),tf=e=>{B(!1),G([]);let t=Object.keys(C.snippets).filter(t=>!e.includes(t));0===t.length?b.push("/project/".concat(S,"/sql/new")):e.includes(w)&&b.push("/project/".concat(S,"/sql/").concat(t[0])),e.length>0&&e.forEach(e=>C.removeSnippet(e))},tx=async e=>{var t;let a="share"===e?K:Y;if(!S)return console.error("Project ref is required");if(!a)return console.error("Snippet ID is required");let n=C.snippets[a.id],s=null==n||null==(t=n.snippet)?void 0:t.content;if(void 0===s){let{content:e}=await (0,ei.Q)({projectRef:S,id:a.id});s=e}if(void 0===s)return p.oR.error("Unable to update snippet visibility: Content is missing");let r="share"===e?"project":"user";to({projectRef:S,payload:{...a,visibility:r,folder_id:null,content:s}},{onSuccess:()=>{J(void 0),X(void 0),A({...P,shared:!0}),C.updateSnippet({id:a.id,snippet:{visibility:r,folder_id:null},skipSave:!0}),p.oR.success("share"===e?"Snippet is now shared to the project":"Snippet is now unshared from the project")}})},th=async e=>{if(!M)return console.error("Profile is required");if(!q)return console.error("Project is required");if(!S)return console.error("Project ref is required");if(!w)return console.error("Snippet ID is required");let t="";if(e.content&&e.content.sql)t=e.content.sql;else{let{content:a}=await (0,ei.Q)({projectRef:S,id:e.id});"sql"in a&&(t=a.sql)}let a=(0,ee.fW)({id:(0,eR.A)(),name:"".concat(e.name," (Duplicate)"),sql:t,owner_id:null==M?void 0:M.id,project_id:null==q?void 0:q.id});C.addSnippet({projectRef:S,snippet:a}),C.addNeedsSaving(a.id),b.push("/project/".concat(S,"/sql/").concat(a.id))},ty=async()=>{if(!S)return console.error("Project ref is required");if(void 0===el)return console.error("No folder is selected");let e=eN.filter(e=>e.folder_id===el.id);if(e.length>0){let t=e.map(e=>e.id);tc({projectRef:S,ids:t},{onSuccess:()=>{t.forEach(e=>C.removeSnippet(e)),tf(t),tp({projectRef:S,ids:[null==el?void 0:el.id]})}})}else tp({projectRef:S,ids:[null==el?void 0:el.id]})},tg=e=>{let t=eN.map(e=>e.id),a=t.indexOf(w),n=t.indexOf(e),s=Math.min(a,n),r=Math.max(a,n),l=[],i=eN[s].folder_id===eN[r].folder_id;for(let e=s;e<=r;e++)i&&eN[e].folder_id===eN[s].folder_id&&l.push(eN[e]);G(l)};return(0,u.useEffect)(()=>{void 0!==ec&&ep&&("project"===ec.visibility?A({...P,shared:!0}):"user"===ec.visibility&&A({...P,private:!0}),ec.folder_id&&!$.includes(ec.folder_id)&&V([...$,ec.folder_id]))},[ec,v,ep]),(0,u.useEffect)(()=>{G([])},[w]),(0,u.useEffect)(()=>{S&&eu&&eu.pages.forEach(e=>{var t,a;null==(t=e.contents)||t.forEach(e=>{C.addSnippet({projectRef:S,snippet:e})}),null==(a=e.folders)||a.forEach(e=>C.addFolder({projectRef:S,folder:e}))})},[S,null==eu?void 0:eu.pages]),(0,u.useEffect)(()=>{void 0!==S&&e0&&eH.pages.forEach(e=>{var t;null==(t=e.contents)||t.forEach(e=>{C.addSnippet({projectRef:S,snippet:e})})})},[S,null==eH?void 0:eH.pages]),(0,u.useEffect)(()=>{void 0!==S&&ta&&e4.pages.forEach(e=>{var t;null==(t=e.contents)||t.forEach(e=>{C.addSnippet({projectRef:S,snippet:e})})})},[S,null==e4?void 0:e4.pages]),(0,u.useEffect)(()=>{S&&ep&&L&&(0,eP.g)({ref:S,snippets:ti})},[ep,ta,ti,L]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(N.hm,{className:"px-0",open:_,onOpenChange:e=>{A({...null!=P?P:e8,shared:e})},"data-sentry-element":"InnerSideMenuCollapsible","data-sentry-source-file":"SQLEditorNav.tsx",children:[(0,n.jsx)(N.Pq,{title:"Shared ".concat(ts>0?" (".concat(ts,")"):""),"data-sentry-element":"InnerSideMenuCollapsibleTrigger","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(N.qP,{className:"group-data-[state=open]:pt-2","data-sentry-element":"InnerSideMenuCollapsibleContent","data-sentry-source-file":"SQLEditorNav.tsx",children:e7?(0,n.jsx)(e$,{}):0===tn.length?(0,n.jsx)(N.Q5,{className:"mx-2",title:"No shared queries",description:"Share queries with your team by right-clicking on the query."}):(0,n.jsx)(F.GS,{data:tr,"aria-label":"project-level-snippets",nodeRenderer:e=>{var t,a;let{element:s,...r}=e,l=L&&Object.values(k.tabsMap).some(e=>{var t,a;return(null==(t=e.metadata)?void 0:t.sqlId)===(null==(a=s.metadata)?void 0:a.id)}),i=(0,eb.lW)("sql",{id:null==s||null==(t=s.metadata)?void 0:t.id}),o=L&&E.previewTabId===i,d=!o&&(null==(a=s.metadata)?void 0:a.id)===w,c=Z.some(e=>{var t;return e.id===(null==(t=s.metadata)?void 0:t.id)});return(0,n.jsx)(e9,{...r,isOpened:l&&!o,isSelected:d||c,isPreview:o,onDoubleClick:e=>{e.preventDefault(),(0,eb.UH)(S,i)},element:s,onSelectDelete:()=>{B(!0),G([s.metadata])},onSelectRename:()=>{U(!0),en(s.metadata)},onSelectDownload:()=>{er(s.metadata)},onSelectDuplicate:()=>{th(s.metadata)},onSelectUnshare:()=>{X(s.metadata)},isLastItem:tl.has(s.id),hasNextPage:e6,fetchNextPage:te,isFetchingNextPage:tt})}})})]}),(0,n.jsx)(N.OJ,{"data-sentry-element":"InnerSideMenuSeparator","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsxs)(N.hm,{className:"px-0",open:Q,onOpenChange:e=>{A({...null!=P?P:e8,favorite:e})},"data-sentry-element":"InnerSideMenuCollapsible","data-sentry-source-file":"SQLEditorNav.tsx",children:[(0,n.jsx)(N.Pq,{title:"Favorites ".concat(e2>0?" (".concat(e2,")"):""),"data-sentry-element":"InnerSideMenuCollapsibleTrigger","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(N.qP,{className:"group-data-[state=open]:pt-2","data-sentry-element":"InnerSideMenuCollapsibleContent","data-sentry-source-file":"SQLEditorNav.tsx",children:eK?(0,n.jsx)(e$,{}):0===e1.length?(0,n.jsx)(N.Q5,{title:"No favorite queries",className:"mx-2 px-3",description:(0,n.jsxs)(n.Fragment,{children:["Save a query to favorites for easy accessibility by clicking the"," ",(0,n.jsx)(ez.A,{size:12,className:"inline-block relative align-center -top-[1px]"})," ","icon."]})}):(0,n.jsx)(F.GS,{data:e5,"aria-label":"favorite-snippets",nodeRenderer:e=>{var t,a;let{element:s,...r}=e,l=L&&Object.values(k.tabsMap).some(e=>{var t,a;return(null==(t=e.metadata)?void 0:t.sqlId)===(null==(a=s.metadata)?void 0:a.id)}),i=(0,eb.lW)("sql",{id:null==s||null==(t=s.metadata)?void 0:t.id}),o=L&&E.previewTabId===i,d=!o&&(null==(a=s.metadata)?void 0:a.id)===w,c=Z.some(e=>{var t;return e.id===(null==(t=s.metadata)?void 0:t.id)});return(0,n.jsx)(e9,{...r,isSelected:d||c,isOpened:l&&!o,isPreview:o,onDoubleClick:e=>{e.preventDefault(),(0,eb.UH)(S,i)},element:s,onSelectDelete:()=>{B(!0),G([s.metadata])},onSelectRename:()=>{U(!0),en(s.metadata)},onSelectDownload:()=>{er(s.metadata)},onSelectDuplicate:()=>{th(s.metadata)},onSelectShare:()=>J(s.metadata),onSelectUnshare:()=>{X(s.metadata)},isLastItem:e3.has(s.id),hasNextPage:eJ,fetchNextPage:eY,isFetchingNextPage:eX})}})})]}),(0,n.jsx)(N.OJ,{"data-sentry-element":"InnerSideMenuSeparator","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsxs)(N.hm,{open:D,onOpenChange:e=>{A({...null!=P?P:e8,private:e})},className:"px-0","data-sentry-element":"InnerSideMenuCollapsible","data-sentry-source-file":"SQLEditorNav.tsx",children:[(0,n.jsx)(N.Pq,{title:"PRIVATE\n            ".concat(e_>0?" (".concat(e_,")"):""),"data-sentry-element":"InnerSideMenuCollapsibleTrigger","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(N.qP,{className:"group-data-[state=open]:pt-2","data-sentry-element":"InnerSideMenuCollapsibleContent","data-sentry-source-file":"SQLEditorNav.tsx",children:em?(0,n.jsx)(eL.A,{}):0===eM.length&&0===eN.length?(0,n.jsx)(ek,{}):(0,n.jsx)(F.GS,{multiSelect:!0,togglableSelect:!0,clickAction:"EXCLUSIVE_SELECT",data:eQ,selectedIds:Z.map(e=>e.id),"aria-label":"private-snippets",onExpand:e=>{let t=e.element.id.toString();e.isExpanded&&!$.includes(t)&&V([...$,t]),!e.isExpanded&&$.includes(t)&&V($.filter(e=>e!==t))},expandedIds:$,nodeRenderer:e=>{var t,a;let{element:s,...r}=e,l=L&&Object.values(k.tabsMap).some(e=>{var t,a;return(null==(t=e.metadata)?void 0:t.sqlId)===(null==(a=s.metadata)?void 0:a.id)}),i=(0,eb.lW)("sql",{id:null==s||null==(t=s.metadata)?void 0:t.id}),o=L&&E.previewTabId===i,d=!o&&(null==(a=s.metadata)?void 0:a.id)===w,c=Z.some(e=>{var t;return e.id===(null==(t=s.metadata)?void 0:t.id)});return(0,n.jsx)(e9,{...r,element:s,isOpened:l&&!o,isSelected:d||c,isPreview:o,isMultiSelected:Z.length>1,isLastItem:eI.has(s.id),status:r.isBranch?C.folders[s.id].status:"idle",onMultiSelect:tg,onSelectCreate:()=>{if(M&&q){let e=(0,ee.fW)({id:(0,eR.A)(),name:eC.tO,owner_id:null==M?void 0:M.id,project_id:null==q?void 0:q.id,folder_id:s.id,sql:""});C.addSnippet({projectRef:q.ref,snippet:e}),b.push("/project/".concat(S,"/sql/").concat(e.id))}},onSelectDelete:()=>{r.isBranch?ed(s.metadata):(B(!0),0===Z.length&&G([s.metadata]))},onSelectRename:()=>{r.isBranch?C.editFolder(s.id):(U(!0),en(s.metadata))},onSelectMove:()=>{R(!0),0===Z.length&&G([s.metadata])},onSelectDownload:()=>er(s.metadata),onSelectDuplicate:()=>th(s.metadata),onSelectShare:()=>J(s.metadata),onEditSave:e=>{0===e.length&&"new-folder"===s.id?C.removeFolder(s.id):e.length>0&&C.saveFolder({id:s.id,name:e})},hasNextPage:eh,fetchNextPage:eg,isFetchingNextPage:ev,sort:v,onFolderContentsChange:e=>{let{isLoading:t,snippets:a}=e;eS(e=>({...e,[s.id]:{snippets:a,isLoading:t}}))},onDoubleClick:e=>{e.preventDefault(),(0,eb.UH)(S,i)}})}})})]}),(0,n.jsx)(eW.w,{"data-sentry-element":"Separator","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(eq,{snippet:ea,visible:W,onCancel:()=>U(!1),onComplete:()=>U(!1),"data-sentry-element":"RenameQueryModal","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(ey,{snippets:Z,visible:T,onClose:()=>{R(!1),G([])},"data-sentry-element":"MoveQueryModal","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(et,{id:null!=(f=null==es?void 0:es.id)?f:"",visible:void 0!==es,onCancel:()=>er(void 0),"data-sentry-element":"DownloadSnippetModal","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)(eU.A,{size:"medium",loading:td,title:"Confirm to share query: ".concat(null==K?void 0:K.name),confirmLabel:"Share query",confirmLabelLoading:"Sharing query",visible:void 0!==K,onCancel:()=>J(void 0),onConfirm:()=>tx("share"),alert:{title:"This SQL query will become public to all team members",description:"Anyone with access to the project can view it"},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"SQLEditorNav.tsx",children:(0,n.jsxs)("ul",{className:"text-sm text-foreground-light space-y-5",children:[(0,n.jsxs)("li",{className:"flex gap-3 items-center",children:[(0,n.jsx)(eO.A,{size:16,"data-sentry-element":"Eye","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)("span",{children:"Project members will have read-only access to this query."})]}),(0,n.jsxs)("li",{className:"flex gap-3 items-center",children:[(0,n.jsx)(eF.A,{size:16,"data-sentry-element":"Unlock","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)("span",{children:"Anyone will be able to duplicate it to their personal snippets."})]})]})}),(0,n.jsx)(eU.A,{size:"medium",title:"Confirm to unshare query: ".concat(null==Y?void 0:Y.name),confirmLabel:"Unshare query",confirmLabelLoading:"Unsharing query",visible:void 0!==Y,onCancel:()=>X(void 0),onConfirm:()=>tx("unshare"),alert:{title:"This SQL query will no longer be public to all team members",description:"Only you will have access to this query"},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"SQLEditorNav.tsx",children:(0,n.jsx)("ul",{className:"text-sm text-foreground-light space-y-5",children:(0,n.jsxs)("li",{className:"flex gap-3",children:[(0,n.jsx)(eB.A,{"data-sentry-element":"EyeOffIcon","data-sentry-source-file":"SQLEditorNav.tsx"}),(0,n.jsx)("span",{children:"Project members will no longer be able to view this query."})]})})}),(0,n.jsx)(eU.A,{size:"small",title:"Confirm to delete ".concat(1===Z.length?"query":"".concat(Z.length.toLocaleString()," quer").concat(Z.length>1?"ies":"y")),confirmLabel:"Delete ".concat(Z.length.toLocaleString()," quer").concat(Z.length>1?"ies":"y"),confirmLabelLoading:"Deleting query",loading:tu,visible:O,variant:"destructive",onCancel:()=>{B(!1),G([])},onConfirm:()=>{if(!S)return console.error("Project ref is required");tc({projectRef:S,ids:Z.map(e=>e.id)},{onSuccess:e=>{p.oR.success("Successfully deleted ".concat(Z.length.toLocaleString()," quer").concat(Z.length>1?"ies":"y")),tf(e)}})},alert:(null==(a=Z[0])?void 0:a.visibility)==="project"?{title:"This SQL snippet will be lost forever",description:"Deleting this query will remove it for all members of the project team."}:void 0,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"SQLEditorNav.tsx",children:(0,n.jsxs)("p",{className:"text-sm",children:["This action cannot be undone."," ",1===Z.length?"Are you sure you want to delete '".concat(null==(s=Z[0])?void 0:s.name,"'?"):"Are you sure you want to delete the selected ".concat(Z.length," quer").concat(Z.length>1?"ies":"y","?")]})}),(0,n.jsx)(eU.A,{size:"small",title:"Confirm to delete folder",confirmLabel:"Delete folder",confirmLabelLoading:"Deleting folder",loading:tm,visible:void 0!==el,variant:"destructive",onCancel:()=>ed(void 0),onConfirm:ty,alert:{title:"This action cannot be undone",description:"All SQL snippets within the folder will be permanently removed, and cannot be recovered."},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"SQLEditorNav.tsx",children:(0,n.jsxs)("p",{className:"text-sm",children:["Are you sure you want to delete the folder '",null==el?void 0:el.name,"'?"]})})]})},tt=()=>{let e=(0,c.useRouter)(),{profile:t}=(0,g.xc)(),a=(0,h.KT)(),{ref:M}=(0,m.g)(),C=(0,j.aP)(),[E,k]=(0,u.useState)(""),[L,P]=(0,u.useState)(!1),[A,_]=(0,x.M)(y.rS.SQL_EDITOR_SORT(null!=M?M:""),"inserted_at"),Q=(0,v.Nj)(),I=(0,r.d7)(E,500),D=(0,f.SE)(s.aG.CREATE,"user_content",{resource:{type:"sql",owner_id:null==t?void 0:t.id},subject:{id:null==t?void 0:t.id}}),T=()=>{if(!M)return console.error("Project ref is required");k(""),P(!1),C.addNewFolder({projectRef:M})},R=async()=>{if(!M)return console.error("Project ref is required");if(!a)return console.error("Project is required");if(!t)return console.error("Profile is required");if(!D)return(0,p.oR)("Your queries will not be saved as you do not have sufficient permissions");try{e.push("/project/".concat(M,"/sql/new?skip=true")),k(""),P(!1)}catch(e){p.oR.error("Failed to create new query: ".concat(e.message))}};return(0,u.useEffect)(()=>{P(I.length>0)},[I]),(0,n.jsxs)("div",{className:"h-full flex flex-col justify-between","data-sentry-component":"SQLEditorMenu","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-4 flex-grow",children:[(0,n.jsxs)("div",{className:"mt-4 mx-4 flex items-center justify-between gap-x-2",children:[(0,n.jsx)(N.a0,{className:"w-full p-0 gap-0","data-sentry-element":"InnerSideBarFilters","data-sentry-source-file":"SQLEditorMenu.tsx",children:(0,n.jsx)(N.RK,{name:"search-queries",placeholder:"Search queries...","aria-labelledby":"Search queries",value:E,onChange:e=>{let t=e.target.value;k(t),0===t.length&&P(!1)},onKeyDown:e=>{"Escape"===e.code&&(k(""),P(!1))},"data-sentry-element":"InnerSideBarFilterSearchInput","data-sentry-source-file":"SQLEditorMenu.tsx",children:L?(0,n.jsxs)(b.m_,{children:[(0,n.jsx)(b.k$,{className:"absolute right-1 top-[.4rem] md:top-[.3rem] transition-colors text-foreground-light hover:text-foreground",onClick:()=>{k(""),P(!1)},children:(0,n.jsx)(l.A,{size:18})}),(0,n.jsx)(b.ZI,{children:"Clear search"})]}):(0,n.jsxs)(N.i9,{value:A,onValueChange:e=>_(e),children:[(0,n.jsx)(N.Pl,{value:"name",children:"Alphabetical"},"name"),(0,n.jsx)(N.Pl,{value:"inserted_at",children:"Created At"},"inserted_at")]})})}),(0,n.jsxs)(S.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,n.jsx)(S.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"SQLEditorMenu.tsx",children:(0,n.jsx)(w.$,{type:"default",icon:(0,n.jsx)(i.A,{className:"text-foreground"}),className:"w-[26px]","data-sentry-element":"Button","data-sentry-source-file":"SQLEditorMenu.tsx"})}),(0,n.jsxs)(S.SQ,{align:"end",side:"bottom",className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,n.jsxs)(S._2,{className:"gap-x-2",onClick:()=>R(),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,n.jsx)(o.A,{size:14,"data-sentry-element":"FilePlus","data-sentry-source-file":"SQLEditorMenu.tsx"}),"Create a new snippet"]}),(0,n.jsxs)(S._2,{className:"gap-x-2",onClick:()=>T(),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"SQLEditorMenu.tsx",children:[(0,n.jsx)(d.A,{size:14,"data-sentry-element":"FolderPlus","data-sentry-source-file":"SQLEditorMenu.tsx"}),"Create a new folder"]})]})]})]}),L?(0,n.jsx)(W,{search:I}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(q,{}),(0,n.jsx)(te,{sort:A})]})]}),(0,n.jsx)("div",{className:"p-4 border-t sticky bottom-0 bg-studio",children:(0,n.jsx)(w.$,{block:!0,type:"default",onClick:()=>Q.setOnGoingQueriesPanelOpen(!0),"data-sentry-element":"Button","data-sentry-source-file":"SQLEditorMenu.tsx",children:"View running queries"})})]})}},58604:(e,t,a)=>{"use strict";a.d(t,{L:()=>c});var n=a(80263),s=a(33096),r=a(27321),l=a(64773),i=a(40435),o=a(52491),d=a(2);let c=e=>{var t,a,c;let{type:u,size:p=15,strokeWidth:m=1.5,isActive:f}=e;return"sql"===u?(0,n.jsx)(o.ty,{size:p,className:(0,d.cn)("transition-colors","fill-foreground-muted","group-aria-selected:fill-foreground","w-4 h-4","-ml-0.5"),strokeWidth:m}):u===s.z.TABLE?(0,n.jsx)(r.A,{size:p,strokeWidth:m,className:(0,d.cn)("text-foreground-muted group-hover:text-foreground-lighter group-aria-selected:text-foreground",f&&"text-foreground-light","transition-colors")}):"schema"===u?(0,n.jsx)(l.A,{size:p,strokeWidth:m}):u===s.z.VIEW?(0,n.jsx)(i.A,{size:p,strokeWidth:m,className:(0,d.cn)("text-foreground-muted group-hover:text-foreground-lighter",f&&"text-foreground-lighter","transition-colors")}):(0,n.jsx)("div",{className:(0,d.cn)("flex items-center justify-center text-xs h-4 w-4 rounded-[2px] font-bold",u===s.z.FOREIGN_TABLE&&"text-yellow-900 bg-yellow-500",u===s.z.MATERIALIZED_VIEW&&"text-purple-1000 bg-purple-500",u===s.z.PARTITIONED_TABLE&&"text-foreground-light bg-border-stronger"),"data-sentry-component":"EntityTypeIcon","data-sentry-source-file":"EntityTypeIcon.tsx",children:null==(c=Object.entries(s.z).find(e=>{let[,t]=e;return t===u}))||null==(a=c[0])||null==(t=a[0])?void 0:t.toUpperCase()})}},70813:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(47370).A)("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]])},73634:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(47370).A)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]])},75125:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var n=a(80263),s=a(46115),r=a(53239),l=a(77690);let i=e=>{var t,a,i;let{defaultActiveId:o,activeId:d,type:c="pills",size:u="tiny",block:p,onChange:m,onClick:f,scrollable:x,wrappable:h,addOnBefore:y,addOnAfter:g,listClassNames:v,baseClassNames:j,refs:b,children:S}=e,w=r.Children.toArray(S),[N,M]=(0,r.useState)(null!=(i=null!=d?d:o)?i:null==w||null==(a=w[0])||null==(t=a.props)?void 0:t.id);(0,r.useMemo)(()=>{d&&d!==N&&M(d)},[d]);let q=(0,l.A)("tabs");function C(e){null==f||f(e),e!==N&&(null==m||m(e),M(e))}let E=[q[c].list];return x&&E.push(q.scrollable),h&&E.push(q.wrappable),v&&E.push(v),(0,n.jsxs)(s.bL,{value:N,className:[q.base,j].join(" "),ref:null==b?void 0:b.base,"data-sentry-element":"unknown","data-sentry-component":"Tabs","data-sentry-source-file":"Tabs.tsx",children:[(0,n.jsxs)(s.B8,{className:E.join(" "),ref:null==b?void 0:b.list,"data-sentry-element":"unknown","data-sentry-source-file":"Tabs.tsx",children:[y,w.map(e=>{let t=N===e.props.id,a=[q[c].base,q.size[u]];return t?a.push(q[c].active):a.push(q[c].inactive),p&&a.push(q.block),(0,n.jsxs)(s.l9,{onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),C(e.props.id))},onClick:()=>C(e.props.id),value:e.props.id,className:a.join(" "),children:[e.props.icon,(0,n.jsx)("span",{children:e.props.label}),e.props.iconRight]},"".concat(e.props.id,"-tab-button"))}),g]}),w]})};i.Panel=e=>{let{children:t,id:a,className:r}=e,i=(0,l.A)("tabs");return(0,n.jsx)(s.UC,{value:a,className:[i.content,r].join(" "),"data-sentry-element":"unknown","data-sentry-component":"Panel","data-sentry-source-file":"Tabs.tsx",children:t})};let o=i},76316:(e,t,a)=>{var n=a(15196),s=a(99851),r=a(15743),l=a(4576);e.exports=function(e,t,a){return(e=r(e),void 0===(t=a?void 0:t))?s(e)?l(e):n(e):e.match(t)||[]}},78960:(e,t,a)=>{"use strict";a.d(t,{g:()=>l,w:()=>r});var n=a(10497),s=a(79175);let r=e=>{var t,a;let{ref:r,schemas:l,entities:i}=e,o=i.map(e=>(0,s.lW)(e.type,{id:e.id})),d=(0,n.PR)(r),c=[];for(let e of l)c.push(...null==d||null==(t=d.items)?void 0:t.filter(t=>{var a;return(null==(a=t.metadata)?void 0:a.schema)===e}).map(e=>e.id));let u=[...c.filter(e=>!o.includes(e))];(0,n.Yg)(r,u);let p=(0,s.IT)(r),m=[];for(let e of l)m.push(...null==p||null==(a=p.openTabs)?void 0:a.filter(t=>{var a;return(null==(a=p.tabsMap[t].metadata)?void 0:a.schema)===e}));let f=[...m.filter(e=>!e.startsWith("sql")&&!e.startsWith("schema")&&!o.includes(e))];(0,s.Xn)(r,f),p.openTabs.map(e=>p.tabsMap[e]).filter(e=>{var t;return null==(t=s.qm.table)?void 0:t.includes(e.type)}).forEach(e=>{let t=null==i?void 0:i.find(t=>{var a;return(null==(a=e.metadata)?void 0:a.tableId)===t.id});t&&t.name!==e.label&&(0,s.Nt)(r,e.id,{label:t.name})})},l=e=>{let{ref:t,snippets:a}=e,r=[...a.filter(e=>"sql"===e.type).map(e=>(0,s.lW)("sql",{id:e.id})),"sql-templates","sql-quickstarts"],l=(0,s.IT)(t),i=l.openTabs.filter(e=>e.startsWith("sql")&&!r.includes(e));(0,s.Xn)(t,i);let o=(0,n.Nq)(t,"sql");(0,n.Yg)(t,o?o.filter(e=>!r.includes(e.id)).map(e=>e.id):[]),l.openTabs.map(e=>l.tabsMap[e]).filter(e=>{var t;return null==(t=s.qm.sql)?void 0:t.includes(e.type)}).forEach(e=>{let n=null==a?void 0:a.find(t=>{var a;return(null==(a=e.metadata)?void 0:a.sqlId)===t.id});n&&n.name!==e.label&&(0,s.Nt)(t,e.id,{label:n.name})})}},81737:(e,t,a)=>{"use strict";a.d(t,{$:()=>d});var n=a(32144),s=a(80251),r=a(73969),l=a(3807),i=a(51696);async function o(e,t){let{projectRef:a,ids:n}=e,{data:s,error:r}=await (0,l.yH)("/platform/projects/{ref}/content",{headers:{Version:"2"},params:{path:{ref:a},query:{ids:n}},signal:t});return r&&(0,l.H4)(r),s.map(e=>e.id)}let d=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,n.jE)();return(0,s.n)(e=>o(e),{async onSuccess(t,a,n){let{projectRef:s}=a;await l.invalidateQueries(i.M.allContentLists(s)),await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?r.oR.error("Failed to delete contents: ".concat(e.message)):t(e,a,n)},...a})}},91284:(e,t,a)=>{"use strict";a.d(t,{A:()=>I});var n=a(80263),s=a(53434),r=a.n(s),l=a(94786),i=a(6065),o=a(53239),d=a(73969),c=a(98474),u=a(71433),p=a(32144),m=a(80251),f=a(77570),x=a(63707);async function h(e){let{pid:t,projectRef:a,connectionString:n}=e,{result:s}=await (0,f.E)({projectRef:a,connectionString:n,sql:"select pg_terminate_backend(".concat(t,")")});return s}let y=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,p.jE)();return(0,m.n)(e=>h(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(x.B.ongoingQueries(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?d.oR.error("Failed to abort query: ".concat(e.message)):t(e,a,n)},...a})};var g=a(56947);let v=()=>"\nselect pid, query, query_start from pg_stat_activity where state = 'active' and datname = 'postgres';\n".trim();async function j(e,t){let{projectRef:a,connectionString:n}=e,s=v().trim(),{result:r}=await (0,f.E)({projectRef:a,connectionString:n,sql:s,queryKey:["ongoing-queries"]},t);return(null!=r?r:[]).filter(e=>!e.query.startsWith(s))}let b=function(e){let{projectRef:t,connectionString:a}=e,{enabled:n=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.I)(x.B.ongoingQueries(t),e=>{let{signal:n}=e;return j({projectRef:t,connectionString:a},n)},{enabled:n&&void 0!==t,...s})};var S=a(83634),w=a(45072),N=a(58897),M=a(33887),q=a(76828),C=a(16601),E=a(78873),k=a(2),L=a(3732),P=a(36212),A=a(10170),_=a(82489);let Q=()=>{let[e,t]=(0,w.W)({replace:!0}),{viewOngoingQueries:a}=(0,_.g)(),s=(0,S.KT)(),p=(0,M.RE)(),m=(0,A.qM)(),[f,x]=(0,o.useState)(),{data:h}=(0,u.Vh)({projectRef:null==s?void 0:s.ref}),g=(null!=h?h:[]).find(e=>e.identifier===p.selectedDatabaseId),{data:v,error:j,isError:Q,isLoading:I,isFetching:D,refetch:T}=b({projectRef:null==s?void 0:s.ref,connectionString:null==g?void 0:g.connectionString},{enabled:!N.pe||N.pe&&(null==g?void 0:g.connectionString)!==void 0,staleTime:5e3}),R=null!=v?v:[];(0,o.useEffect)(()=>{a&&(m.setOnGoingQueriesPanelOpen(!0),t({viewOngoingQueries:void 0}))},[a]);let{mutate:z,isLoading:O}=y({onSuccess:()=>{d.oR.success("Successfully aborted query (ID: ".concat(f,")")),x(void 0)}}),F=()=>{t({viewOngoingQueries:void 0}),m.setOnGoingQueriesPanelOpen(!1)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(q.cj,{open:m.ongoingQueriesPanelOpen,onOpenChange:()=>F(),"data-sentry-element":"Sheet","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:(0,n.jsxs)(q.h,{size:"lg","data-sentry-element":"SheetContent","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:[(0,n.jsxs)(q.Fm,{"data-sentry-element":"SheetHeader","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:[(0,n.jsxs)(q.qp,{className:"flex items-center gap-x-2","data-sentry-element":"SheetTitle","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:["Running queries on"," ",(null==g?void 0:g.identifier)===(null==s?void 0:s.ref)?"primary database":"read replica",(0,n.jsx)(C.$,{type:"default",className:"px-1.5",loading:I||D,icon:(0,n.jsx)(l.A,{}),onClick:()=>T(),"data-sentry-element":"Button","data-sentry-source-file":"OngoingQueriesPanel.tsx"})]}),(0,n.jsxs)(q.Qs,{"data-sentry-element":"SheetDescription","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:["There ",1===R.length?"is":"are"," ",(0,n.jsx)("span",{className:"text-foreground-light",children:R.length})," quer",1===R.length?"y":"ies"," currently running"," ",(null==g?void 0:g.identifier)!==(null==s?void 0:s.ref)?"on replica ".concat(null==g?void 0:g.identifier):""]})]}),(0,n.jsxs)("div",{className:"max-h-full h-full divide-y overflow-y-auto",children:[Q&&(0,n.jsx)("div",{className:"flex items-center justify-center h-full px-16",children:(0,n.jsx)(c.A,{subject:"Failed to retrieve ongoing queries",error:j})}),0===R.length&&(0,n.jsxs)("div",{className:"flex flex-col gap-y-2 items-center justify-center h-full text-foreground-light text-sm",children:[(0,n.jsxs)("span",{children:["No queries are currently running on the"," ",(null==g?void 0:g.identifier)!==(null==s?void 0:s.ref)?"read replica ".concat(null==g?void 0:g.identifier):(null!=h?h:[]).length>1?"primary database":"database"]}),(0,n.jsx)(C.$,{type:"default",loading:I||D,icon:(0,n.jsx)(l.A,{}),onClick:()=>T(),children:"Refresh"})]}),R.map(e=>(0,n.jsxs)(q.Xc,{className:"flex justify-between gap-x-4",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-y-2 w-full",children:[(0,n.jsx)(E.N,{hideLineNumbers:!0,value:e.query,language:"sql",className:(0,k.cn)("max-w-none max-h-52 w-full","!bg-transparent !py-3 !px-3.5 prose dark:prose-dark","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,n.jsxs)("p",{className:"text-foreground-light text-xs",children:["PID: ",e.pid]}),(0,n.jsx)("p",{className:"text-foreground-light text-xs",children:"•"}),(0,n.jsxs)("p",{className:"text-foreground-light text-xs",children:["Started since: ",r()(e.query_start).format("DD MMM YYYY HH:mm (ZZ)")]})]})]}),(0,n.jsxs)(L.m_,{children:[(0,n.jsx)(L.k$,{asChild:!0,children:(0,n.jsx)(C.$,{type:"warning",className:"px-1.5",icon:(0,n.jsx)(i.A,{}),onClick:()=>x(e.pid)})}),(0,n.jsx)(L.ZI,{side:"bottom",children:"Abort query"})]})]},e.pid))]})]})}),(0,n.jsx)(P.A,{loading:O,variant:"warning",title:"Confirm to abort this query? (ID: ".concat(f,")"),visible:void 0!==f,onCancel:()=>x(void 0),onConfirm:()=>{void 0!==f&&z({pid:f,projectRef:null==s?void 0:s.ref,connectionString:null==g?void 0:g.connectionString})},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"OngoingQueriesPanel.tsx",children:(0,n.jsx)("p",{className:"text-sm",children:"This will force the query to stop running."})})]})},I=(0,a(29730).r)(e=>{let{children:t}=e;return(0,n.jsxs)(n.Fragment,{children:[t,(0,n.jsx)(Q,{"data-sentry-element":"OngoingQueriesPanel","data-sentry-source-file":"SQLEditorLayout.tsx"})]})})},99851:e=>{var t=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;e.exports=function(e){return t.test(e)}},99951:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(47370).A)("FilePlus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]])}}]);