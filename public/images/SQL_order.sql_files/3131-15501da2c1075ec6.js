!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d1fd2d7e-e3d7-4de8-9ad7-7a63a524db89",e._sentryDebugIdIdentifier="sentry-dbid-d1fd2d7e-e3d7-4de8-9ad7-7a63a524db89")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3131],{783:(e,t,s)=>{s.d(t,{aq:()=>d});var a=s(17702),n=s(77570),r=s(83634),l=s(58897),i=s(67849);let o=e=>{let{page:t=0,verified:s,keywords:a,providers:n,sort:r,order:l}=e,i=[];if(a&&""!==a){let e=a.replaceAll("'","''");i.push("id::text like '%".concat(e,"%' or email like '%").concat(e,"%' or phone like '%").concat(e,"%'"))}"verified"===s?i.push("email_confirmed_at IS NOT NULL or phone_confirmed_at IS NOT NULL"):"anonymous"===s?i.push("is_anonymous is true"):"unverified"===s&&i.push("email_confirmed_at IS NULL AND phone_confirmed_at IS NULL"),n&&n.length>0&&(n.includes("saml 2.0")?i.push("(select jsonb_agg(case when value ~ '^sso' then 'sso' else value end) from jsonb_array_elements_text((raw_app_meta_data ->> 'providers')::jsonb)) ?| array[".concat(n.map(e=>"saml 2.0"===e?"'sso'":"'".concat(e,"'")).join(", "),"]").trim()):i.push("(raw_app_meta_data->>'providers')::jsonb ?| array[".concat(n.map(e=>"'".concat(e,"'")).join(", "),"]")));let o=i.map(e=>"(".concat(e,")")).join(" and ");return"".concat("\n  select *, coalesce((select array_agg(distinct i.provider) from auth.identities i where i.user_id = auth.users.id), '{}'::text[]) as providers from auth.users\n  ".trim()).concat(i.length>0?" where ".concat(o):"",' order by "').concat(null!=r?r:"created_at",'" ').concat(null!=l?l:"desc"," nulls last limit ").concat(50," offset ").concat(50*t,";")},d=function(e){let{projectRef:t,connectionString:s,keywords:d,filter:c,providers:u,sort:m,order:x}=e,{enabled:h=!0,...f}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=(0,r.KT)(),v=(null==p?void 0:p.status)===l.BU.ACTIVE_HEALTHY;return(0,a.q)(i.Z.usersInfinite(t,{keywords:d,filter:c,providers:u,sort:m,order:x}),e=>{let{signal:a,pageParam:r}=e;return(0,n.E)({projectRef:t,connectionString:s,sql:o({page:r,verified:c,keywords:d,providers:u,sort:null!=m?m:"created_at",order:null!=x?x:"desc"}),queryKey:i.Z.usersInfinite(t)},a)},{enabled:h&&void 0!==t&&v,getNextPageParam(e,t){let s=t.length;if(e.result.length>=50)return s},...f})}},28071:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(80263),n=s(5219),r=s(10170),l=s(16601);let i=e=>{let{section:t}=e,s=(0,r.qM)();return(0,a.jsx)(l.$,{size:"tiny",type:"default",onClick:()=>{t&&s.setActiveDocsSection(t),s.setShowProjectApiDocs(!0)},icon:(0,a.jsx)(n.A,{strokeWidth:1.5,className:"text-foreground-muted"}),"data-sentry-element":"Button","data-sentry-component":"APIDocsButton","data-sentry-source-file":"APIDocsButton.tsx",children:"API Docs"})}},28349:(e,t,s)=>{s.d(t,{j:()=>k,o:()=>M});var a=s(80263),n=s(13947),r=s(23278),l=s(53239),i=s(79210),o=s(16601),d=s(93479),c=s(2),u=s(49189),m=s(52750),x=s(94786),h=s(66452),f=s(63320),p=s.n(f),v=s(82489),y=s(66933),g=s(17234),j=s(21355),b=s(16580),w=s(55739),_=s(82942),N=s(47781),C=s(66492),S=s(79319),U=s(66001);let A=e=>{let{user:t}=e,{ref:s}=(0,v.g)(),{filters:n,setFilters:r}=(0,U.B)(),{logData:i,isSuccess:d,isLoading:u,refresh:m}=(0,j.A)({projectRef:s,table:y.eV.auth,filterOverride:{search_query:t.id},limit:5});return(0,l.useEffect)(()=>{t.id&&r({...n,search_query:t.id})},[t.id]),(0,a.jsxs)("div",{"data-sentry-component":"UserLogs","data-sentry-source-file":"UserLogs.tsx",children:[(0,a.jsx)(C.x,{user:t,"data-sentry-element":"UserHeader","data-sentry-source-file":"UserLogs.tsx"}),(0,a.jsx)(b.w,{"data-sentry-element":"Separator","data-sentry-source-file":"UserLogs.tsx"}),(0,a.jsxs)("div",{className:(0,c.cn)("flex flex-col gap-y-3",k),children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:"Authentication logs"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Latest logs from authentication for this user in the past hour"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o.$,{type:"status_code"in n?"default":"secondary",className:"rounded-r-none border-r-0",disabled:u,onClick:()=>r({search_query:t.id}),"data-sentry-element":"Button","data-sentry-source-file":"UserLogs.tsx",children:"Show all"}),(0,a.jsx)("div",{className:"border-button border border-l-0 py-3"}),(0,a.jsx)(o.$,{type:"status_code"in n?"secondary":"default",className:"rounded-l-none border-l-0",disabled:u,onClick:()=>r({search_query:t.id,status_code:{client_error:!0,server_error:!0}}),"data-sentry-element":"Button","data-sentry-source-file":"UserLogs.tsx",children:"Error only"})]}),(0,a.jsx)(o.$,{type:"default",loading:u,disabled:u,icon:(0,a.jsx)(x.A,{}),onClick:()=>m(),"data-sentry-element":"Button","data-sentry-source-file":"UserLogs.tsx",children:"Refresh"})]}),u&&!d?(0,a.jsx)(g.y,{}):0===i.length?(0,a.jsx)(_.Z,{type:"note",title:"No authentication logs available for this user",description:"Auth events such as logging in will be shown here"}):(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"border border-b-0 rounded-t-md divide-y overflow-hidden",children:i.map(e=>{var t;let n=(null!=(t=e.status)?t:"-").toString(),r=n.startsWith("4"),l=n.startsWith("5");return(0,a.jsxs)("div",{className:"flex items-center transition font-mono px-2 py-1.5 bg-surface-100 divide-x",children:[(0,a.jsx)("p",{className:"text-xs text-foreground-light min-w-[125px] w-[125px] px-1",children:(0,a.jsx)(N.T,{utcTimestamp:e.timestamp/1e3})}),(0,a.jsx)("div",{className:"flex items-center text-xs text-foreground-light h-[22px] min-w-[70px] w-[70px] px-2",children:(0,a.jsxs)("div",{className:(0,c.cn)("flex items-center justify-center gap-x-1",!!e.status&&"border px-1 py-0.5 rounded",r?"text-warning border-warning bg-warning-300":l?"text-destructive border-destructive bg-destructive-300":""),children:[(r||l)&&(0,a.jsx)(w.HV,{hideBackground:!0,className:(0,c.cn)(r&&"text-warning-600")}),n]})}),(0,a.jsxs)("p",{className:"group relative flex items-center py-1.5 text-xs text-foreground-light px-2 truncate w-full",children:["".concat(e.path," | ").concat(e.msg),(0,a.jsx)(S.G,{type:"outline",asChild:!0,tooltip:{content:{text:"Open in logs"}},className:"px-1.5 absolute right-0 top-0 opacity-0 group-hover:opacity-100 transition bg-background focus-visible:opacity-100",children:(0,a.jsx)(p(),{href:"/project/".concat(s,"/logs/auth-logs?log=").concat(e.id),children:(0,a.jsx)(h.A,{size:"12",className:"text-foreground-light"})})})]})]},e.id)})}),(0,a.jsx)(o.$,{block:!0,asChild:!0,type:"outline",className:"transition rounded-t-none text-foreground-light hover:text-foreground",children:(0,a.jsx)(p(),{href:"/project/".concat(s,"/logs/auth-logs?s=").concat(t.id),children:"See more logs"})})]})]})]})},k="px-5 py-5",M=e=>{let{selectedUser:t,onClose:s}=e,[x,h]=(0,l.useState)("overview"),[f,p]=(0,l.useState)(""),v=t?Object.entries(t).filter(e=>{let[t,s]=e;return t.toLowerCase().includes(f.toLowerCase())||"string"==typeof s&&s.toLowerCase().includes(f.toLowerCase())}).reduce((e,t)=>{let[s,a]=t;return void 0!==a&&(e[s]=a),e},{}):{};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.WM,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"UserPanel.tsx"}),(0,a.jsxs)(i.wV,{defaultSize:30,maxSize:45,minSize:30,className:"bg-studio border-t","data-sentry-element":"ResizablePanel","data-sentry-source-file":"UserPanel.tsx",children:[(0,a.jsx)(o.$,{type:"text",className:"absolute top-3 right-3 px-1",icon:(0,a.jsx)(r.A,{}),onClick:()=>s(),"data-sentry-element":"Button","data-sentry-source-file":"UserPanel.tsx"}),(0,a.jsxs)(d.tU,{value:x,className:"flex flex-col h-full",onValueChange:e=>h(e),"data-sentry-element":"Tabs_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:[(0,a.jsxs)(d.j7,{className:"px-5 flex gap-x-4 min-h-[46px]","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:[(0,a.jsx)(d.Xi,{value:"overview",className:"px-0 pb-0 h-full text-xs  data-[state=active]:bg-transparent !shadow-none","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:"Overview"}),(0,a.jsx)(d.Xi,{value:"logs",className:"px-0 pb-0 h-full text-xs data-[state=active]:bg-transparent !shadow-none","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:"Logs"}),(0,a.jsx)(d.Xi,{value:"raw",className:"px-0 pb-0 h-full text-xs data-[state=active]:bg-transparent !shadow-none","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:"Raw JSON"})]}),(0,a.jsx)(d.av,{value:"overview",className:(0,c.cn)("mt-0 flex-grow min-h-0 overflow-y-auto"),"data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:t&&(0,a.jsx)(m.nz,{user:t,onDeleteSuccess:s})}),(0,a.jsx)(d.av,{value:"logs",className:(0,c.cn)("mt-0 flex-grow min-h-0 overflow-y-auto"),"data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:t&&(0,a.jsx)(A,{user:t})}),(0,a.jsxs)(d.av,{value:"raw",className:(0,c.cn)("mt-0 flex-grow min-h-0 overflow-y-auto",k),"data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UserPanel.tsx",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(u.p,{autoFocus:!0,type:"text",placeholder:"Filter...",value:f,onChange:e=>p(e.target.value),className:"mr-2","data-sentry-element":"Input_Shadcn_","data-sentry-source-file":"UserPanel.tsx"}),(0,a.jsx)(o.$,{type:"text",disabled:!f,onClick:()=>p(""),className:"text-xs","data-sentry-element":"Button","data-sentry-source-file":"UserPanel.tsx",children:"Clear"})]}),(0,a.jsx)(n.X,{className:"javascript","data-sentry-element":"SimpleCodeBlock","data-sentry-source-file":"UserPanel.tsx",children:JSON.stringify(v,null,2)})]})]})]})]})}},52750:(e,t,s)=>{s.d(t,{dS:()=>eo,$U:()=>ei,nz:()=>el});var a=s(80263),n=s(60045),r=s(53434),l=s.n(r),i=s(64238),o=s(23141),d=s(51551),c=s(71391),u=s(94328),m=s(23278),x=s(87467),h=s(63320),f=s.n(h),p=s(53239),v=s(73969),y=s(82489),g=s(79319),j=s(2081),b=s(86137),w=s(80251),_=s(3807);async function N(e){let{projectRef:t,userId:s}=e,{data:a,error:n}=await (0,_.yH)("/platform/auth/{ref}/users/{id}/factors",{params:{path:{ref:t,id:s}}});return n&&(0,_.H4)(n),a}let C=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,w.n)(e=>N(e),{async onSuccess(t,s,a){await (null==e?void 0:e(t,s,a))},async onError(e,s,a){void 0===t?v.oR.error("Failed to delete the user's MFA factors: ".concat(e.message)):t(e,s,a)},...s})};async function S(e){let{projectRef:t,user:s}=e,{data:a,error:n}=await (0,_.bE)("/platform/auth/{ref}/recover",{params:{path:{ref:t}},body:{email:s.email}});return n&&(0,_.H4)(n),a}let U=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,w.n)(e=>S(e),{async onSuccess(t,s,a){await (null==e?void 0:e(t,s,a))},async onError(e,s,a){void 0===t?v.oR.error("Failed to reset user password: ".concat(e.message)):t(e,s,a)},...s})};async function A(e){let{projectRef:t,user:s}=e,{data:a,error:n}=await (0,_.bE)("/platform/auth/{ref}/magiclink",{params:{path:{ref:t}},body:{email:s.email}});return n&&(0,_.H4)(n),a}let k=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,w.n)(e=>A(e),{async onSuccess(t,s,a){await (null==e?void 0:e(t,s,a))},async onError(e,s,a){void 0===t?v.oR.error("Failed to send magic link: ".concat(e.message)):t(e,s,a)},...s})};async function M(e){let{projectRef:t,user:s}=e,{data:a,error:n}=await (0,_.bE)("/platform/auth/{ref}/otp",{params:{path:{ref:t}},body:{phone:s.phone}});return n&&(0,_.H4)(n),a}let D=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,w.n)(e=>M(e),{async onSuccess(t,s,a){await (null==e?void 0:e(t,s,a))},async onError(e,s,a){void 0===t?v.oR.error("Failed to send magic link: ".concat(e.message)):t(e,s,a)},...s})};var L=s(32144),T=s(67849);async function E(e){let{projectRef:t,userId:s,banDuration:a}=e,{data:n,error:r}=await (0,_.F6)("/platform/auth/{ref}/users/{id}",{params:{path:{ref:t,id:s}},body:{ban_duration:"number"==typeof a?"".concat(a,"h"):a}});return r&&(0,_.H4)(r),n}let R=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,L.jE)();return(0,w.n)(e=>E(e),{async onSuccess(t,s,n){let{projectRef:r}=s;await a.invalidateQueries(T.Z.usersInfinite(r)),await (null==e?void 0:e(t,s,n))},async onError(e,s,a){void 0===t?v.oR.error("Failed to update user: ".concat(e.message)):t(e,s,a)},...s})};var z=s(65904),I=s(58897),F=s(90206),P=s(2),O=s(16580),H=s(16601),B=s(82942),V=s(36212),$=s(99696),W=s(32981),Y=s(87494),Z=s(39353),q=s(55335),G=s(85669),X=s(49189),K=s(79295),Q=s(27787);let J=e=>{let{visible:t,user:s,onClose:n}=e,{ref:r}=(0,y.g)(),{mutate:i,isLoading:o}=R({onSuccess:(e,t)=>{let s=l()().add(Number(t.banDuration),"hours").format("DD MMM YYYY HH:mm (ZZ)");v.oR.success("User banned successfully until ".concat(s)),n()}}),d=Z.Ik({value:Z.Yj().min(1,{message:"Please provide a duration"}),unit:Z.k5(["hours","days"])}),c={value:"24",unit:"hours"},u=(0,Y.mN)({mode:"onBlur",reValidateMode:"onChange",resolver:(0,W.u)(d),defaultValues:c}),{value:m,unit:x}=u.watch(),h=l()().add(Number(m),x).format("DD MMM YYYY HH:mm (ZZ)");return(0,p.useEffect)(()=>{t&&u.reset(c)},[t]),(0,a.jsx)(q.A,{hideFooter:!0,visible:t,size:"small",header:"Confirm to ban user",onCancel:()=>n(),"data-sentry-element":"Modal","data-sentry-component":"BanUserModal","data-sentry-source-file":"BanUserModal.tsx",children:(0,a.jsx)(G.lV,{...u,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"BanUserModal.tsx",children:(0,a.jsxs)("form",{onSubmit:u.handleSubmit(e=>{if(void 0===r)return console.error("Project ref is required");if(void 0===s.id)return v.oR.error("Failed to ban user: User ID not found");let t="hours"===e.unit?Number(e.value):24*Number(e.value);i({projectRef:r,userId:s.id,banDuration:t})}),children:[(0,a.jsxs)(q.A.Content,{className:"flex flex-col gap-y-3","data-sentry-element":"unknown","data-sentry-source-file":"BanUserModal.tsx",children:[(0,a.jsx)("p",{className:"text-sm",children:"This will revoke the user's access to your project and prevent them from logging in for a specified duration."}),(0,a.jsxs)("div",{className:"flex items-start gap-x-2 [&>div:first-child]:flex-grow",children:[(0,a.jsx)(G.zB,{control:u.control,name:"value",render:e=>{let{field:t}=e;return(0,a.jsx)(Q.M,{className:"[&>div>div]:mt-0",label:"Set a ban duration",children:(0,a.jsx)(G.MJ,{children:(0,a.jsx)(X.p,{...t})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"BanUserModal.tsx"}),(0,a.jsx)(G.zB,{control:u.control,name:"unit",render:e=>{let{field:t}=e;return(0,a.jsx)(Q.M,{className:"[&>div>div]:mt-0 mt-[33px]",children:(0,a.jsx)(G.MJ,{children:(0,a.jsxs)(K.l6,{...t,value:t.value,onValueChange:e=>u.setValue("unit",e),children:[(0,a.jsx)(K.bq,{className:"capitalize w-24",children:t.value}),(0,a.jsxs)(K.gC,{children:[(0,a.jsx)(K.eb,{value:"hours",children:"Hours"}),(0,a.jsx)(K.eb,{value:"days",children:"Days"})]})]})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"BanUserModal.tsx"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-foreground-lighter",children:"This user will not be able to log in until:"}),(0,a.jsx)("p",{className:(0,P.cn)("text-sm",!m&&"text-foreground-light"),children:m?h:"Invalid duration set"})]})]}),(0,a.jsx)(O.w,{"data-sentry-element":"Separator","data-sentry-source-file":"BanUserModal.tsx"}),(0,a.jsxs)(q.A.Content,{className:"flex justify-end gap-2","data-sentry-element":"unknown","data-sentry-source-file":"BanUserModal.tsx",children:[(0,a.jsx)(H.$,{type:"default",disabled:o,onClick:()=>n(),"data-sentry-element":"Button","data-sentry-source-file":"BanUserModal.tsx",children:"Cancel"}),(0,a.jsx)(H.$,{type:"warning",htmlType:"submit",loading:o,"data-sentry-element":"Button","data-sentry-source-file":"BanUserModal.tsx",children:"Confirm ban"})]})]})})})};var ee=s(59657),et=s(66492),es=s(28349),ea=s(76671);let en="DD MMM, YYYY HH:mm",er=(0,P.cn)("bg-surface-100 border-default text-foreground flex items-center justify-between","gap-x-4 border px-5 py-4 text-sm first:rounded-tr first:rounded-tl last:rounded-br last:rounded-bl"),el=e=>{var t,s,r,m,x;let{user:h,onDeleteSuccess:g}=e,{ref:j}=(0,y.g)(),w=null!==h.email,_=null!==h.phone,N=null!==h.banned_until,S=(null!=(s=null==(t=h.raw_app_meta_data)?void 0:t.providers)?s:[]).map(e=>({name:e.startsWith("sso")?"SAML":e,icon:"email"===e?"".concat(I.o2,"/img/icons/email-icon2.svg"):ea.FI[e]?"".concat(I.o2,"/img/icons/").concat(ea.FI[e],".svg"):void 0})),A=(0,z.SE)(n.aG.AUTH_EXECUTE,"*"),M=(0,z.SE)(n.aG.AUTH_EXECUTE,"send_magic_link"),L=(0,z.SE)(n.aG.AUTH_EXECUTE,"send_recovery"),T=(0,z.SE)(n.aG.AUTH_EXECUTE,"send_otp"),E=(0,z.SE)(n.aG.TENANT_SQL_DELETE,"auth.users"),W=(0,z.SE)(n.aG.TENANT_SQL_DELETE,"auth.mfa_factors"),[Y,Z]=(0,p.useState)(),[q,G]=(0,p.useState)(!1),[X,K]=(0,p.useState)(!1),[Q,el]=(0,p.useState)(!1),[ed,ec]=(0,p.useState)(!1),{data:eu}=(0,b.op)({projectRef:j}),em=null!=(r=null==eu?void 0:eu.MAILER_OTP_EXP)?r:0,ex=Math.floor(em/60),eh=Math.floor(em%60),ef="".concat(em>60?"".concat(ex," minute").concat(ex>1?"s":""," ").concat(eh>0?"and":""," "):"").concat(eh>0?"".concat(eh," second").concat(eh>1?"s":""):""),{mutate:ep,isLoading:ev}=U({onSuccess:(e,t)=>{Z("send_recovery"),v.oR.success("Sent password recovery to ".concat(t.user.email))},onError:e=>{v.oR.error("Failed to send password recovery: ".concat(e.message))}}),{mutate:ey,isLoading:eg}=k({onSuccess:(e,t)=>{Z("send_magic_link"),v.oR.success("Sent magic link to ".concat(t.user.email))},onError:e=>{v.oR.error("Failed to send magic link: ".concat(e.message))}}),{mutate:ej,isLoading:eb}=D({onSuccess:(e,t)=>{Z("send_otp"),v.oR.success("Sent OTP to ".concat(t.user.phone))},onError:e=>{v.oR.error("Failed to send OTP: ".concat(e.message))}}),{mutate:ew}=C({onSuccess:()=>{v.oR.success("Successfully deleted the user's factors"),ec(!1)}}),{mutate:e_,isLoading:eN}=R({onSuccess:()=>{v.oR.success("Successfully unbanned user"),K(!1)}}),eC=async()=>{if(await (0,F.wR)(200),!j)return console.error("Project ref is required");ew({projectRef:j,userId:h.id})},eS=()=>void 0===j?console.error("Project ref is required"):void 0===h.id?v.oR.error("Failed to ban user: User ID not found"):void e_({projectRef:j,userId:h.id,banDuration:"none"});return(0,p.useEffect)(()=>{if(void 0!==Y){let e=setTimeout(()=>Z(void 0),5e3);return()=>clearTimeout(e)}},[Y]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(et.x,{user:h,"data-sentry-element":"UserHeader","data-sentry-source-file":"UserOverview.tsx"}),N?(0,a.jsx)(B.Z,{type:"warning",label:"User banned until ".concat(l()(h.banned_until).format(en)),className:"border-r-0 border-l-0 rounded-none -mt-px [&_svg]:ml-0.5 mb-0"}):(0,a.jsx)(O.w,{}),(0,a.jsxs)("div",{className:(0,P.cn)("flex flex-col gap-y-1",es.j),children:[(0,a.jsx)(ei,{property:"User UID",value:h.id,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsx)(ei,{property:"Created at",value:h.created_at?l()(h.created_at).format(en):void 0,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsx)(ei,{property:"Updated at",value:h.updated_at?l()(h.updated_at).format(en):void 0,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsx)(ei,{property:"Invited at",value:h.invited_at,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsx)(ei,{property:"Confirmation sent at",value:h.confirmation_sent_at,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsx)(ei,{property:"Confirmed at",value:h.confirmed_at?l()(h.confirmed_at).format(en):void 0,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsx)(ei,{property:"Last signed in",value:h.last_sign_in_at?l()(h.last_sign_in_at).format(en):void 0,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsx)(ei,{property:"SSO",value:h.is_sso_user,"data-sentry-element":"RowData","data-sentry-source-file":"UserOverview.tsx"})]}),(0,a.jsxs)("div",{className:(0,P.cn)("flex flex-col !pt-0",es.j),children:[(0,a.jsx)("p",{children:"Provider Information"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"The user has the following providers"})]}),(0,a.jsx)("div",{className:(0,P.cn)("flex flex-col -space-y-1 !pt-0",es.j),children:S.map(e=>{var t,s,n;let r=$.S5.find(t=>"key"in t&&t.key===e.name||t.title.toLowerCase()===e.name),l=Object.keys(null!=(t=null==r?void 0:r.properties)?t:{}).find(e=>e.toLowerCase().endsWith("_enabled")),o="email"===e.name?e.name.toLowerCase():null!=(s=null==r?void 0:r.title)?s:e.name,d=null!=(n=null==eu?void 0:eu[l])&&n;return(0,a.jsxs)("div",{className:(0,P.cn)(er,"items-start justify-start"),children:[e.icon&&(0,a.jsx)("img",{width:16,src:e.icon,alt:"".concat(e.name," auth icon"),className:(0,P.cn)("mt-1.5","github"===e.name?"dark:invert":"")}),(0,a.jsxs)("div",{className:"flex-grow mt-0.5",children:[(0,a.jsx)("p",{className:"capitalize",children:o}),(0,a.jsxs)("p",{className:"text-xs text-foreground-light",children:["Signed in with a ",o," account via"," ","SAML"===o?"SSO":"OAuth"]}),(0,a.jsx)(H.$,{asChild:!0,type:"default",className:"mt-2",children:(0,a.jsxs)(f(),{href:"/project/".concat(j,"/auth/providers?provider=").concat("SAML"===e.name?"SAML 2.0":e.name),children:["Configure ",o," provider"]})})]}),d?(0,a.jsxs)("div",{className:"flex items-center gap-1 rounded-full border border-brand-400 bg-brand-200 py-1 px-1 text-xs text-brand",children:[(0,a.jsx)("span",{className:"rounded-full bg-brand p-0.5 text-xs text-brand-200",children:(0,a.jsx)(i.A,{strokeWidth:2,size:12})}),(0,a.jsx)("span",{className:"px-1",children:"Enabled"})]}):(0,a.jsx)("div",{className:"rounded-md border border-strong bg-surface-100 py-1 px-3 text-xs text-foreground-lighter",children:"Disabled"})]},e.name)})}),(0,a.jsx)(O.w,{"data-sentry-element":"Separator","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsxs)("div",{className:(0,P.cn)("flex flex-col -space-y-1",es.j),children:[w&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eo,{title:"Reset password",description:"Send a password recovery email to the user",button:{icon:(0,a.jsx)(o.A,{}),text:"Send password recovery",isLoading:ev,disabled:!L,onClick:()=>{j&&ep({projectRef:j,user:h})}},success:"send_recovery"===Y?{title:"Password recovery sent",description:"The link in the email is valid for ".concat(ef)}:void 0}),(0,a.jsx)(eo,{title:"Send magic link",description:"Passwordless login via email for the user",button:{icon:(0,a.jsx)(o.A,{}),text:"Send magic link",isLoading:eg,disabled:!M,onClick:()=>{j&&ey({projectRef:j,user:h})}},success:"send_magic_link"===Y?{title:"Magic link sent",description:"The link in the email is valid for ".concat(ef)}:void 0})]}),_&&(0,a.jsx)(eo,{title:"Send OTP",description:"Passwordless login via phone for the user",button:{icon:(0,a.jsx)(o.A,{}),text:"Send OTP",isLoading:eb,disabled:!T,onClick:()=>{j&&ej({projectRef:j,user:h})}},success:"send_otp"===Y?{title:"OTP sent",description:"The link in the OTP SMS is valid for ".concat(ef)}:void 0})]}),(0,a.jsx)(O.w,{"data-sentry-element":"Separator","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsxs)("div",{className:(0,P.cn)("flex flex-col",es.j),children:[(0,a.jsx)("p",{children:"Danger zone"}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Be wary of the following features as they cannot be undone."})]}),(0,a.jsxs)("div",{className:(0,P.cn)("flex flex-col -space-y-1 !pt-0",es.j),children:[(0,a.jsx)(eo,{title:"Remove MFA factors",description:"Removes all MFA factors associated with the user",button:{icon:(0,a.jsx)(d.A,{}),text:"Remove MFA factors",disabled:!W,onClick:()=>ec(!0)},className:"!bg border-destructive-400","data-sentry-element":"RowAction","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsx)(eo,{title:N?"User is banned until ".concat(l()(h.banned_until).format(en)):"Ban user",description:N?"User has no access to the project until after this date":"Revoke access to the project for a set duration",button:{icon:(0,a.jsx)(c.A,{}),text:N?"Unban user":"Ban user",disabled:!A,onClick:()=>{N?K(!0):G(!0)}},className:"!bg border-destructive-400","data-sentry-element":"RowAction","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsx)(eo,{title:"Delete user",description:"User will no longer have access to the project",button:{icon:(0,a.jsx)(u.A,{}),type:"danger",text:"Delete user",disabled:!E,onClick:()=>el(!0)},className:"!bg border-destructive-400","data-sentry-element":"RowAction","data-sentry-source-file":"UserOverview.tsx"})]})]}),(0,a.jsx)(ee.i,{visible:Q,selectedUser:h,onClose:()=>el(!1),onDeleteSuccess:()=>{el(!1),g()},"data-sentry-element":"DeleteUserModal","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsx)(V.A,{visible:ed,variant:"warning",title:"Confirm to remove MFA factors",confirmLabel:"Remove factors",confirmLabelLoading:"Removing",onCancel:()=>ec(!1),onConfirm:()=>eC(),alert:{base:{variant:"warning"},title:"Removing MFA factors will drop the user's authentication assurance level (AAL) to AAL1",description:"Note that this does not sign the user out"},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"UserOverview.tsx",children:(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Are you sure you want to remove the MFA factors for the user"," ",(0,a.jsx)("span",{className:"text-foreground",children:null!=(x=null!=(m=h.email)?m:h.phone)?x:"this user"}),"?"]})}),(0,a.jsx)(J,{visible:q,user:h,onClose:()=>G(!1),"data-sentry-element":"BanUserModal","data-sentry-source-file":"UserOverview.tsx"}),(0,a.jsx)(V.A,{variant:"warning",visible:X,title:"Confirm to unban user",loading:eN,confirmLabel:"Unban user",confirmLabelLoading:"Unbanning",onCancel:()=>K(!1),onConfirm:()=>eS(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"UserOverview.tsx",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"The user will have access to your project again once unbanned. Are you sure you want to unban this user?"})})]})},ei=e=>{let{property:t,value:s}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2 group justify-between",children:[(0,a.jsx)("p",{className:" text-foreground-lighter text-xs",children:t}),"boolean"==typeof s?(0,a.jsx)("div",{className:"h-[26px] flex items-center justify-center min-w-[70px]",children:s?(0,a.jsx)("div",{className:"rounded-full w-4 h-4 dark:bg-white bg-black flex items-center justify-center",children:(0,a.jsx)(i.A,{size:10,className:"text-contrast",strokeWidth:4})}):(0,a.jsx)("div",{className:"rounded-full w-4 h-4 dark:bg-white bg-black flex items-center justify-center",children:(0,a.jsx)(m.A,{size:10,className:"text-contrast",strokeWidth:4})})}):(0,a.jsxs)("div",{className:"flex items-center gap-x-2 h-[26px] font-mono min-w-[40px]",children:[(0,a.jsx)("p",{className:"text-xs",children:s||"-"}),!!s&&(0,a.jsx)(j.A,{iconOnly:!0,type:"text",icon:(0,a.jsx)(x.A,{}),className:"transition opacity-0 group-hover:opacity-100 px-1",text:s})]})]}),(0,a.jsx)(O.w,{"data-sentry-element":"Separator","data-sentry-source-file":"UserOverview.tsx"})]})},eo=e=>{var t,s,n;let{title:r,description:l,button:o,success:d,className:c}=e,u=null!=(t=null==o?void 0:o.disabled)&&t;return(0,a.jsxs)("div",{className:(0,P.cn)(er,c),"data-sentry-component":"RowAction","data-sentry-source-file":"UserOverview.tsx",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:d?d.title:r}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:d?d.description:l})]}),(0,a.jsx)(g.G,{type:null!=(s=null==o?void 0:o.type)?s:"default",icon:d?(0,a.jsx)(i.A,{className:"text-brand"}):o.icon,loading:null!=(n=o.isLoading)&&n,onClick:o.onClick,disabled:u,tooltip:{content:{side:"bottom",text:u?"You need additional permissions to ".concat(o.text.toLowerCase()):void 0}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"UserOverview.tsx",children:o.text})]})}},53755:(e,t,s)=>{s.d(t,{I:()=>u});var a=s(80263),n=s(53239),r=s(10738),l=s(16601),i=s(2),o=s(83405),d=s(44728),c=s(27863);let u=e=>{let{title:t,options:s=[],activeOptions:u=[],valueKey:m,labelKey:x,iconKey:h="icon",name:f="default",variant:p="rectangular",buttonType:v,disabled:y,labelClass:g,className:j,maxHeightClass:b="h-[205px]",clearButtonText:w="Clear",onSaveFilters:_}=e,[N,C]=(0,n.useState)(!1),[S,U]=(0,n.useState)([]),A=u.map(e=>{let t=s.find(t=>t[m]===e);return t&&t[x]?t[x]:""});return(0,n.useEffect)(()=>{!N&&u.length>0&&U(u)},[N,u]),(0,a.jsxs)(r.AM,{open:N,onOpenChange:C,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"FilterPopover","data-sentry-source-file":"FilterPopover.tsx",children:[(0,a.jsx)(r.Wv,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"FilterPopover.tsx",children:(0,a.jsx)(l.$,{asChild:!0,disabled:y,type:null!=v?v:u.length>0?"default":"dashed",onClick:()=>C(!1),className:"rounded"===p?"rounded-full":"","data-sentry-element":"Button","data-sentry-source-file":"FilterPopover.tsx",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:f}),u.length>0&&(0,a.jsx)("span",{className:"mr-1",children:":"}),u.length>=3?(0,a.jsxs)("span",{children:[A[0]," and ",u.length-1," others"]}):u.length>0?(0,a.jsx)("span",{children:A.join(", ")}):null]})})}),(0,a.jsxs)(r.hl,{className:(0,i.cn)("p-0 w-44",j),align:"start","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"FilterPopover.tsx",children:[(0,a.jsx)("div",{className:"border-b border-overlay bg-surface-200 rounded-t pb-1 px-3",children:(0,a.jsx)("span",{className:"text-xs text-foreground-light",children:null!=t?t:"Select ".concat(f.toLowerCase())})}),(0,a.jsx)(o.FK,{className:s.length>7?b:"","data-sentry-element":"ScrollArea","data-sentry-source-file":"FilterPopover.tsx",children:(0,a.jsx)("div",{className:"p-3 flex flex-col gap-y-2",children:s.map(e=>{let t=e[m],s=h?e[h]:void 0;return(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(d.S,{id:t,checked:S.includes(t),onCheckedChange:()=>{S.includes(t)?U(S.filter(e=>e!==t)):U(S.concat(t))}}),(0,a.jsxs)(c.J,{htmlFor:e[m],className:(0,i.cn)("flex items-center gap-x-2 text-xs",g),children:[s&&(0,a.jsx)("img",{src:s,alt:e[x],className:(0,i.cn)("w-4 h-4",e.iconClass)}),(0,a.jsx)("span",{children:e[x]})]})]},t)})})}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-overlay bg-surface-200 py-2 px-3",children:[(0,a.jsx)(l.$,{size:"tiny",type:"default",onClick:()=>{_([]),U([]),C(!1)},"data-sentry-element":"Button","data-sentry-source-file":"FilterPopover.tsx",children:w}),(0,a.jsx)(l.$,{type:"primary",onClick:()=>{let e=s.map(e=>e[m]);_(S.sort((t,s)=>e.indexOf(t)-e.indexOf(s))),C(!1)},"data-sentry-element":"Button","data-sentry-source-file":"FilterPopover.tsx",children:"Save"})]})]})]})}},59168:(e,t,s)=>{s.d(t,{p:()=>u});var a=s(80263),n=s(87467),r=s(53239),l=s(2),i=s(49189),o=s(16601),d=s(77690);function c(e){let{icon:t,className:s}=e;return(0,a.jsx)("div",{className:(0,l.cn)("absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-foreground-light",s),"data-sentry-component":"InputIconContainer","data-sentry-source-file":"InputIconContainer.tsx",children:t})}let u=(0,r.forwardRef)((e,t)=>{let{copy:s,showCopyOnHover:u=!1,icon:m,reveal:x=!1,actions:h,onCopy:f,iconContainerClassName:p,containerClassName:v,...y}=e,[g,j]=(0,r.useState)("Copy"),[b,w]=(0,r.useState)(!0),_=(0,d.A)("input"),N=[];return m&&N.push(_.with_icon),(0,a.jsxs)("div",{className:(0,l.cn)("relative group",v),children:[(0,a.jsx)(i.p,{ref:t,...y,onCopy:f,value:x&&b?"**** **** **** ****":y.value,className:(0,l.cn)(...N,y.className)}),m&&(0,a.jsx)(c,{icon:m,className:p}),s||h?(0,a.jsxs)("div",{className:_.actions_container,children:[s&&!(x&&b)?(0,a.jsx)(o.$,{size:"tiny",type:"default",className:(0,l.cn)(u&&"opacity-0 group-hover:opacity-100 transition"),icon:(0,a.jsx)(n.A,{size:16,className:"text-foreground-muted"}),onClick:()=>(function(e){var t;null==(t=navigator.clipboard.writeText(e))||t.then(function(){j("Copied"),setTimeout(function(){j("Copy")},3e3),null==f||f()},function(){j("Failed to copy")})})(y.value),children:g}):null,x&&b?(0,a.jsx)(o.$,{size:"tiny",type:"default",onClick:function(){w(!1)},children:"Reveal"}):null,h&&h]}):null]})})},59657:(e,t,s)=>{s.d(t,{i:()=>d});var a=s(80263),n=s(82489),r=s(73969),l=s(83574),i=s(90206),o=s(36212);let d=e=>{var t,s;let{visible:d,selectedUser:c,onClose:u,onDeleteSuccess:m}=e,{ref:x}=(0,n.g)(),{mutate:h,isLoading:f}=(0,l.X)({onSuccess:()=>{r.oR.success("Successfully deleted ".concat(null==c?void 0:c.email)),null==m||m()}}),p=async()=>(await (0,i.wR)(200),x)?(null==c?void 0:c.id)===void 0?r.oR.error("Failed to delete user: User ID not found"):void h({projectRef:x,userId:c.id}):console.error("Project ref is required");return(0,a.jsx)(o.A,{visible:d,variant:"destructive",title:"Confirm to delete user",loading:f,confirmLabel:"Delete",onCancel:()=>u(),onConfirm:()=>p(),alert:{title:"Deleting a user is irreversible",description:"This will remove the selected the user from the project and all associated data."},"data-sentry-element":"ConfirmationModal","data-sentry-component":"DeleteUserModal","data-sentry-source-file":"DeleteUserModal.tsx",children:(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["This is permanent! Are you sure you want to delete the user"," ",null!=(s=null!=(t=null==c?void 0:c.email)?t:null==c?void 0:c.phone)?s:"this user","?"]})})}},66492:(e,t,s)=>{s.d(t,{x:()=>d});var a=s(80263),n=s(87467),r=s(2081),l=s(2),i=s(28349),o=s(76671);let d=e=>{var t,s,d;let{user:c}=e,u=(0,o.Mn)(c),m="-"!==u,x=null!==c.phone,h=c.is_anonymous;return(0,a.jsx)("div",{className:(0,l.cn)(i.j),"data-sentry-component":"UserHeader","data-sentry-source-file":"UserHeader.tsx",children:x?(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,a.jsx)("p",{children:c.phone}),(0,a.jsx)(r.A,{iconOnly:!0,type:"text",icon:(0,a.jsx)(n.A,{}),className:"px-1",text:null!=(t=null==c?void 0:c.phone)?t:""})]}):h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"Anonymous user"}),(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:c.id}),(0,a.jsx)(r.A,{iconOnly:!0,type:"text",icon:(0,a.jsx)(n.A,{}),className:"px-1",text:null!=(s=null==c?void 0:c.id)?s:""})]})]}):(0,a.jsxs)(a.Fragment,{children:[m&&(0,a.jsx)("p",{children:u}),(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,a.jsx)("p",{className:(0,l.cn)(m?"text-foreground-light text-sm":"text-foreground"),children:c.email}),(0,a.jsx)(r.A,{iconOnly:!0,type:"text",icon:(0,a.jsx)(n.A,{}),className:"px-1",text:null!=(d=null==c?void 0:c.email)?d:""})]})]})})}},76235:(e,t,s)=>{s.d(t,{A:()=>ew,R:()=>e_});var a=s(80263),n=s(32144),r=s(2827),l=s(94328),i=s(23278),o=s(65842),d=s(42766),c=s(16175),u=s(94786),m=s(57654),x=s(11352),h=s(53239),f=s(24560),p=s(73969),v=s(82489),y=s(96591),g=s(45969),j=s(98474),b=s(28071),w=s(79319),_=s(53755),N=s(93463),C=s(67849),S=s(83574),U=s(56947),A=s(77570);let k=e=>{let{filter:t,keywords:s,providers:a}=e,n=[];if(s&&""!==s){let e=s.replaceAll("'","''");n.push("id::text ilike '%".concat(e,"%' or email ilike '%").concat(e,"%' or phone ilike '%").concat(e,"%'"))}"verified"===t?n.push("email_confirmed_at IS NOT NULL or phone_confirmed_at IS NOT NULL"):"anonymous"===t?n.push("is_anonymous is true"):"unverified"===t&&n.push("email_confirmed_at IS NULL AND phone_confirmed_at IS NULL"),a&&a.length>0&&(a.includes("saml 2.0")?n.push("(select jsonb_agg(case when value ~ '^sso' then 'sso' else value end) from jsonb_array_elements_text((raw_app_meta_data ->> 'providers')::jsonb)) ?| array[".concat(a.map(e=>"saml 2.0"===e?"'sso'":"'".concat(e,"'")).join(", "),"]").trim()):n.push("(raw_app_meta_data->>'providers')::jsonb ?| array[".concat(a.map(e=>"'".concat(e,"'")).join(", "),"]")));let r=n.map(e=>"(".concat(e,")")).join(" and ");return"".concat("select count(*) from auth.users").concat(n.length>0?" where ".concat(r):"",";")};async function M(e,t){var s;let{projectRef:a,connectionString:n,keywords:r,filter:l,providers:i}=e,o=k({filter:l,keywords:r,providers:i}),{result:d}=await (0,A.E)({projectRef:a,connectionString:n,sql:o,queryKey:["users-count"]},t),c=null==d||null==(s=d[0])?void 0:s.count;if("number"!=typeof c)throw Error("Error fetching users count");return c}let D=function(e){let{projectRef:t,connectionString:s,keywords:a,filter:n,providers:r}=e,{enabled:l=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,U.I)(C.Z.usersCount(t,{keywords:a,filter:n,providers:r}),e=>{let{signal:l}=e;return M({projectRef:t,connectionString:s,keywords:a,filter:n,providers:r},l)},{enabled:l&&void 0!==t,...i})};var L=s(783),T=s(89756),E=s(58897),R=s(16601),z=s(79295),I=s(2),F=s(33656),P=s(99667),O=s(79210),H=s(59168),B=s(36212),V=s(62719),$=s(60045),W=s(68656),Y=s(23141),Z=s(63004),q=s(65904),G=s(3732),X=s(32981),K=s(26629),Q=s(87494),J=s(39353),ee=s(80251),et=s(3807);async function es(e){let{projectRef:t,user:s}=e,{data:a,error:n}=await (0,et.bE)("/platform/auth/{ref}/users",{params:{path:{ref:t}},body:{email:s.email,password:s.password,email_confirm:s.autoConfirmUser}});return n&&(0,et.H4)(n),a}let ea=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,n.jE)();return(0,ee.n)(e=>es(e),{async onSuccess(t,s,n){let{projectRef:r}=s;await Promise.all([a.invalidateQueries(C.Z.usersInfinite(r)),a.invalidateQueries(C.Z.usersCount(r))]),await (null==e?void 0:e(t,s,n))},async onError(e,s,a){void 0===t?p.oR.error("Failed to create user: ".concat(e.message)):t(e,s,a)},...s})};var en=s(34587),er=s(85669),el=s(49189),ei=s(44728);let eo=J.Ik({email:J.Yj().min(1,"Email is required").email("Must be a valid email address"),password:J.Yj().min(1,"Password is required"),autoConfirmUser:J.zM()}),ed=e=>{let{visible:t,setVisible:s}=e,{ref:n}=(0,v.g)(),r=(0,q.SE)($.aG.AUTH_EXECUTE,"create_user"),{mutate:l,isLoading:i}=ea({onSuccess(e){p.oR.success("Successfully created user: ".concat(e.email)),d.reset({email:"",password:"",autoConfirmUser:!0}),s(!1)}}),o=async e=>{if(!n)return console.error("Project ref is required");l({projectRef:n,user:e})},d=(0,Q.mN)({resolver:(0,X.u)(eo),defaultValues:{email:"",password:"",autoConfirmUser:!0}});return(0,a.jsx)(en.lG,{open:t,onOpenChange:s,"data-sentry-element":"Dialog","data-sentry-component":"CreateUserModal","data-sentry-source-file":"CreateUserModal.tsx",children:(0,a.jsxs)(en.Cf,{size:"small","data-sentry-element":"DialogContent","data-sentry-source-file":"CreateUserModal.tsx",children:[(0,a.jsx)(en.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"CreateUserModal.tsx",children:(0,a.jsx)(en.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"CreateUserModal.tsx",children:"Create a new user"})}),(0,a.jsx)(en.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateUserModal.tsx"}),(0,a.jsx)(er.lV,{...d,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateUserModal.tsx",children:(0,a.jsxs)("form",{id:"create-user",className:"flex flex-col gap-y-4 p-6",onSubmit:d.handleSubmit(o),children:[(0,a.jsx)(er.zB,{name:"email",control:d.control,render:e=>{let{field:t}=e;return(0,a.jsxs)(er.eI,{className:"flex flex-col gap-1",children:[(0,a.jsx)(er.lR,{children:"Email address"}),(0,a.jsx)(er.MJ,{children:(0,a.jsxs)("div",{className:"items-center relative",children:[(0,a.jsx)(Y.A,{size:18,className:"absolute left-2 top-1/2 transform -translate-y-1/2",strokeWidth:1.5}),(0,a.jsx)(el.p,{autoFocus:!0,...t,autoComplete:"off",type:"email",name:"email",placeholder:"user@example.com",disabled:i,className:"pl-8"})]})}),(0,a.jsx)(er.C5,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateUserModal.tsx"}),(0,a.jsx)(er.zB,{name:"password",control:d.control,render:e=>{let{field:t}=e;return(0,a.jsxs)(er.eI,{className:"flex flex-col gap-1",children:[(0,a.jsx)(er.lR,{children:"User Password"}),(0,a.jsx)(er.MJ,{children:(0,a.jsxs)("div",{className:"items-center relative",children:[(0,a.jsx)(K.A,{size:18,className:"absolute left-2 top-1/2 transform -translate-y-1/2",strokeWidth:1.5}),(0,a.jsx)(el.p,{...t,autoComplete:"new-password",type:"password",name:"password",placeholder:"••••••••",disabled:i,className:"pl-8"})]})}),(0,a.jsx)(er.C5,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateUserModal.tsx"}),(0,a.jsx)(er.zB,{name:"autoConfirmUser",control:d.control,render:e=>{let{field:t}=e;return(0,a.jsxs)(er.eI,{className:"flex items-center gap-x-2",children:[(0,a.jsx)(er.MJ,{children:(0,a.jsx)(ei.S,{checked:t.value,onCheckedChange:e=>t.onChange(e)})}),(0,a.jsx)(er.lR,{children:"Auto Confirm User?"})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateUserModal.tsx"}),(0,a.jsx)(er.lR,{"data-sentry-element":"FormLabel_Shadcn_","data-sentry-source-file":"CreateUserModal.tsx",children:(0,a.jsx)("p",{className:"text-sm text-foreground-lighter",children:"A confirmation email will not be sent when creating a user via this form."})}),(0,a.jsx)(R.$,{block:!0,size:"small",htmlType:"submit",loading:i,disabled:!r||i,"data-sentry-element":"Button","data-sentry-source-file":"CreateUserModal.tsx",children:"Create user"})]})})]})})};async function ec(e){let{projectRef:t,email:s}=e,{data:a,error:n}=await (0,et.bE)("/platform/auth/{ref}/invite",{params:{path:{ref:t}},body:{email:s}});return n&&(0,et.H4)(n),a}let eu=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,n.jE)();return(0,ee.n)(e=>ec(e),{async onSuccess(t,s,n){let{projectRef:r}=s;await Promise.all([a.invalidateQueries(C.Z.usersInfinite(r)),a.invalidateQueries(C.Z.usersCount(r))]),await (null==e?void 0:e(t,s,n))},async onError(e,s,a){void 0===t?p.oR.error("Failed to invite user: ".concat(e.message)):t(e,s,a)},...s})};var em=s(55335),ex=s(80109),eh=s(71171);let ef=e=>{let{visible:t,setVisible:s}=e,{ref:n}=(0,v.g)(),{mutate:r,isLoading:l}=eu({onSuccess:(e,t)=>{p.oR.success("Sent invite email to ".concat(t.email)),s(!1)}}),i=(0,q.SE)($.aG.AUTH_EXECUTE,"invite_user"),o=async e=>{if(!n)return console.error("Project ref is required");r({projectRef:n,email:e.email})};return(0,a.jsx)(em.A,{hideFooter:!0,size:"small",visible:t,header:"Invite a new user",onCancel:()=>s(!t),"data-sentry-element":"Modal","data-sentry-component":"InviteUserModal","data-sentry-source-file":"InviteUserModal.tsx",children:(0,a.jsx)(ex.A,{validateOnBlur:!1,initialValues:{email:""},validate:e=>{let t={};return 0===e.email.length?t.email="Please enter a valid email":/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(e.email)||(t.email="".concat(e.email," is an invalid email")),t},onSubmit:o,"data-sentry-element":"Form","data-sentry-source-file":"InviteUserModal.tsx",children:()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(em.A.Content,{children:(0,a.jsx)(eh.A,{id:"email",className:"w-full",label:"User email",icon:(0,a.jsx)(Y.A,{}),type:"email",name:"email",placeholder:"User email"})}),(0,a.jsx)(em.A.Content,{children:(0,a.jsx)(R.$,{block:!0,size:"small",htmlType:"submit",loading:l,disabled:!i||l,children:"Invite user"})})]})})},"invite-user-modal")},ep=()=>{let e=(0,q.SE)($.aG.AUTH_EXECUTE,"invite_user"),t=(0,q.SE)($.aG.AUTH_EXECUTE,"create_user"),[s,n]=(0,h.useState)(!1),[r,l]=(0,h.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(F.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"AddUserDropdown.tsx",children:[(0,a.jsx)(F.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"AddUserDropdown.tsx",children:(0,a.jsx)(R.$,{type:"primary",iconRight:(0,a.jsx)(W.A,{size:14,strokeWidth:1.5}),"data-sentry-element":"Button","data-sentry-source-file":"AddUserDropdown.tsx",children:"Add user"})}),(0,a.jsxs)(F.SQ,{side:"bottom",align:"end",className:"w-40","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"AddUserDropdown.tsx",children:[(0,a.jsxs)(G.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"AddUserDropdown.tsx",children:[(0,a.jsx)(G.k$,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"AddUserDropdown.tsx",children:(0,a.jsxs)(F._2,{className:"space-x-2 !pointer-events-auto",disabled:!e,onClick:()=>{e&&n(!0)},"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"AddUserDropdown.tsx",children:[(0,a.jsx)(Y.A,{size:14,"data-sentry-element":"Mail","data-sentry-source-file":"AddUserDropdown.tsx"}),(0,a.jsx)("p",{children:"Send invitation"})]})}),!e&&(0,a.jsx)(G.ZI,{side:"left",children:"You need additional permissions to invite users"})]}),(0,a.jsxs)(G.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"AddUserDropdown.tsx",children:[(0,a.jsx)(G.k$,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"AddUserDropdown.tsx",children:(0,a.jsxs)(F._2,{className:"space-x-2 !pointer-events-auto",disabled:!t,onClick:()=>{t&&l(!0)},"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"AddUserDropdown.tsx",children:[(0,a.jsx)(Z.A,{size:14,"data-sentry-element":"UserPlus","data-sentry-source-file":"AddUserDropdown.tsx"}),(0,a.jsx)("p",{children:"Create new user"})]})}),!t&&(0,a.jsx)(G.ZI,{side:"left",children:"You need additional permissions to create users"})]})]})]}),(0,a.jsx)(ef,{visible:s,setVisible:n,"data-sentry-element":"InviteUserModal","data-sentry-source-file":"AddUserDropdown.tsx"}),(0,a.jsx)(ed,{visible:r,setVisible:l,"data-sentry-element":"CreateUserModal","data-sentry-source-file":"AddUserDropdown.tsx"})]})};var ev=s(59657),ey=s(28349),eg=s(99696);let ej=eg.S5.map(e=>({name:e.title,value:"key"in e?e.key:e.title.toLowerCase(),icon:"".concat(E.o2,"/img/icons/").concat(e.misc.iconKey,".svg"),iconClass:"GitHub"===e.title?"dark:invert":""})).concat(eg.ns.properties.SMS_PROVIDER.enum.map(e=>({name:e.label,value:e.value,icon:"".concat(E.o2,"/img/icons/").concat(e.icon),iconClass:""})));var eb=s(76671);let ew=[{id:"img",name:"",minWidth:95,width:95,resizable:!1},{id:"id",name:"UID",width:280},{id:"name",name:"Display name",minWidth:0,width:150},{id:"email",name:"Email",width:300},{id:"phone",name:"Phone"},{id:"providers",name:"Providers",minWidth:150},{id:"provider_type",name:"Provider type",minWidth:150},{id:"created_at",name:"Created at",width:260},{id:"last_sign_in_at",name:"Last sign in at",width:260}],e_=()=>{var e,t;let s=(0,n.jE)(),{ref:U}=(0,v.g)(),{project:A}=(0,g.Om)(),k=(0,h.useRef)(null),M=(0,h.useRef)(0),$=(0,y.hx)(),[W,Y]=(0,h.useState)([]),[Z,q]=(0,h.useState)(""),[G,X]=(0,h.useState)("all"),[K,Q]=(0,h.useState)(""),[J,ee]=(0,h.useState)([]),[et,es]=(0,h.useState)([]),[ea,en]=(0,h.useState)("created_at:desc"),[er,el]=(0,h.useState)(),[ei,eo]=(0,h.useState)(new Set([])),[ed,ec]=(0,h.useState)(),[eu,em]=(0,h.useState)(!1),[ex,eh]=(0,h.useState)(!1),[ef,eg,{isSuccess:e_,isError:eN,error:eC}]=(0,T.U)(E.rS.AUTH_USERS_COLUMNS_CONFIGURATION(null!=U?U:""),null),[eS,eU]=ea.split(":"),{data:eA,error:ek,isSuccess:eM,isLoading:eD,isRefetching:eL,isError:eT,isFetchingNextPage:eE,refetch:eR,hasNextPage:ez,fetchNextPage:eI}=(0,L.aq)({projectRef:U,connectionString:null==A?void 0:A.connectionString,keywords:K,filter:"all"===G?void 0:G,providers:et,sort:eS,order:eU},{keepPreviousData:!!K,staleTime:1/0}),{data:eF}=D({projectRef:U,connectionString:null==A?void 0:A.connectionString,keywords:K,filter:"all"===G?void 0:G,providers:et}),{mutateAsync:eP}=(0,S.X)(),eO=(0,h.useMemo)(()=>{var e;return null!=(e=null==eA?void 0:eA.pages.flatMap(e=>e.result))?e:[]},[null==eA?void 0:eA.pages]),eH=eO.find(e=>e.id===[...ei][0]),eB=()=>{q(""),Q("")},eV=(e,t,s)=>{let a=e.slice(),[n]=a.splice(t,1);return a.splice(s,0,n),a},e$=(0,r.A)((e,t)=>{"toggle"===e?eg(t.columns.map(e=>({id:e.key,width:e.width}))):"resize"===e?eg(W.map((e,s)=>({id:e.key,width:s===t.idx?t.width:e.width}))):"reorder"===e&&eg(t.columns.map(e=>({id:e.key,width:e.width})))},500),eW=async()=>{if(!U)return console.error("Project ref is required");let e=[...ei];eh(!0);try{await Promise.all(e.map(e=>eP({projectRef:U,userId:e,skipInvalidation:!0}))),await Promise.all([s.invalidateQueries(C.Z.usersInfinite(U)),s.invalidateQueries(C.Z.usersCount(U))]),p.oR.success("Successfully deleted the selected ".concat(ei.size," user").concat(ei.size>1?"s":"")),em(!1),eo(new Set([])),e.includes(er)&&el(void 0)}catch(e){p.oR.error("Failed to delete selected users: ".concat(e.message)),eh(!1)}};return(0,h.useEffect)(()=>{if(!eL&&(e_||eN&&eC.message.includes("data is undefined"))){let e=(0,eb.yA)({config:null!=ef?ef:[],users:null!=eO?eO:[],visibleColumns:J,setSortByValue:en,onSelectDeleteUser:ec});Y(e),e.length<ew.length&&ee(e.filter(e=>"img"!==e.key).map(e=>e.key))}},[eM,eL,e_,eN,eC,eO,ei]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)(N.M,{className:"py-4 px-6 !mb-0",title:"Users","data-sentry-element":"FormHeader","data-sentry-source-file":"UsersV2.tsx"}),(0,a.jsx)("div",{className:"bg-surface-200 py-3 px-4 md:px-6 flex flex-col lg:flex-row lg:items-center justify-between gap-2 border-t",children:ei.size>0?(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsxs)(R.$,{type:"default",icon:(0,a.jsx)(l.A,{}),onClick:()=>em(!0),children:["Delete ",ei.size," users"]}),(0,a.jsx)(w.G,{type:"default",icon:(0,a.jsx)(i.A,{}),className:"px-1.5",onClick:()=>eo(new Set([])),tooltip:{content:{side:"bottom",text:"Cancel selection"}}})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)(H.p,{size:"tiny",className:"w-52 pl-7 bg-transparent",iconContainerClassName:"pl-2",icon:(0,a.jsx)(o.A,{size:14,className:"text-foreground-lighter"}),placeholder:"Search email, phone or UID",value:Z,onChange:e=>q(e.target.value),onKeyDown:e=>{"Enter"===e.code&&(q(Z.trim()),Q(Z.trim().toLocaleLowerCase()))},actions:[Z&&(0,a.jsx)(R.$,{size:"tiny",type:"text",icon:(0,a.jsx)(i.A,{}),onClick:()=>eB(),className:"p-0 h-5 w-5"})]}),(0,a.jsxs)(z.l6,{value:G,onValueChange:e=>X(e),children:[(0,a.jsx)(z.bq,{size:"tiny",className:(0,I.cn)("w-[140px] !bg-transparent","all"===G&&"border-dashed"),children:(0,a.jsx)(z.yv,{})}),(0,a.jsx)(z.gC,{children:(0,a.jsxs)(z.s3,{children:[(0,a.jsx)(z.eb,{value:"all",className:"text-xs",children:"All users"}),(0,a.jsx)(z.eb,{value:"verified",className:"text-xs",children:"Verified users"}),(0,a.jsx)(z.eb,{value:"unverified",className:"text-xs",children:"Unverified users"}),(0,a.jsx)(z.eb,{value:"anonymous",className:"text-xs",children:"Anonymous users"})]})})]}),(0,a.jsx)(_.I,{name:"Provider",options:ej,labelKey:"name",valueKey:"value",iconKey:"icon",activeOptions:et,labelClass:"text-xs",maxHeightClass:"h-[190px]",onSaveFilters:es}),(0,a.jsx)("div",{className:"border-r border-strong h-6"}),(0,a.jsx)(_.I,{name:0===J.length?"All columns":"Columns",title:"Select columns to show",buttonType:0===J.length?"dashed":"default",options:ew.slice(1),labelKey:"name",valueKey:"id",labelClass:"text-xs",maxHeightClass:"h-[190px]",clearButtonText:"Reset",activeOptions:J,onSaveFilters:e=>{let t=(null!=ef?ef:[]).slice();0===e.length?t=ew.map(e=>({id:e.id,width:e.width})):e.forEach(e=>{var s;t.find(t=>t.id===e)||t.push({id:e,width:null==(s=ew.find(t=>t.id===e))?void 0:s.width})});let s=(0,eb.yA)({config:t,users:null!=eO?eO:[],visibleColumns:e,setSortByValue:en,onSelectDeleteUser:ec});ee(e),Y(s),e$("toggle",{columns:s})}}),(0,a.jsxs)(F.rI,{children:[(0,a.jsx)(F.ty,{asChild:!0,children:(0,a.jsxs)(R.$,{icon:"desc"===eU?(0,a.jsx)(d.A,{}):(0,a.jsx)(c.A,{}),children:["Sorted by ",eS.replaceAll("_"," ")]})}),(0,a.jsx)(F.SQ,{className:"w-44",align:"start",children:(0,a.jsxs)(F.Hr,{value:ea,onValueChange:en,children:[(0,a.jsxs)(F.lv,{children:[(0,a.jsx)(F.nV,{children:"Sort by created at"}),(0,a.jsxs)(F.M5,{children:[(0,a.jsx)(F.Ht,{value:"created_at:asc",children:"Ascending"}),(0,a.jsx)(F.Ht,{value:"created_at:desc",children:"Descending"})]})]}),(0,a.jsxs)(F.lv,{children:[(0,a.jsx)(F.nV,{children:"Sort by last sign in at"}),(0,a.jsxs)(F.M5,{children:[(0,a.jsx)(F.Ht,{value:"last_sign_in_at:asc",children:"Ascending"}),(0,a.jsx)(F.Ht,{value:"last_sign_in_at:desc",children:"Descending"})]})]}),(0,a.jsxs)(F.lv,{children:[(0,a.jsx)(F.nV,{children:"Sort by email"}),(0,a.jsxs)(F.M5,{children:[(0,a.jsx)(F.Ht,{value:"email:asc",children:"Ascending"}),(0,a.jsx)(F.Ht,{value:"email:desc",children:"Descending"})]})]}),(0,a.jsxs)(F.lv,{children:[(0,a.jsx)(F.nV,{children:"Sort by phone"}),(0,a.jsxs)(F.M5,{children:[(0,a.jsx)(F.Ht,{value:"phone:asc",children:"Ascending"}),(0,a.jsx)(F.Ht,{value:"phone:desc",children:"Descending"})]})]})]})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[$&&(0,a.jsx)(b.A,{section:["user-management"]}),(0,a.jsx)(R.$,{size:"tiny",icon:(0,a.jsx)(u.A,{}),type:"default",loading:eL&&!eE,onClick:()=>eR(),children:"Refresh"}),(0,a.jsx)(ep,{})]})]})}),(0,a.jsx)(P.$,{loading:eD||eL||eE,"data-sentry-element":"LoadingLine","data-sentry-source-file":"UsersV2.tsx"}),(0,a.jsxs)(O.HK,{direction:"horizontal",className:"relative flex flex-grow bg-alternative min-h-0",autoSaveId:"query-performance-layout-v1","data-sentry-element":"ResizablePanelGroup","data-sentry-source-file":"UsersV2.tsx",children:[(0,a.jsx)(O.wV,{defaultSize:1,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"UsersV2.tsx",children:(0,a.jsx)("div",{className:"flex flex-col w-full h-full",children:(0,a.jsx)(f.Ay,{ref:k,className:"flex-grow border-t-0",rowHeight:44,headerRowHeight:36,columns:W,rows:(0,eb.uJ)(null!=eO?eO:[]),rowClass:e=>{let t=e.id===er;return["".concat(t?"bg-surface-300 dark:bg-surface-300":"bg-200"," cursor-pointer"),"[&>.rdg-cell]:border-box [&>.rdg-cell]:outline-none [&>.rdg-cell]:shadow-none","[&>.rdg-cell:first-child>div]:ml-4"].join(" ")},rowKeyGetter:e=>e.id,selectedRows:ei,onScroll:e=>{let t=M.current!==e.currentTarget.scrollLeft;M.current=e.currentTarget.scrollLeft,!eD&&!eE&&!t&&(0,eb.vY)(e)&&ez&&eI()},onSelectedRowsChange:e=>{e.size>20?(0,p.oR)("Only up to ".concat(20," users can be selected at a time")):eo(e)},onColumnResize:(e,t)=>e$("resize",{idx:e,width:t}),onColumnsReorder:(e,t)=>{let s=W.findIndex(t=>t.key===e),a=W.findIndex(e=>e.key===t),n=eV(W,s,a);Y(n),e$("reorder",{columns:n})},renderers:{renderRow:(e,t)=>(0,a.jsx)(f.fI,{...t,onClick:()=>{let s=eO.find(t=>t.id===e);if(s){let e=eO.indexOf(s);if(t.row.id){var a;el(t.row.id),null==(a=k.current)||a.scrollToCell({idx:0,rowIdx:e})}}}}),noRowsFallback:eD?(0,a.jsx)("div",{className:"absolute top-14 px-6 w-full",children:(0,a.jsx)(V.y,{})}):eT?(0,a.jsx)("div",{className:"absolute top-14 px-6 flex flex-col items-center justify-center w-full",children:(0,a.jsx)(j.A,{subject:"Failed to retrieve users",error:ek})}):(0,a.jsxs)("div",{className:"absolute top-20 px-6 flex flex-col items-center justify-center w-full gap-y-2",children:[(0,a.jsx)(m.A,{className:"text-foreground-lighter",strokeWidth:1}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-foreground",children:"all"!==G||K.length>0?"No users found":"No users in your project"}),(0,a.jsx)("p",{className:"text-foreground-light",children:"all"!==G||K.length>0?"There are currently no users based on the filters applied":"There are currently no users who signed up to your project"})]})]})},"data-sentry-element":"DataGrid","data-sentry-source-file":"UsersV2.tsx"})})}),void 0!==er&&(0,a.jsx)(ey.o,{selectedUser:eO.find(e=>e.id===er),onClose:()=>el(void 0)})]}),(0,a.jsxs)("div",{className:"flex justify-between min-h-9 h-9 overflow-hidden items-center px-6 w-full border-t text-xs text-foreground-light",children:[eD||eL?"Loading users...":"Total: ".concat(null!=eF?eF:0," users"),(eD||eL||eE)&&(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.A,{size:14,className:"animate-spin"})," Loading..."]})]})]}),(0,a.jsx)(B.A,{visible:eu,variant:"destructive",title:"Confirm to delete ".concat(ei.size," user").concat(ei.size>1?"s":""),loading:ex,confirmLabel:"Delete",onCancel:()=>em(!1),onConfirm:()=>eW(),alert:{title:"Deleting ".concat(1===ei.size?"a user":"users"," is irreversible"),description:"This will remove the selected ".concat(1===ei.size?"":"".concat(ei.size," "),"user").concat(ei.size>1?"s":""," from the project and all associated data.")},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"UsersV2.tsx",children:(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["This is permanent! Are you sure you want to delete the"," ",1===ei.size?"":"selected ".concat(ei.size," "),"user",ei.size>1?"s":"",1===ei.size?(0,a.jsxs)("span",{className:"text-foreground",children:[" ",null!=(t=null!=(e=null==eH?void 0:eH.email)?e:null==eH?void 0:eH.phone)?t:"this user"]}):null,"?"]})}),(0,a.jsx)(ev.i,{visible:!!ed,selectedUser:ed,onClose:()=>ec(void 0),onDeleteSuccess:()=>ec(void 0),"data-sentry-element":"DeleteUserModal","data-sentry-source-file":"UsersV2.tsx"})]})}},76671:(e,t,s)=>{s.d(t,{yA:()=>R,uJ:()=>U,TW:()=>E,Mn:()=>T,vY:()=>S,FI:()=>k});var a=s(80263),n=s(53434),r=s.n(n),l=s(75809),i=s(81372),o=s(94328),d=s(24560),c=s(58897),u=s(90206),m=s(44728),x=s(2),h=s(62528),f=s(99696),p=s(68656),v=s(78294),y=s(29819),g=s(53239),j=s(33656),b=s(16601);let w=e=>{let{col:t,setSortByValue:s}=e,n=(0,g.useRef)(0),[r,l]=(0,g.useState)(!1);return(0,g.useEffect)(()=>{n.current=Number(new Date)},[r]),(0,a.jsxs)("div",{className:"flex items-center justify-between font-normal text-xs w-full","data-sentry-component":"HeaderCell","data-sentry-source-file":"UsersGridComponents.tsx",children:[(0,a.jsx)("div",{className:"flex items-center gap-x-2",children:(0,a.jsx)("p",{className:"!text-foreground",children:t.name})}),["created_at","email","phone"].includes(t.id)&&(0,a.jsxs)(j.rI,{open:r,onOpenChange:e=>{!1===e&&Number(new Date)-n.current>100&&l(e)},children:[(0,a.jsx)(j.ty,{asChild:!0,children:(0,a.jsx)(b.$,{type:"text",icon:(0,a.jsx)(p.A,{}),className:"p-0 h-5 w-5",onClick:()=>l(!r)})}),(0,a.jsxs)(j.SQ,{className:"w-36",children:[(0,a.jsxs)(j._2,{className:"flex items-center gap-x-2",onClick:()=>{l(!1),s("".concat(t.id,":desc"))},children:[(0,a.jsx)(v.A,{size:14}),"Sort descending"]}),(0,a.jsxs)(j._2,{className:"flex items-center gap-x-2",onClick:()=>{l(!1),s("".concat(t.id,":asc"))},children:[(0,a.jsx)(y.A,{size:14}),"Sort ascending"]})]})]})]})};var _=s(76235);let N="https://avatars.githubusercontent.com",C=[N,"https://lh3.googleusercontent.com"],S=e=>{let{currentTarget:t}=e;return t.scrollTop+10>=t.scrollHeight-t.clientHeight},U=e=>e.map(e=>{var t,s;let a=null!=(s=null==(t=e.raw_app_meta_data)?void 0:t.provider)?s:"",n=e.providers.map(e=>e.startsWith("sso")?"SAML":e);return{id:e.id,email:e.email,phone:e.phone,created_at:e.created_at,last_sign_in_at:e.last_sign_in_at,providers:e.is_anonymous?"-":n,provider_icons:n.map(e=>"email"===e?"".concat(c.o2,"/img/icons/email-icon2.svg"):"SAML"===e?"".concat(c.o2,"/img/icons/saml-icon.svg"):k[e]?"".concat(c.o2,"/img/icons/").concat(k[e],".svg"):void 0).filter(Boolean),provider_type:e.is_anonymous?"Anonymous":"email"===a?"-":M.includes(a)?"Social":D.includes(a)?"Phone":"-",img:E(e),name:T(e)}}),A={social:[{email:"email-icon2"},{apple:"apple-icon"},{azure:"microsoft-icon"},{bitbucket:"bitbucket-icon"},{discord:"discord-icon"},{facebook:"facebook-icon"},{figma:"figma-icon"},{github:"github-icon"},{gitlab:"gitlab-icon"},{google:"google-icon"},{kakao:"kakao-icon"},{keycloak:"keycloak-icon"},{linkedin_oidc:"linkedin-icon"},{notion:"notion-icon"},{twitch:"twitch-icon"},{twitter:"twitter-icon"},{slack_oidc:"slack-icon"},{slack:"slack-icon"},{spotify:"spotify-icon"},{workos:"workos-icon"},{zoom:"zoom-icon"}],phone:[{twilio:"twilio-icon"},{messagebird:"messagebird-icon"},{textlocal:"messagebird-icon"},{vonage:"messagebird-icon"},{twilioverify:"twilio-verify-icon"}]},k=Object.values([...A.social,...A.phone]).reduce((e,t)=>{let[[s,a]]=Object.entries(t);return{...e,[s]:a}},{}),M=A.social.map(e=>{let[t]=Object.keys(e);return t}),D=A.phone.map(e=>{let[t]=Object.keys(e);return t});function L(e){if(e){if("string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>L(e)).join(" ");try{return JSON.stringify(e)}catch(e){}}}function T(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",{custom_claims:a,displayName:n,display_name:r,fullName:l,full_name:i,familyName:o,family_name:d,givenName:c,given_name:u,surname:m,lastName:x,last_name:h,firstName:f,first_name:p}=null!=(t=e.raw_user_meta_data)?t:{},{displayName:v,display_name:y,fullName:g,full_name:j,familyName:b,family_name:w,givenName:_,given_name:N,surname:C,lastName:S,last_name:U,firstName:A,first_name:k}=null!=a?a:{},M=L(o||d||m||x||h||b||w||C||S||U),D=L(c||u||f||p||_||N||A||k);return L(n||r||v||y||l||i||g||j||D&&M&&"".concat(D," ").concat(M)||M||D)||s}function E(e){var t;let{avatarUrl:s,avatarURL:a,avatar_url:n,profileUrl:r,profileURL:l,profile_url:i,profileImage:o,profile_image:d,profileImageUrl:c,profileImageURL:u,profile_image_url:m}=null!=(t=e.raw_user_meta_data)?t:{},x=s||a||n||o||d||r||l||i||c||u||m||"";if("string"!=typeof x)return;let h=C.some(e=>x.startsWith(e));try{let e=new URL(x);return e.searchParams.set("s","24"),h?x.startsWith(N)?e.href:x:void 0}catch(e){return h?x:void 0}}let R=e=>{var t;let{config:s,users:n,visibleColumns:c=[],setSortByValue:p,onSelectDeleteUser:v}=e,y=null!=(t=s.map(e=>e.id))?t:_.A.map(e=>e.id),g=_.A.map(e=>{var t,c,y;let g=s.find(t=>t.id===e.id);return{key:e.id,name:e.name,resizable:null==(t=e.resizable)||t,sortable:!1,draggable:!0,width:null!=(c=null==g?void 0:g.width)?c:e.width,minWidth:null!=(y=e.minWidth)?y:120,headerCellClass:"z-50 outline-none !shadow-none",renderHeaderCell:()=>{if("img"!==e.id)return(0,a.jsx)(w,{col:e,setSortByValue:p})},renderCell:t=>{let{row:s}=t,[c,p]=(0,d.Uk)(),y=null==s?void 0:s[e.id],g=null==n?void 0:n.find(e=>e.id===s.id),j=null!==y&&["created_at","last_sign_in_at"].includes(e.id)?r()(y).format("ddd DD MMM YYYY HH:mm:ss [GMT]ZZ"):Array.isArray(y)?"providers"===e.id?y.map(e=>{let t=f.S5.find(t=>"key"in t&&t.key===e||t.title.toLowerCase()===e);return null==t?void 0:t.title}).join(", "):y.join(", "):y,b=!!(null==g?void 0:g.confirmed_at);return"img"===e.id?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-x-2",children:[(0,a.jsx)(m.S,{checked:c,onClick:e=>{e.stopPropagation(),p({row:s,type:"ROW",checked:!c,isShiftClick:e.shiftKey})}}),(0,a.jsx)("div",{className:(0,x.cn)("flex items-center justify-center w-6 h-6 rounded-full bg-center bg-cover bg-no-repeat",s.img?"border":"bg-selection"),style:{backgroundImage:s.img?"url('".concat(s.img,"')"):"none"},children:!s.img&&(0,a.jsx)(l.A,{size:12})})]}):(0,a.jsxs)(h.tz,{children:[(0,a.jsx)(h.Rc,{asChild:!0,children:(0,a.jsxs)("div",{className:(0,x.cn)("w-full flex items-center text-xs",e.id.includes("provider")?"capitalize":""),children:["providers"===e.id&&s.provider_icons.map((e,t)=>{let n=s.providers[t];return(0,a.jsx)("div",{className:"min-w-6 min-h-6 rounded-full border flex items-center justify-center bg-surface-75",style:{marginLeft:0===t?0:"-8px",zIndex:s.provider_icons.length-t},children:(0,a.jsx)("img",{width:16,src:e,alt:"".concat(n," auth icon"),className:(0,x.cn)("github"===n&&"dark:invert")},"".concat(null==g?void 0:g.id,"-").concat(n))})}),"last_sign_in_at"!==e.id||b?(0,a.jsx)("p",{className:(0,x.cn)("providers"===e.id&&"ml-1"),children:null===j?"-":j}):(0,a.jsx)("p",{className:"text-foreground-lighter",children:"Waiting for verification"})]})}),(0,a.jsxs)(h.Ip,{onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)(h.kt,{className:"gap-x-2",onFocusCapture:e=>e.stopPropagation(),onSelect:()=>{let t="providers"===e.id?s.providers.join(", "):j;(0,u.lW)(t)},children:[(0,a.jsx)(i.A,{size:12}),(0,a.jsxs)("span",{children:["Copy ","id"===e.id?e.name:e.name.toLowerCase()]})]}),(0,a.jsx)(h.K5,{}),(0,a.jsxs)(h.kt,{className:"gap-x-2",onFocusCapture:e=>e.stopPropagation(),onSelect:()=>{g&&v(g)},children:[(0,a.jsx)(o.A,{size:12}),(0,a.jsx)("span",{children:"Delete user"})]})]})]})}}}),j=g.find(e=>"img"===e.key);return y.length>0&&(g=g.filter(e=>y.includes(e.key)).sort((e,t)=>y.indexOf(e.key)-y.indexOf(t.key))),0===c.length?g:[j].concat(g.filter(e=>c.includes(e.key)))}},83574:(e,t,s)=>{s.d(t,{X:()=>d});var a=s(32144),n=s(80251),r=s(73969),l=s(3807),i=s(67849);async function o(e){let{projectRef:t,userId:s}=e,{data:a,error:n}=await (0,l.yH)("/platform/auth/{ref}/users/{id}",{params:{path:{ref:t,id:s}}});return n&&(0,l.H4)(n),a}let d=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,a.jE)();return(0,n.n)(e=>o(e),{async onSuccess(t,s,a){let{projectRef:n,skipInvalidation:r=!1}=s;r||await Promise.all([l.invalidateQueries(i.Z.usersInfinite(n)),l.invalidateQueries(i.Z.usersCount(n))]),await (null==e?void 0:e(t,s,a))},async onError(e,s,a){void 0===t?r.oR.error("Failed to delete user: ".concat(e.message)):t(e,s,a)},...s})}},93463:(e,t,s)=>{s.d(t,{M:()=>l});var a=s(80263),n=s(2),r=s(67007);let l=e=>{let{title:t,description:s,docsUrl:l,actions:i,className:o}=e;return(0,a.jsxs)("div",{className:(0,n.cn)("w-full mb-6 flex flex-col sm:flex-row md:items-center justify-between gap-4 ".concat(o)),"data-sentry-component":"FormHeader","data-sentry-source-file":"FormHeader.tsx",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h3",{className:"text-foreground text-xl prose",children:t}),s&&(0,a.jsx)("div",{className:"prose text-sm max-w-full",children:s})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row md:items-center gap-x-2",children:[void 0!==l&&(0,a.jsx)(r.A,{href:l}),i]})]})}},99667:(e,t,s)=>{s.d(t,{$:()=>r});var a=s(80263),n=s(2);let r=e=>{let{loading:t}=e;return(0,a.jsx)("div",{className:"relative overflow-hidden w-full h-px bg-border m-auto","data-sentry-component":"LoadingLine","data-sentry-source-file":"LoadingLine.tsx",children:(0,a.jsx)("span",{className:(0,n.cn)("absolute w-[80px] h-px ml-auto mr-auto left-0 right-0 text-center block top-0","transition-all","line-loading-bg-light dark:line-loading-bg",t&&"animate-line-loading-slower opacity-100",t?"opacity-100":"opacity-0")})})}}}]);