!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="5396ea0f-1d9d-4dee-91b7-a4562aa6900b",e._sentryDebugIdIdentifier="sentry-dbid-5396ea0f-1d9d-4dee-91b7-a4562aa6900b")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3835],{5062:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/editor/[id]",function(){return n(17412)}])},5285:(e,t,n)=>{"use strict";n.d(t,{K:()=>a});var l=n(53239);function o(e,t){return e.indexOf(t)>=0}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],[a,r]=l.useState(),i=l=>{var a;if(!e||o(t,l.target.nodeName)||o(n,l.target.className))return;let i=(a=l).metaKey&&a.shiftKey?"Command+Shift+".concat(a.key):a.metaKey?"Command+".concat(a.key):a.shiftKey&&"Enter"===a.key?"Shift+".concat(a.key):a.ctrlKey&&a.key?"Control+".concat(a.key):a.key;e[i]&&(i.includes("+")?(l.preventDefault(),e[i](l),r(null)):(r(l.key),l.preventDefault()))},s=t=>{e&&e[t.key]&&a===t.key&&(t.preventDefault(),e[t.key](t),r(null))};l.useEffect(()=>(window.addEventListener("keydown",i),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",i),window.removeEventListener("keyup",s)}))}},12011:(e,t,n)=>{"use strict";n.d(t,{C:()=>a});var l=n(80263),o=n(2);let a=e=>{let{children:t,className:n}=e;return(0,l.jsx)("div",{className:(0,o.cn)("flex min-h-9 h-9 overflow-hidden overflow-x-auto items-center px-2 w-full border-t",n),"data-sentry-component":"GridFooter","data-sentry-source-file":"GridFooter.tsx",children:t})}},17412:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>eQ});var l=n(80263),o=n(52385),a=n(53239),r=n(82489),i=n(96591),s=n(63236),c=n(60045),d=n(11021),u=n.n(d),m=n(10767),f=n(22745),h=n(37034),g=n(45969),x=n(41518),p=n(45732),v=n(86303),y=n(29127),b=n(9594),w=n(38041),j=n(5942),C=n(5285);function N(e){let{gridRef:t,rows:n}=e,l=(0,w.Ir)(),o=(0,a.useMemo)(()=>{var e,t;return"windows"==((null==(e=navigator)?void 0:e.appVersion.indexOf("Win"))!==-1?"windows":(null==(t=navigator)?void 0:t.appVersion.indexOf("Mac"))!==-1?"macos":"unknown")?"Control":"Command"},[]);return(0,C.K)({["".concat(o,"+ArrowUp")]:e=>{if(e.stopPropagation(),l.selectedCellPosition){var n,o;let e={idx:null!=(o=null==(n=l.selectedCellPosition)?void 0:n.idx)?o:0,rowIdx:0};t.current.selectCell(e)}else t.current.scrollToCell({rowIdx:Number(0)})},["".concat(o,"+ArrowDown")]:e=>{if(e.stopPropagation(),l.selectedCellPosition){var o,a;let e={idx:null!=(a=null==(o=l.selectedCellPosition)?void 0:o.idx)?a:0,rowIdx:n.length>1?n.length-1:0};t.current.selectCell(e)}else t.current.scrollToCell({rowIdx:Number(n.length)})},["".concat(o,"+ArrowLeft")]:e=>{var n,o;e.stopPropagation();let a={idx:l.gridColumns.filter(e=>e.frozen).length,rowIdx:null!=(o=null==(n=l.selectedCellPosition)?void 0:n.rowIdx)?o:0};t.current.selectCell(a)},["".concat(o,"+ArrowRight")]:e=>{var n,o,a;e.stopPropagation(),null==(o=t.current)||o.selectCell({idx:l.gridColumns.length-2,rowIdx:null!=(a=null==(n=l.selectedCellPosition)?void 0:n.rowIdx)?a:0})}},["INPUT","TEXTAREA","SELECT"]),null}var S=n(12011),D=n(73891),k=n(52213),R=n(97195),E=n(45072),T=n(49088),A=n(98507),_=n(73892),I=n(9678),P=n(2628),L=n(16601),O=n(3732),F=n(59168),K=n(36212),M=n(61055);let G=e=>{if(0===e)return"0";let t=Math.floor(Math.log(e)/Math.log(1e3)),n=t>4?"T":["","K","M","B","T"][t];return"".concat((e/Math.pow(1e3,t>4?4:t)).toFixed(1)).concat(n)},Q=[{value:100,label:"100 rows"},{value:500,label:"500 rows"},{value:1e3,label:"1000 rows"}],z=()=>{var e,t;let{id:n}=(0,r.g)(),o=n?Number(n):void 0,{project:i}=(0,g.Om)(),s=(0,b.ap)(),c=(0,w.Ir)(),{data:d}=(0,k.Pk)({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString,id:o}),u=(0,R.KO)(d)?d.live_rows_estimate:null,[{filter:m}]=(0,E.W)({arrayKeys:["filter"]}),f=(0,j.hl)(m),h=c.page,x=(0,y.RY)(),[p,v]=(0,a.useState)(!1),[C,N]=(0,a.useState)(!1),[S,D]=(0,a.useState)(!1),[T,z]=(0,a.useState)(h.toString());(0,a.useEffect)(()=>{z(String(h))},[h]);let{data:W,isLoading:q,isSuccess:$,isError:U,isFetching:H}=(0,P.gt)({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString,tableId:o,filters:f,enforceExactCount:c.enforceExactCount,roleImpersonationState:x},{keepPreviousData:!0}),V=(null==W?void 0:W.is_estimate)?G(W.count):null==W?void 0:W.count.toLocaleString(),X=Math.ceil((null!=(e=null==W?void 0:W.count)?e:0)/s.rowsPerPage),Y=(null!=(t=null==W?void 0:W.count)?t:0)>0?X:1,Z=()=>{J()},B=()=>{ee()},J=()=>{let e=h-1;c.setPage(e)},ee=()=>{let e=h+1;c.setPage(e)},et=e=>{let t=e>X?X:e;c.setPage(t||1)};return(0,a.useEffect)(()=>{h&&h>Y&&c.setPage(Y)},[h,Y]),(0,a.useEffect)(()=>{void 0!==o&&c.setEnforceExactCount(null!==u&&u<=P.kd)},[o]),(0,l.jsxs)("div",{className:"flex items-center gap-x-4","data-sentry-component":"Pagination","data-sentry-source-file":"Pagination.tsx",children:[q&&(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading records count..."}),$&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsx)(L.$,{icon:(0,l.jsx)(A.A,{}),type:"outline",className:"px-1.5",disabled:h<=1||q,onClick:()=>{h>1&&(c.selectedRows.size>=1?N(!0):J())}}),(0,l.jsx)("p",{className:"text-xs text-foreground-light",children:"Page"}),(0,l.jsx)(F.p,{className:"w-12",size:"tiny",min:1,max:X,value:T,onChange:e=>z(e.target.value),onKeyDown:e=>{let t=Number(T);"Enter"===e.code&&!Number.isNaN(t)&&t>=1&&t<=X&&et(t)}}),(0,l.jsxs)("p",{className:"text-xs text-foreground-light",children:["of ",Y.toLocaleString()]}),(0,l.jsx)(L.$,{icon:(0,l.jsx)(_.A,{}),type:"outline",className:"px-1.5",disabled:h>=X||q,onClick:()=>{h<X&&(c.selectedRows.size>=1?v(!0):ee())}}),(0,l.jsx)(M.X,{options:Q,onSelect:e=>{let t=Number(e);s.setRowsPerPage(isNaN(t)?100:t)},side:"top",align:"start",children:(0,l.jsx)(L.$,{asChild:!0,type:"outline",style:{padding:"3px 10px"},children:(0,l.jsx)("span",{children:"".concat(s.rowsPerPage," rows")})})})]}),(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsxs)("p",{className:"text-xs text-foreground-light",children:["".concat(V," ").concat(0===W.count||W.count>1?"records":"record")," ",W.is_estimate?"(estimated)":""]}),W.is_estimate&&(0,l.jsxs)(O.m_,{children:[(0,l.jsx)(O.k$,{asChild:!0,children:(0,l.jsx)(L.$,{size:"tiny",type:"text",className:"px-1.5",loading:H,icon:(0,l.jsx)(I.A,{}),onClick:()=>{null===u||W.count>P.kd?D(!0):c.setEnforceExactCount(!0)}})}),(0,l.jsxs)(O.ZI,{side:"top",className:"w-72",children:["This is an estimated value as your table has more than"," ",P.kd.toLocaleString()," rows. ",(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"text-brand",children:"Click to retrieve the exact count of the table."})]})]})]})]}),U&&(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Error fetching records count. Please refresh the page."}),(0,l.jsx)(K.A,{visible:C,title:"Confirm moving to previous page",confirmLabel:"Confirm",onCancel:()=>N(!1),onConfirm:()=>{Z()},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"Pagination.tsx",children:(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,l.jsx)(K.A,{visible:p,title:"Confirm moving to next page",confirmLabel:"Confirm",onCancel:()=>v(!1),onConfirm:()=>{B()},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"Pagination.tsx",children:(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,l.jsx)(K.A,{variant:"warning",visible:S,title:"Confirm to fetch exact count for table",confirmLabel:"Retrieve exact count",onCancel:()=>D(!1),onConfirm:()=>{c.setEnforceExactCount(!0),D(!1)},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"Pagination.tsx",children:(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:null===u?"If your table has a row count of greater than ".concat(P.kd.toLocaleString()," rows,\n          retrieving the exact count of the table may cause performance issues on your database."):"Your table has a row count of greater than ".concat(P.kd.toLocaleString()," rows, and\n          retrieving the exact count of the table may cause performance issues on your database.")})})]})},W=e=>{let{isRefetching:t}=e,{project:n}=(0,g.Om)(),{id:o}=(0,r.g)(),a=o?Number(o):void 0,{data:i}=(0,k.Pk)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,id:a}),[{view:s="data"},c]=(0,E.W)(),d=(0,R.b4)(i),u=(0,R.KO)(i);return(0,l.jsxs)(S.C,{"data-sentry-element":"GridFooter","data-sentry-component":"Footer","data-sentry-source-file":"Footer.tsx",children:["data"===s&&(0,l.jsx)(z,{}),(0,l.jsxs)("div",{className:"ml-auto flex items-center gap-x-2",children:[i&&"data"===s&&(0,l.jsx)(T.A,{tableId:i.id,isRefetching:t}),(d||u)&&(0,l.jsx)(D.A,{width:75,options:["definition","data"],activeOption:s,borderOverride:"border",onClickOption:e=>{"data"===e?c({view:void 0}):c({view:e})}})]})]})};var q=n(24560),$=n(26695),U=n(98474),H=n(83710),V=n(36567),X=n(25718),Y=n(2),Z=n(62719),B=n(32144),J=n(73969),ee=n(52530),et=n(67007),en=n(30053),el=n(15484),eo=n(9711),ea=n(56515);function er(e,t){let{show:n}=(0,eo.EF)();return(0,l.jsx)(q.fI,{...t,onContextMenu:function(e){n(e,{id:ea.JY,props:{rowIdx:t.rowIdx}})},"data-sentry-element":"Row","data-sentry-component":"RowRenderer","data-sentry-source-file":"RowRenderer.tsx"},e)}let ei=e=>{var t;return null!=(t=null==e?void 0:e.idx)?t:-1},es=(0,a.memo)((0,a.forwardRef)((e,t)=>{var n;let{width:o,height:r,containerClass:i,gridClass:s,rowClass:c,rows:d,error:u,isLoading:m,isSuccess:f,isError:h,filters:x,onApplyFilters:p}=e,v=(0,b.ap)(),C=(0,w.Ir)(),N=function(e){let{project:t}=(0,g.Om)(),n=(0,w.Ir)(),o=(0,B.jE)(),r=(0,y.Qj)(),{mutate:i}=(0,el.oG)({async onMutate(e){let{projectRef:t,table:n,configuration:l,payload:a}=e,r=new Set(Object.keys(l.identifiers)),i=en.j.tableRows(t,{table:{id:n.id}});await o.cancelQueries(i);let s=o.getQueriesData(i);return o.setQueriesData(i,e=>{var t;return{rows:null!=(t=null==e?void 0:e.rows.map(e=>Object.entries(e).filter(e=>{let[t]=e;return r.has(t)}).every(e=>{let[t,n]=e;return n===l.identifiers[t]})?{...e,...a}:e))?t:[]}}),{previousRowsQueries:s}},onError(e,t,n){var l;let{previousRowsQueries:a}=n;a.forEach(e=>{let[t,n]=e;n&&o.setQueriesData(t,n),o.invalidateQueries(t)}),J.oR.error(null!=(l=null==e?void 0:e.message)?l:e)}});return(0,a.useCallback)((o,a)=>{var s;if(!t)return;let c=o[a.indexes[0]],d=e.find(e=>e.idx==c.idx),u=Object.keys(c).find(e=>c[e]!==d[e]);if(!d||!u)return;let m={[u]:c[u]},f=null==(s=n.originalTable.columns)?void 0:s.filter(e=>{var t;return(null!=(t=null==e?void 0:e.enums)?t:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name),h={};if((0,R.KO)(n.originalTable)&&n.originalTable.primary_keys.forEach(e=>{let t=n.originalTable.columns.find(t=>t.name===e.name);h[e.name]=(null==t?void 0:t.format)==="bytea"?(0,ee.ds)(d[e.name]):d[e.name]}),0===Object.keys(h).length)return(0,J.oR)("Unable to update row as table has no primary keys",{description:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,l.jsx)("div",{className:"mt-3",children:(0,l.jsx)(et.A,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})});i({projectRef:t.ref,connectionString:t.connectionString,table:n.originalTable,configuration:{identifiers:h},payload:m,enumArrayColumns:f,roleImpersonationState:r()})},[r,i,t,e,n.originalTable])}(d),S=(0,a.useRef)(null),D=C.table,{mutate:k}=(0,V.h)(),E=(0,X.a)(),{project:T}=(0,g.Om)(),{data:A}=(0,H.Hw)({projectRef:null==T?void 0:T.ref,connectionString:null==T?void 0:T.connectionString,schema:null!=(n=null==D?void 0:D.schema)?n:void 0}),_=()=>{p([])};return(0,l.jsxs)("div",{className:(0,Y.cn)("flex flex-col relative",i),style:{width:o||"100%",height:r||"50vh"},children:[0===(null!=d?d:[]).length&&(0,l.jsxs)("div",{style:{height:"calc(100% - 35px)"},className:"absolute top-9 z-[2] p-2 w-full",children:[m&&(0,l.jsx)(Z.y,{}),h&&(0,l.jsx)(U.A,{error:u,subject:"Failed to retrieve rows from table",children:x.length>0&&(0,l.jsx)("p",{children:"Verify that the filter values are correct, as the error may stem from an incorrectly applied filter"})}),f&&(0,l.jsx)(l.Fragment,{children:0===(null!=x?x:[]).length?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center col-span-full h-full",children:[(0,l.jsx)("p",{className:"text-sm text-light",children:"This table is empty"}),(0,l.jsx)("p",{className:"text-sm text-light mt-1",children:"Add rows to your table to get started."}),(0,l.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,l.jsx)(L.$,{type:"default",onClick:()=>{var e,t;v.onImportData(),k({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:null!=(e=null==T?void 0:T.ref)?e:"Unknown",organization:null!=(t=null==E?void 0:E.slug)?t:"Unknown"}})},children:"Import data from CSV"})})]}):(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center col-span-full",children:[(0,l.jsx)("p",{className:"text-sm text-light",children:"The filters applied have returned no results from this table"}),(0,l.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,l.jsx)(L.$,{type:"default",onClick:()=>_(),children:"Remove all filters"})})]})})]}),(0,l.jsx)(q.Ay,{ref:t,className:"".concat(s," flex-grow"),rowClass:c,columns:C.gridColumns,rows:null!=d?d:[],renderers:{renderRow:er},rowKeyGetter:ei,selectedRows:C.selectedRows,onColumnResize:C.updateColumnSize,onRowsChange:N,onSelectedCellChange:function(e){S.current=e,C.setSelectedCellPosition({idx:e.column.idx,rowIdx:e.rowIdx})},onSelectedRowsChange:function(e){C.setSelectedRows(e)},onCellDoubleClick:e=>(function(e,t){let n=function(e){var t,n;let{targetTableSchema:l,targetTableName:o,targetColumnName:a}=null!=(n=null==D||null==(t=D.columns.find(t=>t.name==e))?void 0:t.foreignKey)?n:{},r=null==A?void 0:A.find(t=>t.source_schema===(null==D?void 0:D.schema)&&t.source_table===(null==D?void 0:D.name)&&t.source_columns.includes(e)&&t.target_schema===l&&t.target_table===o&&t.target_columns.includes(a));return void 0!==r?(0,$.C)([r])[0]:void 0}(t.name);n&&v.onEditForeignKeyColumnValue({foreignKey:n,row:e,column:t})})(e.row,e.column),onCellKeyDown:j.GL})]})}));var ec=n(83745);let ed=e=>{var t;let{customHeader:n,gridProps:o,children:i}=e,{id:s}=(0,r.g)(),c=s?Number(s):void 0,{project:d}=(0,g.Om)(),u=(0,b.ap)(),C=(0,w.Ir)(),S=(0,a.useRef)(null),[D,k]=(0,a.useState)(!1),{filters:R,sorts:E,setParams:T}=(0,p.o)(),A=(0,j.FU)(C.table.name,E),_=(0,j.hl)(R),I=(0,a.useCallback)(e=>{C.setEnforceExactCount(!1),C.setPage(1);let t=(0,j.E9)(e);T(e=>({...e,filter:t})),(null==d?void 0:d.ref)&&(0,j.$S)({projectRef:d.ref,tableName:C.table.name,schema:C.table.schema,filters:t})},[null==d?void 0:d.ref,C.table.name,C.table.schema]),P=(0,y.RY)(),{data:L,error:O,isSuccess:F,isError:K,isLoading:M,isRefetching:G}=(0,x.vs)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString,tableId:c,sorts:A,filters:_,page:C.page,limit:u.rowsPerPage,roleImpersonationState:P},{keepPreviousData:!0,retryDelay:(e,t)=>{var n;return(t&&(null==(n=t.message)?void 0:n.includes("does not exist"))&&T(e=>({...e,sort:void 0})),e>3)?1/0:5e3}});(0,a.useEffect)(()=>{D||k(!0)},[]);let Q=null!=(t=null==L?void 0:L.rows)?t:v.Oj;return(0,l.jsx)(m.Q,{backend:f.t2,context:window,"data-sentry-element":"DndProvider","data-sentry-component":"SupabaseGrid","data-sentry-source-file":"SupabaseGrid.tsx",children:(0,l.jsxs)("div",{className:"sb-grid h-full flex flex-col",children:[(0,l.jsx)(ec.Ay,{sorts:A,filters:_,customHeader:n,"data-sentry-element":"Header","data-sentry-source-file":"SupabaseGrid.tsx"}),i||(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(es,{ref:S,...o,rows:Q,error:O,isLoading:M,isSuccess:F,isError:K,filters:_,onApplyFilters:I}),(0,l.jsx)(W,{isRefetching:G}),(0,l.jsx)(N,{gridRef:S,rows:Q})]}),D&&(0,h.createPortal)((0,l.jsx)(ea.Td,{rows:Q}),document.body)]})})};var eu=n(62517),em=n(65904),ef=n(83634),eh=n(36365),eg=n(10170),ex=n(79175),ep=n(82942),ev=n(95875),ey=n(14360),eb=n(796),ew=n(63320),ej=n.n(ew),eC=n(17234),eN=n(56947),eS=n(77570),eD=n(59639),ek=n(68324);let eR=e=>{let{id:t}=e;return"\n    ".concat(eD.n,"\n\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ").concat(t,"\n    )\n    select pg_temp.pg_get_tabledef (\n      t.schema,\n      t.name,\n      false,\n      'FKEYS_INTERNAL',\n      'INCLUDE_TRIGGERS'\n    ) as definition\n    from table_info t;\n  ").trim()};async function eE(e,t){let{projectRef:n,connectionString:l,id:o}=e;if(!o)throw Error("id is required");let a=eR({id:o}),{result:r}=await (0,eS.E)({projectRef:n,connectionString:l,sql:a,queryKey:["table-definition",o]},t);return r[0].definition.trim()}let eT=function(e){let{projectRef:t,connectionString:n,id:l}=e,{enabled:o=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,eN.I)(ek.c.tableDefinition(t,l),e=>{let{signal:o}=e;return eE({projectRef:t,connectionString:n,id:l},o)},{enabled:o&&void 0!==t&&void 0!==l&&!isNaN(l),...a})};var eA=n(82260),e_=n(34586),eI=n(90206);let eP=e=>{let{entity:t}=e,{ref:n}=(0,r.g)(),o=(0,a.useRef)(null),i=(0,a.useRef)(null),{resolvedTheme:s}=(0,eb.D)(),{project:c}=(0,g.Om)(),d=(0,eA.G_)({id:null==t?void 0:t.id,projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString},{enabled:(0,R.b4)(t)}),u=eT({id:null==t?void 0:t.id,projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString},{enabled:(0,R.KO)(t)}),{data:m,isLoading:f}=(0,R.b4)(t)?d:u,h=(0,R.eg)(t)?"create view ".concat(t.schema,".").concat(t.name," as\n"):(0,R.rW)(t)?"create materialized view ".concat(t.schema,".").concat(t.name," as\n"):"",x=(0,a.useMemo)(()=>m?(0,e_.A)(h+m):void 0,[m]),p=async(e,t)=>{o.current=e,i.current=t,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),await (0,eI.wR)(500),null==e||e.focus()};return f?(0,l.jsxs)("div",{className:"h-full grid",children:[(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)(eC.y,{})}),(0,l.jsx)("div",{className:"mt-auto",children:(0,l.jsx)(W,{})})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex-grow overflow-y-auto border-t border-muted relative",children:[(0,l.jsx)(L.$,{asChild:!0,type:"default",className:"absolute top-2 right-5 z-10","data-sentry-element":"Button","data-sentry-source-file":"TableDefinition.tsx",children:(0,l.jsx)(ej(),{href:"/project/".concat(n,"/sql/new?content=").concat(encodeURIComponent(null!=x?x:"")),"data-sentry-element":"Link","data-sentry-source-file":"TableDefinition.tsx",children:"Open in SQL Editor"})}),(0,l.jsx)(ey.default,{className:"monaco-editor",theme:(null==s?void 0:s.includes("dark"))?"vs-dark":"vs",onMount:p,defaultLanguage:"pgsql",value:x,path:"",options:{domReadOnly:!0,readOnly:!0,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0},"data-sentry-element":"Editor","data-sentry-source-file":"TableDefinition.tsx"})]}),(0,l.jsx)(W,{"data-sentry-element":"Footer","data-sentry-source-file":"TableDefinition.tsx"})]})},eL=e=>{var t;let{isLoadingSelectedTable:n=!1,selectedTable:s}=e,d=(0,o.useRouter)(),m=(0,eu.l)(),f=(0,ef.KT)(),h=(0,eg.qM)(),{ref:g,id:x}=(0,r.g)(),p=(0,ex.ZG)(g),v=(0,i.mh)();(0,j.VO)({projectRef:g,table:s});let[{view:y="data"}]=(0,E.W)(),b=(0,em.SE)(c.aG.TENANT_SQL_ADMIN_WRITE,"tables"),C=(0,em.SE)(c.aG.TENANT_SQL_ADMIN_WRITE,"columns"),N=x?p.openTabs.find(e=>e.endsWith(x)):void 0,S=(0,a.useCallback)(e=>{d.push("/project/".concat(g,"/editor/").concat(e.id))},[g,d]),D=()=>{g&&m&&h.setDashboardHistory(g,"table"===m?"editor":m,void 0)};if(n||!g)return(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("div",{className:"h-10 bg-dash-sidebar dark:bg-surface-100"}),(0,l.jsx)("div",{className:"h-9 border-y"}),(0,l.jsx)("div",{className:"p-2 col-span-full",children:(0,l.jsx)(Z.y,{})})]});if(u()(s))return(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)("div",{className:"w-[400px]",children:(0,l.jsx)(ep.Z,{type:"default",title:"Unable to find your table with ID ".concat(x),description:"This table doesn't exist in your database",children:v&&(0,l.jsx)(L.$,{type:"default",className:"mt-2",onClick:()=>{N&&(0,ex.cO)({ref:g,id:N,router:d,editor:m,onClearDashboardHistory:D})},children:"Close tab"})})})});let k=(0,R.eg)(s)||(0,R.rW)(s),T=(0,R.KO)(s),A=eh.i.includes(null!=(t=null==s?void 0:s.schema)?t:""),_=!(!b&&!C)&&T&&!A,I="".concat(s.schema,"_").concat(s.name);return(0,l.jsx)("div",{className:"h-full",onClick:()=>(0,ex.Q8)(null==f?void 0:f.ref),"data-sentry-component":"TableGridEditor","data-sentry-source-file":"TableGridEditor.tsx",children:(0,l.jsxs)(w.HQ,{projectRef:g,table:s,editable:_,"data-sentry-element":"TableEditorTableStateContextProvider","data-sentry-source-file":"TableGridEditor.tsx",children:[(0,l.jsx)(ed,{gridProps:{height:"100%"},customHeader:(k||T)&&"definition"===y?(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)("p",{children:["SQL Definition of ",(0,l.jsx)("code",{className:"text-sm",children:s.name})," "]}),(0,l.jsx)("p",{className:"text-foreground-light text-sm",children:"(Read only)"})]}):null,"data-sentry-element":"SupabaseGrid","data-sentry-source-file":"TableGridEditor.tsx",children:(k||T)&&"definition"===y&&(0,l.jsx)(eP,{entity:s})},I),(0,l.jsx)(ev.A,{editable:_,selectedTable:(0,R.KO)(s)?s:void 0,onTableCreated:S,"data-sentry-element":"SidePanelEditor","data-sentry-source-file":"TableGridEditor.tsx"})]},"table-editor-table-".concat(s.id))})};var eO=n(67397),eF=n(10670),eK=n(9418),eM=n(96240);let eG=()=>{let{id:e,ref:t}=(0,r.g)(),n=e?Number(e):void 0,c=(0,ex.IT)(t),{project:d}=(0,g.Om)(),{data:u,isLoading:m}=(0,k.Pk)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString,id:n}),f=(0,o.useRouter)(),h=(0,a.useCallback)(e=>{e.length>0?f.push("/project/".concat(t,"/editor/").concat(e[0].id)):f.push("/project/".concat(t,"/editor"))},[f,t]),x=(0,i.mh)();return(0,a.useEffect)(()=>{if(x&&u&&t){let e=(0,ex.lW)(u.entity_type,{id:u.id});c.tabsMap[e]?c.activeTab=e:(0,ex.Hm)(t,{id:e,type:u.entity_type,label:u.name,metadata:{schema:u.schema,name:u.name,tableId:n}})}},[u,n,t,x]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eL,{isLoadingSelectedTable:m,selectedTable:u,"data-sentry-element":"TableGridEditor","data-sentry-source-file":"[id].tsx"}),(0,l.jsx)(s.A,{selectedTable:u,onAfterDeleteTable:h,"data-sentry-element":"DeleteConfirmationDialogs","data-sentry-source-file":"[id].tsx"})]})};eG.getLayout=e=>(0,l.jsx)(eO.A,{children:(0,l.jsx)(eF.$,{productMenu:(0,l.jsx)(eM.A,{}),product:"Table Editor",children:(0,l.jsx)(eK.A,{children:e})})});let eQ=eG},63236:(e,t,n)=>{"use strict";n.d(t,{A:()=>F});var l=n(80263),o=n(66452),a=n(63320),r=n.n(a),i=n(73969),s=n(5942),c=n(45969),d=n(87120),u=n(32144),m=n(80251),f=n(1438),h=n(77570),g=n(28128),x=n(29127),p=n(30053),v=n(30038);async function y(e){let{projectRef:t,connectionString:n,table:l,filters:o,roleImpersonationState:a}=e,r=(0,g.Nf)(function(e){var t;let{table:n,filters:l}=e,o=new f.Query().from(n.name,null!=(t=n.schema)?t:void 0).delete();return l.filter(e=>e.value&&""!==e.value).forEach(e=>{let t=(0,v.b)(n,e);o=o.filter(e.column,e.operator,t)}),o.toSql()}({table:l,filters:o}),a),{result:i}=await (0,h.E)({projectRef:t,connectionString:n,sql:r,isRoleImpersonationEnabled:(0,x._c)(null==a?void 0:a.role)});return i}let b=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,u.jE)();return(0,m.n)(e=>y(e),{async onSuccess(t,n,o){let{projectRef:a,table:r}=n;await l.invalidateQueries(p.j.tableRowsAndCount(a,r.id)),await (null==e?void 0:e(t,n,o))},async onError(e,n,l){void 0===t?i.oR.error("Failed to delete all table rows: ".concat(e.message)):t(e,n,l)},...n})};var w=n(57947),j=n(67007);async function C(e){let{projectRef:t,connectionString:n,table:l,rows:o,roleImpersonationState:a}=e,r=(0,g.Nf)(function(e){var t;let{table:n,rows:l}=e,{primaryKeys:o,error:a}=(0,v.j)({table:n});if(a)throw a;let r=new f.Query().from(n.name,null!=(t=n.schema)?t:void 0).delete();return null==o||o.forEach(e=>{let t=l.map(t=>t[e]);r=r.filter(e,"in",t)}),r.toSql()}({table:l,rows:o}),a),{result:i}=await (0,h.E)({projectRef:t,connectionString:n,sql:r,isRoleImpersonationEnabled:(0,x._c)(null==a?void 0:a.role)});return i}let N=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,u.jE)();return(0,m.n)(e=>C(e),{async onSuccess(t,n,l){let{projectRef:a,table:r}=n;await o.invalidateQueries(p.j.tableRowsAndCount(a,r.id)),await (null==e?void 0:e(t,n,l))},async onError(e,n,o){if(void 0===t){let{table:t,rows:o}=n,a=e.message.includes("Please add a primary key column"),r=e.message.includes("violates foreign key constraint"),s=o.length>1;if(r){let n=t.name,o=e.message.split("on table ")[2].replaceAll('"',""),a=e.message.split("foreign key constraint")[1].split("on table")[0].replaceAll('"',""),r=s?"Unable to delete rows as one of them is currently referenced by a foreign key constraint from the table `".concat(o,"`."):"Unable to delete row as it is currently referenced by a foreign key constraint from the table `".concat(o,"`."),c="Set an on delete behavior on the foreign key relation `".concat(a,"` in the `").concat(o,"` table to automatically respond when row(s) are being deleted in the `").concat(n,"` table.");(0,i.oR)(r,{description:(0,l.jsx)(w.o,{content:c,className:"[&>p]:m-0"}),action:(0,l.jsx)("div",{className:"w-full flex gap-x-2 !mx-0 mt-3",children:(0,l.jsx)(j.A,{href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes"})})})}else a?(0,i.oR)("Unable to delete row(s) as table has no primary keys",{description:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,l.jsx)("div",{className:"mt-3",children:(0,l.jsx)(j.A,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})}):i.oR.error("Failed to delete table row: ".concat(e.message))}else t(e,n,o)},...n})};async function S(e){let{projectRef:t,connectionString:n,table:l}=e,o=function(e){var t;let{table:n}=e;return new f.Query().from(n.name,null!=(t=n.schema)?t:void 0).truncate().toSql()}({table:l}),{result:a}=await (0,h.E)({projectRef:t,connectionString:n,sql:o});return a}let D=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,u.jE)();return(0,m.n)(e=>S(e),{async onSuccess(t,n,o){let{projectRef:a,table:r}=n;await l.invalidateQueries(p.j.tableRowsAndCount(a,r.id)),await (null==e?void 0:e(t,n,o))},async onError(e,n,l){void 0===t?i.oR.error("Failed to truncate table row: ".concat(e.message)):t(e,n,l)},...n})};var k=n(53148),R=n(45276),E=n(7298),T=n(86303),A=n(9594),_=n(2411),I=n(98883),P=n(16601),L=n(36212),O=n(45732);let F=e=>{var t,n,a,u,m,f,h,g,p;let{selectedTable:v,onAfterDeleteTable:y=T.lQ}=e,{project:w}=(0,c.Om)(),j=(0,A.ap)(),{selectedSchema:C}=(0,E.k)(),{filters:S,setParams:F}=(0,O.o)(),K=(0,s.hl)(S),M=(0,R.Jc)({projectRef:null==w?void 0:w.ref,connectionString:null==w?void 0:w.connectionString}),G=e=>{let{ref:t,tableName:n,schema:l,columnName:o}=e;F(e=>{var a,r;let i=null!=(a=null==e?void 0:e.filter)?a:[],c=null!=(r=null==e?void 0:e.sort)?r:[],d={filter:i.filter(e=>{let[t]=e.split(":");if(t!==o)return e}),sort:c.filter(e=>{let[t]=e.split(":");if(t!==o)return e})};return(0,s.kz)({projectRef:t,tableName:n,schema:l,filters:d.filter,sorts:d.sort}),{...e,...d}})},{mutate:Q}=(0,d.T)({onSuccess:()=>{var e;if((null==(e=j.confirmationDialog)?void 0:e.type)!=="column")return;let t=j.confirmationDialog.column;(null==w?void 0:w.ref)&&(null==v?void 0:v.name)&&(G({ref:null==w?void 0:w.ref,tableName:null==v?void 0:v.name,schema:t.schema,columnName:t.name}),i.oR.success('Successfully deleted column "'.concat(t.name,'"')))},onError:e=>{var t;if((null==(t=j.confirmationDialog)?void 0:t.type)!=="column")return;let n=j.confirmationDialog.column;i.oR.error("Failed to delete ".concat(n.name,": ").concat(e.message))},onSettled:()=>{j.closeConfirmationDialog()}}),{mutate:z}=(0,k.A)({onSuccess:async()=>{y(await M(C)),i.oR.success('Successfully deleted table "'.concat(null==v?void 0:v.name,'"'))},onError:e=>{i.oR.error("Failed to delete ".concat(null==v?void 0:v.name,": ").concat(e.message))},onSettled:()=>{j.closeConfirmationDialog()}}),{mutate:W}=N({onSuccess:()=>{var e,t,n;(null==(e=j.confirmationDialog)?void 0:e.type)==="row"&&(null==(t=(n=j.confirmationDialog).callback)||t.call(n)),i.oR.success("Successfully deleted selected row(s)")},onSettled:()=>{j.closeConfirmationDialog()}}),{mutate:q}=b({onSuccess:()=>{var e,t,n;(null==(e=j.confirmationDialog)?void 0:e.type)==="row"&&(null==(t=(n=j.confirmationDialog).callback)||t.call(n)),i.oR.success("Successfully deleted selected rows")},onError:e=>{i.oR.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{j.closeConfirmationDialog()}}),{mutate:$}=D({onSuccess:()=>{var e,t,n;(null==(e=j.confirmationDialog)?void 0:e.type)==="row"&&(null==(t=(n=j.confirmationDialog).callback)||t.call(n)),i.oR.success("Successfully deleted all rows from table")},onError:e=>{i.oR.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{j.closeConfirmationDialog()}}),U=(null==(t=j.confirmationDialog)?void 0:t.type)==="row"&&j.confirmationDialog.allRowsSelected,H=(null==(n=j.confirmationDialog)?void 0:n.type)==="row"?j.confirmationDialog.allRowsSelected?null!=(p=j.confirmationDialog.numRows)?p:0:j.confirmationDialog.rows.length:0,V=((null==(a=j.confirmationDialog)?void 0:a.type)==="column"||(null==(u=j.confirmationDialog)?void 0:u.type)==="table")&&j.confirmationDialog.isDeleteWithCascade,X=async()=>{var e;if((null==(e=j.confirmationDialog)?void 0:e.type)!=="column"||void 0===w)return;let t=j.confirmationDialog.column;void 0!==t&&Q({id:t.id,cascade:V,projectRef:w.ref,connectionString:null==w?void 0:w.connectionString,table:v})},Y=async()=>{var e;(null==(e=j.confirmationDialog)?void 0:e.type)==="table"&&void 0!==v&&z({projectRef:null==w?void 0:w.ref,connectionString:null==w?void 0:w.connectionString,schema:v.schema,id:v.id,cascade:V})},Z=(0,x.Qj)(),B=async()=>{var e;if(!w)return console.error("Project ref is required");if(!v)return console.error("Selected table required");if((null==(e=j.confirmationDialog)?void 0:e.type)!=="row")return;let t=j.confirmationDialog.rows;if(j.confirmationDialog.allRowsSelected)if(0===K.length){if(void 0!==Z().role)return j.closeConfirmationDialog(),i.oR.error("Table truncation is not supported when impersonating a role");$({projectRef:w.ref,connectionString:w.connectionString,table:v})}else q({projectRef:w.ref,connectionString:w.connectionString,table:v,filters:K,roleImpersonationState:Z()});else W({projectRef:w.ref,connectionString:w.connectionString,table:v,rows:t,roleImpersonationState:Z()})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(L.A,{variant:"destructive",size:"small",visible:(null==(m=j.confirmationDialog)?void 0:m.type)==="column",title:'Confirm deletion of column "'.concat((null==(f=j.confirmationDialog)?void 0:f.type)==="column"&&j.confirmationDialog.column.name,'"'),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{j.closeConfirmationDialog()},onConfirm:X,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected column? This action cannot be undone."}),(0,l.jsx)(_.A,{label:"Drop column with cascade?",description:"Deletes the column and its dependent objects",checked:V,onChange:()=>j.toggleConfirmationIsWithCascade(),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),V&&(0,l.jsxs)(I.Fc,{variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,l.jsx)(I.XL,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,l.jsx)(I.TN,{children:(0,l.jsx)(P.$,{asChild:!0,size:"tiny",type:"default",icon:(0,l.jsx)(o.A,{}),children:(0,l.jsx)(r(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,l.jsx)(L.A,{variant:"destructive",size:"small",visible:(null==(h=j.confirmationDialog)?void 0:h.type)==="table",title:(0,l.jsx)("span",{className:"break-words",children:'Confirm deletion of table "'.concat(null==v?void 0:v.name,'"')}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{j.closeConfirmationDialog()},onConfirm:Y,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected table? This action cannot be undone."}),(0,l.jsx)(_.A,{label:"Drop table with cascade?",description:"Deletes the table and its dependent objects",checked:V,onChange:()=>j.toggleConfirmationIsWithCascade(!V),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),V&&(0,l.jsxs)(I.Fc,{variant:"warning",children:[(0,l.jsx)(I.XL,{children:"Warning: Dropping with cascade may result in unintended consequences"}),(0,l.jsx)(I.TN,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,l.jsx)(I.TN,{className:"mt-4",children:(0,l.jsx)(P.$,{asChild:!0,size:"tiny",type:"default",icon:(0,l.jsx)(o.A,{}),children:(0,l.jsx)(r(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,l.jsx)(L.A,{variant:"destructive",size:"small",visible:(null==(g=j.confirmationDialog)?void 0:g.type)==="row",title:(0,l.jsxs)("p",{className:"break-words",children:[(0,l.jsx)("span",{children:"Confirm to delete the selected row"}),(0,l.jsx)("span",{children:H>1&&"s"})]}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>j.closeConfirmationDialog(),onConfirm:()=>B(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsxs)("p",{className:"text-sm text-foreground-light",children:[(0,l.jsx)("span",{children:"Are you sure you want to delete "}),(0,l.jsxs)("span",{children:[U?"all":"the selected"," "]}),(0,l.jsx)("span",{children:H>1&&"".concat(H," ")}),(0,l.jsx)("span",{children:"row"}),(0,l.jsx)("span",{children:H>1&&"s"}),(0,l.jsx)("span",{children:"? This action cannot be undone."})]})})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[89,4335,9413,6110,3342,4376,2180,7990,8058,5513,5944,4346,2981,6835,7762,9067,2809,6692,9711,6616,5927,6404,488,9016,8591,2722,7397,886,1152,8601,8554,3131,3381,9440,6232,18,6593,636,8792],()=>t(5062)),_N_E=e.O()}]);