!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a898b03c-7b53-46d7-bb50-58039924fc0e",e._sentryDebugIdIdentifier="sentry-dbid-a898b03c-7b53-46d7-bb50-58039924fc0e")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7006],{2081:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var a=n(80263),r=n(64238),s=n(81372),l=n(53239),i=n(90206),o=n(16601),c=n(2);let d=e=>{var t;let{text:n,asyncText:d,iconOnly:u=!1,children:m,onClick:p,copyLabel:_="Copy",copiedLabel:E="Copied",...h}=e,[g,f]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(!g)return;let e=setTimeout(()=>f(!1),2e3);return()=>clearTimeout(e)},[g]),(0,a.jsx)(o.$,{onClick:async e=>{let t=d?await d():n;f(!0),await (0,i.lW)(t),null==p||p(e)},...h,className:(0,c.cn)({"px-1":u},h.className),icon:g?(0,a.jsx)(r.A,{strokeWidth:2,className:"text-brand"}):null!=(t=h.icon)?t:(0,a.jsx)(s.A,{}),"data-sentry-element":"Button","data-sentry-component":"CopyButton","data-sentry-source-file":"CopyButton.tsx",children:!u&&(0,a.jsx)(a.Fragment,{children:null!=m?m:g?E:_})})}},2468:(e,t,n)=>{"use strict";n.d(t,{e:()=>c});var a=n(63719),r=n(56947),s=n(68324),l=n(77570);let i=a.A.functions.list();async function o(e,t,n){let{projectRef:a,connectionString:r}=e,s=new Headers(n),{result:o}=await (0,l.E)({projectRef:a,connectionString:r,sql:i.sql,queryKey:["database-functions"]},t,s);return o}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.I)(s.c.databaseFunctions(t),e=>{let{signal:a}=e;return o({projectRef:t,connectionString:n},a)},{enabled:a&&void 0!==t,...l})}},2743:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(47370).A)("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]])},4771:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(47370).A)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]])},9603:(e,t,n)=>{"use strict";n.d(t,{C_:()=>d,E6:()=>l,HH:()=>o,OK:()=>a,fE:()=>i,ql:()=>c});let a={TICK:"hsl(var(--background-overlay-hover))",AXIS:"hsl(var(--background-overlay-hover))",GREEN_1:"hsl(var(--brand-default))",GREEN_2:"hsl(var(--brand-500))",RED_1:"hsl(var(--destructive-default))",RED_2:"hsl(var(--destructive-500))"},r=["#3ECF8E","#097c4f","#DA760B","#EDC35E","#65BCD9","#0063E8","#DB8DF9","#B616A6"],s=["#3ECF8E","#A3FFC2","#DA760B","#EDD35E","#65BCD9","#0063E8","#DB8DF9","#B616A6"],l=r,i=e=>{l=e?s:r},o=e=>e.map(e=>{var t;let n=null!=(t=({slate:11})[e])?t:9;return{lighter:"var(--colors-".concat(e).concat(n-1,")"),base:"var(--colors-".concat(e).concat(n,")"),darker:"var(--colors-".concat(e).concat(n+1,")")}}),c=["brand","slate","blue","yellow","indigo"];var d=function(e){return e.FULL="MMM D, YYYY, hh:mma",e.FULL_SECONDS="MMM D, YYYY, hh:mm:ssa",e.DATE_ONLY="MMM D, YYYY",e}({})},11426:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/sql/[id]",function(){return n(71115)}])},12011:(e,t,n)=>{"use strict";n.d(t,{C:()=>s});var a=n(80263),r=n(2);let s=e=>{let{children:t,className:n}=e;return(0,a.jsx)("div",{className:(0,r.cn)("flex min-h-9 h-9 overflow-hidden overflow-x-auto items-center px-2 w-full border-t",n),"data-sentry-component":"GridFooter","data-sentry-source-file":"GridFooter.tsx",children:t})}},16175:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(47370).A)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]])},18911:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(47370).A)("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]])},21355:(e,t,n)=>{"use strict";n.d(t,{A:()=>_});var a=n(17702),r=n(56947),s=n(53434),l=n.n(s),i=n(53239),o=n(66933),c=n(92589),d=n(3807),u=n(66001),m=n(81028);let p=(e,t)=>(0,i.useMemo)(()=>0!==e.length&&(0,c.l8)(e[0][t])?null==e?void 0:e.map(e=>(e[t]=(0,c.RT)(e[t]),e)):e,[JSON.stringify(e)]),_=function(e){var t,n,s,_,E;let{projectRef:h,table:g,filterOverride:f,limit:v}=e,N=(0,o.Et)(o.Z8),[x,b]=(0,i.useState)(new Date().toISOString()),{timestampStart:y,timestampEnd:I,filters:T,search:S}=(0,u.B)(),A=(0,i.useMemo)(()=>y||N.calcFrom(),[y,N]),R=(0,i.useMemo)(()=>I||N.calcTo(),[I,N]),C=(0,i.useMemo)(()=>({...T,...f,...S?{search_query:S}:{}}),[JSON.stringify(T),JSON.stringify(f),S]),L=(0,i.useMemo)(()=>({project:h,iso_timestamp_start:A,iso_timestamp_end:R,sql:(0,c.qr)(g,C,v)}),[h,A,R,g,C,v]),O=(0,i.useMemo)(()=>["projects",h,"logs",L],[h,L]),{data:j,isSuccess:w,isLoading:D,isRefetching:k,error:F,fetchNextPage:H,isFetchingNextPage:M,refetch:U}=(0,a.q)(O,async e=>{let{signal:t,pageParam:n}=e,{data:a,error:r}=await (0,d.Jt)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:h},query:{...L,iso_timestamp_end:n||L.iso_timestamp_end}},signal:t});if(r)throw r;return a},{refetchOnWindowFocus:!1,getNextPageParam(e){var t,n;if((null!=(n=null==(t=e.result)?void 0:t.length)?n:0)===0)return;let a=e.result.length,{timestamp:r}=e.result[a-1];return l().utc(Number(r/1e3)).toISOString()}}),{logData:P,error:q,oldestTimestamp:W}=(0,i.useMemo)(()=>{var e,t;let n=[],a=F?F.message:null;null==j||null==(e=j.pages)||e.forEach(e=>{(null==e?void 0:e.result)&&(n=[...n,...e.result]),!a&&(null==e?void 0:e.error)&&(a=e.error)});let r=n.length>0?null==(t=n[n.length-1])?void 0:t.timestamp:void 0;return{logData:n,error:a,oldestTimestamp:r}},[null==j?void 0:j.pages]),B=(0,i.useMemo)(()=>(0,c.oZ)(g,C),[g,C]),G=(0,i.useMemo)(()=>["projects",h,"logs-count",{projectRef:h,sql:B,iso_timestamp_start:x,iso_timestamp_end:R,table:g,mergedFilters:C}],[h,B,x,R,g,C]),{data:K}=(0,r.I)(G,async e=>{let{signal:t}=e,{data:n,error:a}=await (0,d.Jt)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:h},query:{project:h,sql:B,iso_timestamp_start:x,iso_timestamp_end:R}},signal:t});if(a)throw a;return n},{refetchOnWindowFocus:!1,refetchInterval:6e4,enabled:!q&&!!j&&(null==j||null==(t=j.pages)?void 0:t.length)>0}),Y=null!=(_=null==K||null==(s=K.result)||null==(n=s[0])?void 0:n.count)?_:0,z=(0,i.useMemo)(()=>(0,c.tS)(g,L,C),[g,L,C]),Q=(0,i.useMemo)(()=>["projects",h,"logs-chart",{projectRef:h,sql:z,iso_timestamp_start:A,iso_timestamp_end:R}],[h,z,A,R]),{data:X,refetch:V}=(0,r.I)(Q,async e=>{let{signal:t}=e,{data:n,error:a}=await (0,d.Jt)("/platform/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:h},query:{iso_timestamp_start:A,iso_timestamp_end:R,project:h,sql:z}},signal:t});if(a)throw a;return n},{refetchOnWindowFocus:!1}),$=(0,i.useCallback)(async()=>{b(new Date().toISOString()),V(),U()},[U,V]),J=p(null!=(E=null==X?void 0:X.result)?E:[],"timestamp"),{data:Z,error:ee}=(0,m.m)(J,"timestamp","count",0,A,R||new Date().toISOString());return{newCount:Y,logData:P,isSuccess:w,isLoading:D||k,isLoadingOlder:M,error:q||ee,filters:C,params:L,oldestTimestamp:W?String(W):void 0,eventChartData:Z,refresh:$,loadOlder:()=>H()}}},29209:(e,t,n)=>{"use strict";n.d(t,{nz:()=>c});var a=n(56947),r=n(77570),s=n(59639),l=n(68324);let i=e=>{let{schemas:t,limit:n=100}=e;return"\n".concat(s.n,"\n\nwith records as (\n  select\n    c.oid::int8 as \"id\",\n    case c.relkind\n      when 'r' then pg_temp.pg_get_tabledef(\n        concat(nc.nspname),\n        concat(c.relname),\n        false,\n        'FKEYS_INTERNAL',\n        'NO_TRIGGERS'\n      )\n      when 'v' then concat(\n        'create view ', concat(nc.nspname, '.', c.relname), ' as',\n        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)\n      )\n      when 'm' then concat(\n        'create materialized view ', concat(nc.nspname, '.', c.relname), ' as',\n        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)\n      )\n      when 'f' then concat('create foreign table ', nc.nspname, '.', c.relname, ' ( ... )')\n      when 'p' then pg_temp.pg_get_tabledef(\n        concat(nc.nspname),\n        concat(c.relname),\n        false,\n        'FKEYS_INTERNAL',\n        'NO_TRIGGERS'\n      )\n    end as \"sql\"\n  from\n    pg_namespace nc\n    join pg_class c on nc.oid = c.relnamespace\n  where\n    c.relkind in ('r', 'v', 'm', 'f', 'p')\n    and not pg_is_other_temp_schema(nc.oid)\n    and (\n      pg_has_role(c.relowner, 'USAGE')\n      or has_table_privilege(\n        c.oid,\n        'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n      )\n      or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n    and nc.nspname IN (").concat(t.map(e=>"'".concat(e,"'")).join(", "),")\n  order by c.relname asc\n  limit ").concat(n,"\n  offset 0\n)\nselect\n  jsonb_build_object(\n    'definitions', coalesce(jsonb_agg(\n      jsonb_build_object(\n        'id', r.id,\n        'sql', r.sql\n      )\n    ), '[]'::jsonb)\n  ) \"data\"\nfrom records r;\n  ").trim()};async function o(e,t){let{projectRef:n,connectionString:a,schemas:s,limit:l}=e,o=i({schemas:s,limit:l}),{result:c}=await (0,r.E)({projectRef:n,connectionString:a,sql:o,queryKey:["entity-definitions",s]},t);return c[0].data.definitions}let c=function(e){let{projectRef:t,connectionString:n,schemas:r,limit:s}=e,{enabled:i=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)(l.c.entityDefinitions(t,r),e=>{let{signal:a}=e;return o({projectRef:t,connectionString:n,schemas:r,limit:s},a)},{enabled:i&&void 0!==t&&r.length>0,...c})}},29819:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(47370).A)("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]])},37427:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(47370).A)("GitCommitHorizontal",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]])},44893:(e,t,n)=>{"use strict";n.d(t,{bL:()=>x,zi:()=>b});var a=n(54993),r=n(53239),s=n(91968),l=n(63774),i=n(68436),o=n(87990),c=n(15630),d=n(89422),u=n(70297);let m="Switch",[p,_]=(0,i.A)(m),[E,h]=p(m),g=(0,r.forwardRef)((e,t)=>{let{__scopeSwitch:n,name:i,checked:c,defaultChecked:d,required:m,disabled:p,value:_="on",onCheckedChange:h,...g}=e,[f,x]=(0,r.useState)(null),b=(0,l.s)(t,e=>x(e)),y=(0,r.useRef)(!1),I=!f||!!f.closest("form"),[T=!1,S]=(0,o.i)({prop:c,defaultProp:d,onChange:h});return(0,r.createElement)(E,{scope:n,checked:T,disabled:p},(0,r.createElement)(u.sG.button,(0,a.A)({type:"button",role:"switch","aria-checked":T,"aria-required":m,"data-state":N(T),"data-disabled":p?"":void 0,disabled:p,value:_},g,{ref:b,onClick:(0,s.m)(e.onClick,e=>{S(e=>!e),I&&(y.current=e.isPropagationStopped(),y.current||e.stopPropagation())})})),I&&(0,r.createElement)(v,{control:f,bubbles:!y.current,name:i,value:_,checked:T,required:m,disabled:p,style:{transform:"translateX(-100%)"}}))}),f=(0,r.forwardRef)((e,t)=>{let{__scopeSwitch:n,...s}=e,l=h("SwitchThumb",n);return(0,r.createElement)(u.sG.span,(0,a.A)({"data-state":N(l.checked),"data-disabled":l.disabled?"":void 0},s,{ref:t}))}),v=e=>{let{control:t,checked:n,bubbles:s=!0,...l}=e,i=(0,r.useRef)(null),o=(0,c.Z)(n),u=(0,d.X)(t);return(0,r.useEffect)(()=>{let e=i.current,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(o!==n&&t){let a=new Event("click",{bubbles:s});t.call(e,n),e.dispatchEvent(a)}},[o,n,s]),(0,r.createElement)("input",(0,a.A)({type:"checkbox","aria-hidden":!0,defaultChecked:n},l,{tabIndex:-1,ref:i,style:{...e.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function N(e){return e?"checked":"unchecked"}let x=g,b=f},45168:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var a=n(80263),r=n(31277),s=n(2),l=n(83455),i=n(84430);let o=e=>{let{attribute:t,message:n="No data to show",description:o,format:c,className:d="",size:u}=e,{minHeight:m}=(0,i.dQ)(u);return(0,a.jsxs)("div",{"data-sentry-component":"NoDataPlaceholder","data-sentry-source-file":"NoDataPlaceholder.tsx",children:[void 0!==t&&(0,a.jsx)(l.A,{title:t,format:c,highlightedValue:0}),(0,a.jsxs)("div",{className:(0,s.cn)("border-control flex flex-grow w-full flex-col items-center justify-center space-y-2 border border-dashed text-center",d),style:{minHeight:m+20},children:[(0,a.jsx)(r.A,{size:20,className:"text-border-stronger","data-sentry-element":"BarChart2","data-sentry-source-file":"NoDataPlaceholder.tsx"}),(0,a.jsxs)("div",{className:"px-1",children:[(0,a.jsx)("p",{className:"text-foreground-light text-xs",children:n}),o&&(0,a.jsx)("p",{className:"text-foreground-lighter text-xs",children:o})]})]})]})}},47781:(e,t,n)=>{"use strict";n.d(t,{K:()=>E,T:()=>f});var a=n(80263),r=n(53239),s=n(3732),l=n(2),i=n(53434),o=n.n(i),c=n(27344),d=n.n(c),u=n(37361),m=n.n(u);o().extend(d()),o().extend(m());let p=e=>o().unix(Number(e)/1e3/1e3).toISOString(),_=e=>{let t=16===String(e).length;return!Number.isNaN(Number(e))&&t},E=e=>{let{utcTimestamp:t,format:n}=e,a=_(t)?p(t):t;return o().utc(a).local().format(n)},h=e=>{let{utcTimestamp:t,format:n}=e,a=_(t)?p(t):t;return o().utc(a).format(n)},g=e=>{let{utcTimestamp:t}=e,n=_(t)?p(t):t;return o().utc(n).fromNow()},f=e=>{let{utcTimestamp:t,className:n,displayAs:i="local",format:o="DD MMM  HH:mm:ss",labelFormat:c="DD MMM HH:mm:ss"}=e,d=E({utcTimestamp:t,format:o}),u=h({utcTimestamp:t,format:o}),m=g({utcTimestamp:t}),[p,_]=(0,r.useState)("start"),f=(0,r.useRef)(null),v=Intl.DateTimeFormat().resolvedOptions().timeZone;(0,r.useEffect)(()=>{let e=()=>{if(f.current){let e=f.current.getBoundingClientRect(),t=window.innerHeight;_(e.top<t/2?"start":"end")}};return e(),window.addEventListener("scroll",e),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[]);let N=e=>{let{label:t,value:n}=e,[s,i]=(0,r.useState)(!1);return(0,a.jsxs)("div",{onPointerDown:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation(),e.preventDefault(),navigator.clipboard.writeText(n),i(!0),setTimeout(()=>{i(!1)},1e3)},className:(0,l.cn)("relative cursor-pointer flex gap-y-2 gap-x-0.5 hover:bg-surface-100 px-2 py-1 group",{"bg-surface-100":s}),"data-sentry-component":"TooltipRow","data-sentry-source-file":"index.tsx",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2 text-left truncate",children:[(0,a.jsx)("p",{children:t}),(0,a.jsx)("div",{className:"border-t w-full border-dashed"})]}),(0,a.jsxs)("div",{className:"relative flex items-center gap-x-2 flex-grow",children:[(0,a.jsx)("div",{className:"border-t w-full border-dashed z-10"}),s&&(0,a.jsx)("span",{className:"flex items-center justify-end w-full absolute inset-0 flex items-right text-brand-600 bg-surface-100",children:"Copied!"}),(0,a.jsx)("span",{className:"flex items-center gap-x-2 justify-end whitespace-nowrap",children:n})]})]})};return(0,a.jsxs)(s.m_,{"data-sentry-element":"Tooltip","data-sentry-component":"TimestampInfo","data-sentry-source-file":"index.tsx",children:[(0,a.jsx)(s.k$,{asChild:!0,ref:f,className:"text-xs ".concat(n," border-b border-transparent hover:border-dashed hover:border-foreground-light"),"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"index.tsx",children:(0,a.jsx)("span",{children:"local"===i?E({utcTimestamp:t,format:c}):h({utcTimestamp:t,format:c})})}),(0,a.jsxs)(s.ZI,{align:p,side:"right",className:"font-mono p-0 py-1 min-w-80","data-sentry-element":"TooltipContent","data-sentry-source-file":"index.tsx",children:[(0,a.jsx)(N,{label:"UTC",value:u,"data-sentry-element":"TooltipRow","data-sentry-source-file":"index.tsx"}),(0,a.jsx)(N,{label:v,value:d,"data-sentry-element":"TooltipRow","data-sentry-source-file":"index.tsx"}),(0,a.jsx)(N,{label:"Relative",value:m,"data-sentry-element":"TooltipRow","data-sentry-source-file":"index.tsx"}),(0,a.jsx)(N,{label:"Timestamp",value:String(t),"data-sentry-element":"TooltipRow","data-sentry-source-file":"index.tsx"})]})]})}},51551:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(47370).A)("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]])},54045:(e,t,n)=>{"use strict";n.d(t,{A:()=>v});var a=n(80263),r=n(53239),s=n(53434),l=n.n(s),i=n(99212),o=n(13862),c=n(55433),d=n(42417),u=n(53190),m=n(37475),p=n(67435),_=n(15618),E=n(9603),h=n(83455),g=n(84430),f=n(45168);let v=e=>{var t,n,s;let{data:v,yAxisKey:N,xAxisKey:x,format:b,customDateFormat:y=E.C_.FULL,title:I,highlightedValue:T,highlightedLabel:S,displayDateInUtc:A,minimalHeader:R,valuePrecision:C,className:L="",size:O="normal",emptyStateMessage:j,onBarClick:w,showLegend:D=!1,xAxisIsDate:k=!0,XAxisProps:F,YAxisProps:H,showGrid:M=!1}=e,{Container:U}=(0,g.dQ)(O),[P,q]=(0,r.useState)(null),W=(0,r.useMemo)(()=>v.map(e=>({...e,[N]:"string"==typeof e[N]?Number(e[N]):e[N]})),[v,N]),B=F||{interval:v.length-2,angle:0,tick:!1},G=H||{tickFormatter:e=>(0,g.Eg)(e,C),tick:!1,width:0},K=e=>A?l()(e).utc():l()(e),Y=function(){if(!k){var e;return P?null==(e=v[P])?void 0:e[x]:S}return null!==P&&v&&void 0!==v[P]&&K(v[P][x]).format(y)||S}(),z=null!==P?null==(t=v[P])?void 0:t[N]:T;return 0===v.length?(0,a.jsx)(f.A,{message:j,description:"It may take up to 24 hours for data to refresh",size:O,className:L,attribute:I,format:b}):(0,a.jsxs)("div",{className:["flex flex-col gap-y-3",L].join(" "),"data-sentry-component":"BarChart","data-sentry-source-file":"BarChart.tsx",children:[(0,a.jsx)(h.A,{title:I,format:b,customDateFormat:y,highlightedValue:"number"==typeof z?(0,g.Eg)(z,C):z,highlightedLabel:Y,minimalHeader:R,"data-sentry-element":"ChartHeader","data-sentry-source-file":"BarChart.tsx"}),(0,a.jsx)(U,{"data-sentry-element":"Container","data-sentry-source-file":"BarChart.tsx",children:(0,a.jsxs)(i.E,{data:W,className:"overflow-visible",onMouseMove:e=>{e.activeTooltipIndex!==P&&q(e.activeTooltipIndex)},onMouseLeave:()=>q(null),onClick:e=>{var t,n;let a=null==e||null==(n=e.activePayload)||null==(t=n[0])?void 0:t.payload;w&&w(a,e)},"data-sentry-element":"RechartBarChart","data-sentry-source-file":"BarChart.tsx",children:[D&&(0,a.jsx)(o.s,{}),M&&(0,a.jsx)(c.d,{stroke:E.OK.AXIS}),(0,r.createElement)(d.h,{...G,axisLine:{stroke:E.OK.AXIS},tickLine:{stroke:E.OK.AXIS},key:N,"data-sentry-element":"YAxis","data-sentry-source-file":"BarChart.tsx"}),(0,r.createElement)(u.W,{...B,axisLine:{stroke:E.OK.AXIS},tickLine:{stroke:E.OK.AXIS},key:x,"data-sentry-element":"XAxis","data-sentry-source-file":"BarChart.tsx"}),(0,a.jsx)(m.m,{content:()=>null,"data-sentry-element":"Tooltip","data-sentry-source-file":"BarChart.tsx"}),(0,a.jsx)(p.y,{dataKey:N,fill:E.OK.GREEN_1,animationDuration:300,maxBarSize:48,"data-sentry-element":"Bar","data-sentry-source-file":"BarChart.tsx",children:null==v?void 0:v.map((e,t)=>(0,a.jsx)(_.f,{className:"transition-all duration-300 ".concat(w?"cursor-pointer":""),fill:P===t||null===P?E.OK.GREEN_1:E.OK.GREEN_2,enableBackground:12},"cell-".concat(t)))})]})}),v&&(0,a.jsxs)("div",{className:"text-foreground-lighter -mt-9 flex items-center justify-between text-xs",children:[(0,a.jsx)("span",{children:k?K(v[0][x]).format(y):v[0][x]}),(0,a.jsx)("span",{children:k?K(null==(n=v[(null==v?void 0:v.length)-1])?void 0:n[x]).format(y):null==(s=v[(null==v?void 0:v.length)-1])?void 0:s[x]})]})]})}},59639:(e,t,n)=>{"use strict";n.d(t,{n:()=>r,P:()=>s});var a=n(26616);let r=n.n(a)()("\n      DROP TYPE IF EXISTS pg_temp.tabledefs CASCADE;\n      CREATE TYPE pg_temp.tabledefs AS ENUM ('PKEY_INTERNAL','PKEY_EXTERNAL','FKEYS_INTERNAL', 'FKEYS_EXTERNAL', 'COMMENTS', 'FKEYS_NONE', 'INCLUDE_TRIGGERS', 'NO_TRIGGERS');\n\n      -- SELECT * FROM pg_temp.pg_get_coldef('sample','orders','id');\n      -- DROP FUNCTION pg_temp.pg_get_coldef(text,text,text,boolean);\n      CREATE OR REPLACE FUNCTION pg_temp.pg_get_coldef(\n        in_schema text,\n        in_table  text,\n        in_column text,\n        oldway    boolean default False\n      )\n      RETURNS text\n      LANGUAGE plpgsql VOLATILE\n      AS\n      $$\n      DECLARE\n      v_coldef     text;\n      v_dt1        text;\n      v_dt2        text;\n      v_dt3        text;\n      v_nullable   boolean;\n      v_position   int;\n      v_identity   text;\n      v_generated  text;\n      v_hasdflt    boolean;\n      v_dfltexpr   text;\n\n      BEGIN\n        IF oldway THEN\n          SELECT pg_catalog.format_type(a.atttypid, a.atttypmod) INTO v_coldef FROM pg_namespace n, pg_class c, pg_attribute a, pg_type t\n          WHERE n.nspname = in_schema AND n.oid = c.relnamespace AND c.relname = in_table AND a.attname = in_column and a.attnum > 0 AND a.attrelid = c.oid AND a.atttypid = t.oid ORDER BY a.attnum;\n          -- RAISE NOTICE 'DEBUG: oldway=%',v_coldef;\n        ELSE\n          -- a.attrelid::regclass::text, a.attname\n          SELECT CASE WHEN a.atttypid = ANY ('{int,int8,int2}'::regtype[]) AND EXISTS (SELECT FROM pg_attrdef ad WHERE ad.adrelid = a.attrelid AND ad.adnum   = a.attnum AND\n          pg_get_expr(ad.adbin, ad.adrelid) = 'nextval(''' || (pg_get_serial_sequence (a.attrelid::regclass::text, a.attname))::regclass || '''::regclass)') THEN CASE a.atttypid\n          WHEN 'int'::regtype  THEN 'serial' WHEN 'int8'::regtype THEN 'bigserial' WHEN 'int2'::regtype THEN 'smallserial' END ELSE format_type(a.atttypid, a.atttypmod) END AS data_type\n          INTO v_coldef FROM pg_namespace n, pg_class c, pg_attribute a, pg_type t\n          WHERE n.nspname = in_schema AND n.oid = c.relnamespace AND c.relname = in_table AND a.attname = in_column and a.attnum > 0 AND a.attrelid = c.oid AND a.atttypid = t.oid ORDER BY a.attnum;\n          -- RAISE NOTICE 'DEBUG: newway=%',v_coldef;\n\n          -- Issue#24: not implemented yet\n          -- might replace with this below to do more detailed parsing...\n          -- SELECT a.atttypid::regtype AS dt1, format_type(a.atttypid, a.atttypmod) as dt2, t.typname as dt3, CASE WHEN not(a.attnotnull) THEN True ELSE False END AS nullable,\n          -- a.attnum, a.attidentity, a.attgenerated, a.atthasdef, pg_get_expr(ad.adbin, ad.adrelid) dfltexpr\n          -- INTO v_dt1, v_dt2, v_dt3, v_nullable, v_position, v_identity, v_generated, v_hasdflt, v_dfltexpr\n          -- FROM pg_attribute a JOIN pg_class c ON (a.attrelid = c.oid) JOIN pg_type t ON (a.atttypid = t.oid) LEFT JOIN pg_attrdef ad ON (a.attrelid = ad.adrelid AND a.attnum = ad.adnum)\n          -- WHERE c.relkind in ('r','p') AND a.attnum > 0 AND NOT a.attisdropped AND c.relnamespace::regnamespace::text = in_schema AND c.relname = in_table AND a.attname = in_column;\n          -- RAISE NOTICE 'schema=%  table=%  column=%  dt1=%  dt2=%  dt3=%  nullable=%  pos=%  identity=%   generated=%  HasDefault=%  DeftExpr=%', in_schema, in_table, in_column, v_dt1,v_dt2,v_dt3,v_nullable,v_position,v_identity,v_generated,v_hasdflt,v_dfltexpr;\n        END IF;\n        RETURN v_coldef;\n      END;\n      $$;\n\n      -- SELECT * FROM pg_temp.pg_get_tabledef('sample', 'address', false);\n      DROP FUNCTION IF EXISTS pg_temp.pg_get_tabledef(character varying,character varying,boolean,tabledefs[]);\n      CREATE OR REPLACE FUNCTION pg_temp.pg_get_tabledef(\n        in_schema varchar,\n        in_table varchar,\n        _verbose boolean,\n        VARIADIC arr pg_temp.tabledefs[] DEFAULT '{}':: pg_temp.tabledefs[]\n      )\n      RETURNS text\n      LANGUAGE plpgsql VOLATILE\n      AS\n      $$\n        DECLARE\n          v_qualified text := '';\n          v_table_ddl text;\n          v_table_oid int;\n          v_colrec record;\n          v_constraintrec record;\n          v_trigrec       record;\n          v_indexrec record;\n          v_rec           record;\n          v_constraint_name text;\n          v_constraint_def  text;\n          v_pkey_def        text := '';\n          v_fkey_def        text := '';\n          v_fkey_defs       text := '';\n          v_trigger text := '';\n          v_partition_key text := '';\n          v_partbound text;\n          v_parent text;\n          v_parent_schema text;\n          v_persist text;\n          v_temp  text := '';\n          v_temp2 text;\n          v_relopts text;\n          v_tablespace text;\n          v_pgversion int;\n          bSerial boolean;\n          bPartition boolean;\n          bInheritance boolean;\n          bRelispartition boolean;\n          constraintarr text[] := '{}';\n          constraintelement text;\n          bSkip boolean;\n          bVerbose boolean := False;\n          v_cnt1   integer;\n          v_cnt2   integer;\n          search_path_old text := '';\n          search_path_new text := '';\n          v_partial    boolean;\n          v_pos        integer;\n\n          -- assume defaults for ENUMs at the getgo\n          pkcnt            int := 0;\n          fkcnt            int := 0;\n          trigcnt          int := 0;\n          cmtcnt           int := 0;\n          pktype           pg_temp.tabledefs := 'PKEY_INTERNAL';\n          fktype           pg_temp.tabledefs := 'FKEYS_INTERNAL';\n          trigtype         pg_temp.tabledefs := 'NO_TRIGGERS';\n          arglen           integer;\n          vargs            text;\n          avarg            pg_temp.tabledefs;\n\n          -- exception variables\n          v_ret            text;\n          v_diag1          text;\n          v_diag2          text;\n          v_diag3          text;\n          v_diag4          text;\n          v_diag5          text;\n          v_diag6          text;\n\n        BEGIN\n          SET client_min_messages = 'notice';\n          IF _verbose THEN bVerbose = True; END IF;\n\n          -- v17 fix: handle case-sensitive\n          -- v_qualified = in_schema || '.' || in_table;\n\n          arglen := array_length($4, 1);\n          IF arglen IS NULL THEN\n              -- nothing to do, so assume defaults\n              NULL;\n          ELSE\n              -- loop thru args\n              -- IF 'NO_TRIGGERS' = ANY ($4)\n              -- select array_to_string($4, ',', '***') INTO vargs;\n              IF bVerbose THEN RAISE NOTICE 'arguments=%', $4; END IF;\n              FOREACH avarg IN ARRAY $4 LOOP\n                  IF bVerbose THEN RAISE NOTICE 'arg=%', avarg; END IF;\n                  IF avarg = 'FKEYS_INTERNAL' OR avarg = 'FKEYS_EXTERNAL' OR avarg = 'FKEYS_NONE' THEN\n                      fkcnt = fkcnt + 1;\n                      fktype = avarg;\n                  ELSEIF avarg = 'INCLUDE_TRIGGERS' OR avarg = 'NO_TRIGGERS' THEN\n                      trigcnt = trigcnt + 1;\n                      trigtype = avarg;\n                  ELSEIF avarg = 'PKEY_EXTERNAL' THEN\n                      pkcnt = pkcnt + 1;\n                      pktype = avarg;\n                  ELSEIF avarg = 'COMMENTS' THEN\n                      cmtcnt = cmtcnt + 1;\n\n                  END IF;\n              END LOOP;\n              IF fkcnt > 1 THEN\n                  RAISE WARNING 'Only one foreign key option can be provided. You provided %', fkcnt;\n                  RETURN '';\n              ELSEIF trigcnt > 1 THEN\n                  RAISE WARNING 'Only one trigger option can be provided. You provided %', trigcnt;\n                  RETURN '';\n              ELSEIF pkcnt > 1 THEN\n                  RAISE WARNING 'Only one pkey option can be provided. You provided %', pkcnt;\n                  RETURN '';\n              ELSEIF cmtcnt > 1 THEN\n                  RAISE WARNING 'Only one comments option can be provided. You provided %', cmtcnt;\n                  RETURN '';\n\n              END IF;\n          END IF;\n\n          SELECT c.oid, (select setting from pg_settings where name = 'server_version_num') INTO v_table_oid, v_pgversion FROM pg_catalog.pg_class c LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n          WHERE c.relkind in ('r','p') AND c.relname = in_table AND n.nspname = in_schema;\n\n        -- set search_path = public before we do anything to force explicit schema qualification but dont forget to set it back before exiting...\n          SELECT setting INTO search_path_old FROM pg_settings WHERE name = 'search_path';\n\n          -- RAISE NOTICE 'DEBUG tableddl: saving old search_path: ***%***', search_path_old;\n          EXECUTE 'SET search_path = \"public\"';\n          SELECT setting INTO search_path_new FROM pg_settings WHERE name = 'search_path';\n          -- RAISE NOTICE 'DEBUG tableddl: using new search path=***%***', search_path_new;\n\n          -- throw an error if table was not found\n          IF (v_table_oid IS NULL) THEN\n            RAISE EXCEPTION 'table does not exist';\n          END IF;\n\n          -- get user-defined tablespaces if applicable\n          SELECT tablespace INTO v_temp FROM pg_tables WHERE schemaname = in_schema and tablename = in_table and tablespace IS NOT NULL;\n          IF v_temp IS NULL THEN\n            v_tablespace := 'TABLESPACE pg_default';\n          ELSE\n            v_tablespace := 'TABLESPACE ' || v_temp;\n          END IF;\n\n          -- also see if there are any SET commands for this table, ie, autovacuum_enabled=off, fillfactor=70\n          WITH relopts AS (SELECT unnest(c.reloptions) relopts FROM pg_class c, pg_namespace n WHERE n.nspname = in_schema and n.oid = c.relnamespace and c.relname = in_table)\n          SELECT string_agg(r.relopts, ', ') as relopts INTO v_temp from relopts r;\n          IF v_temp IS NULL THEN\n            v_relopts := '';\n          ELSE\n            v_relopts := ' WITH (' || v_temp || ')';\n          END IF;\n\n          -- -----------------------------------------------------------------------------------\n          -- Create table defs for partitions/children using inheritance or declarative methods.\n          -- inheritance: pg_class.relkind = 'r'   pg_class.relispartition=false   pg_class.relpartbound is NULL\n          -- declarative: pg_class.relkind = 'r'   pg_class.relispartition=true    pg_class.relpartbound is NOT NULL\n          -- -----------------------------------------------------------------------------------\n          v_partbound := '';\n          bPartition := False;\n          bInheritance := False;\n          IF v_pgversion < 100000 THEN\n            -- Issue#11: handle parent schema\n            SELECT c2.relname parent, c2.relnamespace::regnamespace INTO v_parent, v_parent_schema from pg_class c1, pg_namespace n, pg_inherits i, pg_class c2\n            WHERE n.nspname = in_schema and n.oid = c1.relnamespace and c1.relname = in_table and c1.oid = i.inhrelid and i.inhparent = c2.oid and c1.relkind = 'r';\n            IF (v_parent IS NOT NULL) THEN\n              bPartition   := True;\n              bInheritance := True;\n            END IF;\n          ELSE\n            -- Issue#11: handle parent schema\n            SELECT c2.relname parent, c1.relispartition, pg_get_expr(c1.relpartbound, c1.oid, true), c2.relnamespace::regnamespace INTO v_parent, bRelispartition, v_partbound, v_parent_schema from pg_class c1, pg_namespace n, pg_inherits i, pg_class c2\n            WHERE n.nspname = in_schema and n.oid = c1.relnamespace and c1.relname = in_table and c1.oid = i.inhrelid and i.inhparent = c2.oid and c1.relkind = 'r';\n            IF (v_parent IS NOT NULL) THEN\n              bPartition   := True;\n              IF bRelispartition THEN\n                bInheritance := False;\n              ELSE\n                bInheritance := True;\n              END IF;\n            END IF;\n          END IF;\n          IF bPartition THEN\n            --Issue#17 fix for case-sensitive tables\n            -- SELECT count(*) INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS (SELECT REGEXP_MATCHES(s.table_name, '([A-Z]+)','g') FROM information_schema.tables s\n            -- WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema = quote_ident(in_schema) AND t.table_name = quote_ident(in_table) AND t.table_type = 'BASE TABLE');\n            SELECT count(*) INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS (SELECT REGEXP_MATCHES(s.table_name, '([A-Z]+)','g') FROM information_schema.tables s\n            WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema = in_schema AND t.table_name = in_table AND t.table_type = 'BASE TABLE');\n\n            --Issue#19 put double-quotes around SQL keyword column names\n            -- Issue#121: fix keyword lookup for table name not column name that does not apply here\n            -- SELECT COUNT(*) INTO v_cnt2 FROM pg_get_keywords() WHERE word = v_colrec.column_name AND catcode = 'R';\n            SELECT COUNT(*) INTO v_cnt2 FROM pg_get_keywords() WHERE word = in_table AND catcode = 'R';\n\n            IF bInheritance THEN\n              -- inheritance-based\n              IF v_cnt1 > 0 OR v_cnt2 > 0 THEN\n                v_table_ddl := 'CREATE TABLE ' || in_schema || '.\"' || in_table || '\"( '|| E'\\n';\n              ELSE\n                v_table_ddl := 'CREATE TABLE ' || in_schema || '.' || in_table || '( '|| E'\\n';\n              END IF;\n\n              -- Jump to constraints section to add the check constraints\n            ELSE\n              -- declarative-based\n              IF v_relopts <> '' THEN\n                IF v_cnt1 > 0 OR v_cnt2 > 0 THEN\n                  v_table_ddl := 'CREATE TABLE ' || in_schema || '.\"' || in_table || '\" PARTITION OF ' || in_schema || '.' || v_parent || ' ' || v_partbound || v_relopts || ' ' || v_tablespace || '; ' || E'\\n';\n                ELSE\n                  v_table_ddl := 'CREATE TABLE ' || in_schema || '.' || in_table || ' PARTITION OF ' || in_schema || '.' || v_parent || ' ' || v_partbound || v_relopts || ' ' || v_tablespace || '; ' || E'\\n';\n                END IF;\n              ELSE\n                IF v_cnt1 > 0 OR v_cnt2 > 0 THEN\n                  v_table_ddl := 'CREATE TABLE ' || in_schema || '.\"' || in_table || '\" PARTITION OF ' || in_schema || '.' || v_parent || ' ' || v_partbound || ' ' || v_tablespace || '; ' || E'\\n';\n                ELSE\n                  v_table_ddl := 'CREATE TABLE ' || in_schema || '.' || in_table || ' PARTITION OF ' || in_schema || '.' || v_parent || ' ' || v_partbound || ' ' || v_tablespace || '; ' || E'\\n';\n                END IF;\n              END IF;\n              -- Jump to constraints and index section to add the check constraints and indexes and perhaps FKeys\n            END IF;\n          END IF;\n          IF bVerbose THEN RAISE NOTICE '(1)tabledef so far: %', v_table_ddl; END IF;\n\n          IF NOT bPartition THEN\n            -- see if this is unlogged or temporary table\n            select c.relpersistence into v_persist from pg_class c, pg_namespace n where n.nspname = in_schema and n.oid = c.relnamespace and c.relname = in_table and c.relkind = 'r';\n            IF v_persist = 'u' THEN\n              v_temp := 'UNLOGGED';\n            ELSIF v_persist = 't' THEN\n              v_temp := 'TEMPORARY';\n            ELSE\n              v_temp := '';\n            END IF;\n          END IF;\n\n          -- start the create definition for regular tables unless we are in progress creating an inheritance-based child table\n          IF NOT bPartition THEN\n            --Issue#17 fix for case-sensitive tables\n            -- SELECT count(*) INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS (SELECT REGEXP_MATCHES(s.table_name, '([A-Z]+)','g') FROM information_schema.tables s\n            -- WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema = quote_ident(in_schema) AND t.table_name = quote_ident(in_table) AND t.table_type = 'BASE TABLE');\n            SELECT count(*) INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS (SELECT REGEXP_MATCHES(s.table_name, '([A-Z]+)','g') FROM information_schema.tables s\n            WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema = in_schema AND t.table_name = in_table AND t.table_type = 'BASE TABLE');\n            IF v_cnt1 > 0 THEN\n              v_table_ddl := 'CREATE ' || v_temp || ' TABLE ' || in_schema || '.\"' || in_table || '\" (' || E'\\n';\n            ELSE\n              v_table_ddl := 'CREATE ' || v_temp || ' TABLE ' || in_schema || '.' || in_table || ' (' || E'\\n';\n            END IF;\n          END IF;\n          -- RAISE NOTICE 'DEBUG2: tabledef so far: %', v_table_ddl;\n          -- define all of the columns in the table unless we are in progress creating an inheritance-based child table\n          IF NOT bPartition THEN\n            FOR v_colrec IN\n              SELECT c.column_name, c.data_type, c.udt_name, c.udt_schema, c.character_maximum_length, c.is_nullable, c.column_default, c.numeric_precision, c.numeric_scale, c.is_identity, c.identity_generation, c.is_generated, c.generation_expression\n              FROM information_schema.columns c WHERE (table_schema, table_name) = (in_schema, in_table) ORDER BY ordinal_position\n            LOOP\n              IF bVerbose THEN RAISE NOTICE '(col loop) name=%  type=%  udt_name=%  default=%  is_generated=%  gen_expr=%', v_colrec.column_name, v_colrec.data_type, v_colrec.udt_name, v_colrec.column_default, v_colrec.is_generated, v_colrec.generation_expression; END IF;\n\n              -- v17 fix: handle case-sensitive for pg_get_serial_sequence that requires SQL Identifier handling\n              -- SELECT CASE WHEN pg_get_serial_sequence(v_qualified, v_colrec.column_name) IS NOT NULL THEN True ELSE False END into bSerial;\n              SELECT CASE WHEN pg_get_serial_sequence(quote_ident(in_schema) || '.' || quote_ident(in_table), v_colrec.column_name) IS NOT NULL THEN True ELSE False END into bSerial;\n              IF bVerbose THEN\n                -- v17 fix: handle case-sensitive for pg_get_serial_sequence that requires SQL Identifier handling\n                -- SELECT pg_get_serial_sequence(v_qualified, v_colrec.column_name) into v_temp;\n                SELECT pg_get_serial_sequence(quote_ident(in_schema) || '.' || quote_ident(in_table), v_colrec.column_name) into v_temp;\n                IF v_temp IS NULL THEN v_temp = 'NA'; END IF;\n                SELECT pg_temp.pg_get_coldef(in_schema, in_table,v_colrec.column_name) INTO v_diag1;\n                RAISE NOTICE 'DEBUG table: %  Column: %  datatype: %  Serial=%  serialval=%  coldef=%', v_qualified, v_colrec.column_name, v_colrec.data_type, bSerial, v_temp, v_diag1;\n                RAISE NOTICE 'DEBUG tabledef: %', v_table_ddl;\n              END IF;\n\n              --Issue#17 put double-quotes around case-sensitive column names\n              SELECT COUNT(*) INTO v_cnt1 FROM information_schema.columns t WHERE EXISTS (SELECT REGEXP_MATCHES(s.column_name, '([A-Z]+)','g') FROM information_schema.columns s\n              WHERE t.table_schema=s.table_schema and t.table_name=s.table_name and t.column_name=s.column_name AND t.table_schema = quote_ident(in_schema) AND column_name = v_colrec.column_name);\n\n              --Issue#19 put double-quotes around SQL keyword column names\n              SELECT COUNT(*) INTO v_cnt2 FROM pg_get_keywords() WHERE word = v_colrec.column_name AND catcode = 'R';\n\n              IF v_cnt1 > 0 OR v_cnt2 > 0 THEN\n                v_table_ddl := v_table_ddl || '  \"' || v_colrec.column_name || '\" ';\n              ELSE\n                v_table_ddl := v_table_ddl || '  ' || v_colrec.column_name || ' ';\n              END IF;\n\n              -- Issue#23: Handle autogenerated columns and rewrite as a simpler IF THEN ELSE branch instead of a much more complex embedded CASE STATEMENT\n              IF v_colrec.is_generated = 'ALWAYS' and v_colrec.generation_expression IS NOT NULL THEN\n                  -- searchable tsvector GENERATED ALWAYS AS (to_tsvector('simple'::regconfig, COALESCE(translate(email, '@.-'::citext, ' '::text), ''::text)) ) STORED\n                  v_temp = v_colrec.data_type || ' GENERATED ALWAYS AS (' || v_colrec.generation_expression || ') STORED ';\n              ELSEIF v_colrec.udt_name in ('geometry', 'box2d', 'box2df', 'box3d', 'geography', 'geometry_dump', 'gidx', 'spheroid', 'valid_detail') THEN\n                  v_temp = v_colrec.udt_name;\n              ELSEIF v_colrec.data_type = 'USER-DEFINED' THEN\n                  v_temp = v_colrec.udt_schema || '.' || v_colrec.udt_name;\n              ELSEIF v_colrec.data_type = 'ARRAY' THEN\n                    -- Issue#6 fix: handle arrays\n                  v_temp = pg_temp.pg_get_coldef(in_schema, in_table,v_colrec.column_name);\n                  -- v17 fix: handle case-sensitive for pg_get_serial_sequence that requires SQL Identifier handling\n                  -- WHEN pg_get_serial_sequence(v_qualified, v_colrec.column_name) IS NOT NULL\n              ELSEIF pg_get_serial_sequence(quote_ident(in_schema) || '.' || quote_ident(in_table), v_colrec.column_name) IS NOT NULL THEN\n                  -- Issue#8 fix: handle serial. Note: NOT NULL is implied so no need to declare it explicitly\n                  v_temp = pg_temp.pg_get_coldef(in_schema, in_table,v_colrec.column_name);\n              ELSE\n                  v_temp = v_colrec.data_type;\n              END IF;\n              -- RAISE NOTICE 'column def1=%', v_temp;\n\n              -- handle IDENTITY columns\n              IF v_colrec.is_identity = 'YES' THEN\n                  IF v_colrec.identity_generation = 'ALWAYS' THEN\n                      v_temp = v_temp || ' GENERATED ALWAYS AS IDENTITY';\n                  ELSE\n                      v_temp = v_temp || ' GENERATED BY DEFAULT AS IDENTITY';\n                  END IF;\n              ELSEIF v_colrec.character_maximum_length IS NOT NULL THEN\n                  v_temp = v_temp || ('(' || v_colrec.character_maximum_length || ')');\n              ELSEIF v_colrec.numeric_precision > 0 AND v_colrec.numeric_scale > 0 THEN\n                  v_temp = v_temp || '(' || v_colrec.numeric_precision || ',' || v_colrec.numeric_scale || ')';\n              END IF;\n\n              -- Handle NULL/NOT NULL\n              IF bSerial THEN\n                  v_temp = v_temp || ' NOT NULL';\n              ELSEIF v_colrec.is_nullable = 'NO' THEN\n                  v_temp = v_temp || ' NOT NULL';\n              ELSEIF v_colrec.is_nullable = 'YES' THEN\n                  v_temp = v_temp || ' NULL';\n              END IF;\n\n              -- Handle defaults\n              IF v_colrec.column_default IS NOT null AND NOT bSerial THEN\n                  -- RAISE NOTICE 'Setting default for column, %', v_colrec.column_name;\n                  v_temp = v_temp || (' DEFAULT ' || v_colrec.column_default);\n              END IF;\n              v_temp = v_temp || ',' || E'\\n';\n              -- RAISE NOTICE 'column def2=%', v_temp;\n              v_table_ddl := v_table_ddl || v_temp;\n              -- RAISE NOTICE 'tabledef=%', v_table_ddl;\n\n            END LOOP;\n          END IF;\n          IF bVerbose THEN RAISE NOTICE '(2)tabledef so far: %', v_table_ddl; END IF;\n\n          -- define all the constraints: conparentid does not exist pre PGv11\n          IF v_pgversion < 110000 THEN\n            FOR v_constraintrec IN\n              SELECT con.conname as constraint_name, con.contype as constraint_type,\n                CASE\n                  WHEN con.contype = 'p' THEN 1 -- primary key constraint\n                  WHEN con.contype = 'u' THEN 2 -- unique constraint\n                  WHEN con.contype = 'f' THEN 3 -- foreign key constraint\n                  WHEN con.contype = 'c' THEN 4\n                  ELSE 5\n                END as type_rank,\n                pg_get_constraintdef(con.oid) as constraint_definition\n              FROM pg_catalog.pg_constraint con JOIN pg_catalog.pg_class rel ON rel.oid = con.conrelid JOIN pg_catalog.pg_namespace nsp ON nsp.oid = connamespace\n              WHERE nsp.nspname = in_schema AND rel.relname = in_table ORDER BY type_rank\n            LOOP\n              v_constraint_name := v_constraintrec.constraint_name;\n              v_constraint_def  := v_constraintrec.constraint_definition;\n              IF v_constraintrec.type_rank = 1 THEN\n                  IF pkcnt = 0 OR pktype = 'PKEY_INTERNAL' THEN\n                      -- internal def\n                      v_constraint_name := v_constraintrec.constraint_name;\n                      v_constraint_def  := v_constraintrec.constraint_definition;\n                      v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                        || 'CONSTRAINT' || ' '\n                        || v_constraint_name || ' '\n                        || v_constraint_def\n                        || ',' || E'\\n';\n                  ELSE\n                    -- Issue#16 handle external PG def\n                    SELECT 'ALTER TABLE ONLY ' || in_schema || '.' || c.relname || ' ADD CONSTRAINT ' || r.conname || ' ' || pg_catalog.pg_get_constraintdef(r.oid, true) || ';' INTO v_pkey_def\n                    FROM pg_catalog.pg_constraint r, pg_class c, pg_namespace n where r.conrelid = c.oid and  r.contype = 'p' and n.oid = r.connamespace and n.nspname = in_schema AND c.relname = in_table and r.conname = v_constraint_name;\n                  END IF;\n                  IF bPartition THEN\n                    continue;\n                  END IF;\n              ELSIF v_constraintrec.type_rank = 3 THEN\n                  -- handle foreign key constraints\n                  --Issue#22 fix: added FKEY_NONE check\n                  IF fktype = 'FKEYS_NONE' THEN\n                      -- skip\n                      continue;\n                  ELSIF fkcnt = 0 OR fktype = 'FKEYS_INTERNAL' THEN\n                      -- internal def\n                      v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                        || 'CONSTRAINT' || ' '\n                        || v_constraint_name || ' '\n                        || v_constraint_def\n                        || ',' || E'\\n';\n                  ELSE\n                      -- external def\n                      SELECT 'ALTER TABLE ONLY ' || n.nspname || '.' || c2.relname || ' ADD CONSTRAINT ' || r.conname || ' ' || pg_catalog.pg_get_constraintdef(r.oid, true) || ';' INTO v_fkey_def\n                      FROM pg_constraint r, pg_class c1, pg_namespace n, pg_class c2 where r.conrelid = c1.oid and  r.contype = 'f' and n.nspname = in_schema and n.oid = r.connamespace and r.conrelid = c2.oid and c2.relname = in_table;\n                      v_fkey_defs = v_fkey_defs || v_fkey_def || E'\\n';\n                  END IF;\n              ELSE\n                  -- handle all other constraints besides PKEY and FKEYS as internal defs by default\n                  v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                    || 'CONSTRAINT' || ' '\n                    || v_constraint_name || ' '\n                    || v_constraint_def\n                    || ',' || E'\\n';\n              END IF;\n              if bVerbose THEN RAISE NOTICE 'DEBUG4: constraint name=% constraint_def=%', v_constraint_name,v_constraint_def; END IF;\n              constraintarr := constraintarr || v_constraintrec.constraint_name:: text;\n\n            END LOOP;\n          ELSE\n            -- handle PG versions 11 and up\n            -- Issue#20: Fix logic for external PKEY and FKEYS\n            FOR v_constraintrec IN\n              SELECT con.conname as constraint_name, con.contype as constraint_type,\n                CASE\n                  WHEN con.contype = 'p' THEN 1 -- primary key constraint\n                  WHEN con.contype = 'u' THEN 2 -- unique constraint\n                  WHEN con.contype = 'f' THEN 3 -- foreign key constraint\n                  WHEN con.contype = 'c' THEN 4\n                  ELSE 5\n                END as type_rank,\n                pg_get_constraintdef(con.oid) as constraint_definition\n              FROM pg_catalog.pg_constraint con JOIN pg_catalog.pg_class rel ON rel.oid = con.conrelid JOIN pg_catalog.pg_namespace nsp ON nsp.oid = connamespace\n              WHERE nsp.nspname = in_schema AND rel.relname = in_table\n                    --Issue#13 added this condition:\n                    AND con.conparentid = 0\n                    ORDER BY type_rank\n            LOOP\n              v_constraint_name := v_constraintrec.constraint_name;\n              v_constraint_def  := v_constraintrec.constraint_definition;\n              IF v_constraintrec.type_rank = 1 THEN\n                  IF pkcnt = 0 OR pktype = 'PKEY_INTERNAL' THEN\n                      -- internal def\n                      v_constraint_name := v_constraintrec.constraint_name;\n                      v_constraint_def  := v_constraintrec.constraint_definition;\n                      v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                        || 'CONSTRAINT' || ' '\n                        || v_constraint_name || ' '\n                        || v_constraint_def\n                        || ',' || E'\\n';\n                  ELSE\n                    -- Issue#16 handle external PG def\n                    SELECT 'ALTER TABLE ONLY ' || in_schema || '.' || c.relname || ' ADD CONSTRAINT ' || r.conname || ' ' || pg_catalog.pg_get_constraintdef(r.oid, true) || ';' INTO v_pkey_def\n                    FROM pg_catalog.pg_constraint r, pg_class c, pg_namespace n where r.conrelid = c.oid and  r.contype = 'p' and n.oid = r.connamespace and n.nspname = in_schema AND c.relname = in_table;\n                  END IF;\n                  IF bPartition THEN\n                    continue;\n                  END IF;\n              ELSIF v_constraintrec.type_rank = 3 THEN\n                  -- handle foreign key constraints\n                  --Issue#22 fix: added FKEY_NONE check\n                  IF fktype = 'FKEYS_NONE' THEN\n                      -- skip\n                      continue;\n                  ELSIF fkcnt = 0 OR fktype = 'FKEYS_INTERNAL' THEN\n                      -- internal def\n                      v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                        || 'CONSTRAINT' || ' '\n                        || v_constraint_name || ' '\n                        || v_constraint_def\n                        || ',' || E'\\n';\n                  ELSE\n                      -- external def\n                      SELECT 'ALTER TABLE ONLY ' || n.nspname || '.' || c2.relname || ' ADD CONSTRAINT ' || r.conname || ' ' || pg_catalog.pg_get_constraintdef(r.oid, true) || ';' INTO v_fkey_def\n                      FROM pg_constraint r, pg_class c1, pg_namespace n, pg_class c2 where r.conrelid = c1.oid and  r.contype = 'f' and n.nspname = in_schema and n.oid = r.connamespace and r.conrelid = c2.oid and c2.relname = in_table and\n                      r.conname = v_constraint_name and r.conparentid = 0;\n                      v_fkey_defs = v_fkey_defs || v_fkey_def || E'\\n';\n                  END IF;\n              ELSE\n                  -- handle all other constraints besides PKEY and FKEYS as internal defs by default\n                  v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                    || 'CONSTRAINT' || ' '\n                    || v_constraint_name || ' '\n                    || v_constraint_def\n                    || ',' || E'\\n';\n              END IF;\n              if bVerbose THEN RAISE NOTICE 'DEBUG4: constraint name=% constraint_def=%', v_constraint_name,v_constraint_def; END IF;\n              constraintarr := constraintarr || v_constraintrec.constraint_name:: text;\n\n            END LOOP;\n          END IF;\n\n          -- drop the last comma before ending the create statement, which should be right before the carriage return character\n          -- Issue#24: make sure the comma is there before removing it\n          select substring(v_table_ddl, length(v_table_ddl) - 1, 1) INTO v_temp;\n          IF v_temp = ',' THEN\n              v_table_ddl = substr(v_table_ddl, 0, length(v_table_ddl) - 1) || E'\\n';\n          END IF;\n          IF bVerbose THEN RAISE NOTICE '(3)tabledef so far: %', trim(v_table_ddl); END IF;\n\n          -- ---------------------------------------------------------------------------\n          -- at this point we have everything up to the last table-enclosing parenthesis\n          -- ---------------------------------------------------------------------------\n          IF bVerbose THEN RAISE NOTICE '(4)tabledef so far: %', v_table_ddl; END IF;\n\n          -- See if this is an inheritance-based child table and finish up the table create.\n          IF bPartition and bInheritance THEN\n            -- Issue#11: handle parent schema\n            -- v_table_ddl := v_table_ddl || ') INHERITS (' || in_schema || '.' || v_parent || ') ' || E'\\n' || v_relopts || ' ' || v_tablespace || ';' || E'\\n';\n            IF v_parent_schema = '' OR v_parent_schema IS NULL THEN v_parent_schema = in_schema; END IF;\n            v_table_ddl := v_table_ddl || ') INHERITS (' || v_parent_schema || '.' || v_parent || ') ' || E'\\n' || v_relopts || ' ' || v_tablespace || ';' || E'\\n';\n          END IF;\n\n          IF v_pgversion >= 100000 AND NOT bPartition and NOT bInheritance THEN\n            -- See if this is a partitioned table (pg_class.relkind = 'p') and add the partitioned key\n            SELECT pg_get_partkeydef(c1.oid) as partition_key INTO v_partition_key FROM pg_class c1 JOIN pg_namespace n ON (n.oid = c1.relnamespace) LEFT JOIN pg_partitioned_table p ON (c1.oid = p.partrelid)\n            WHERE n.nspname = in_schema and n.oid = c1.relnamespace and c1.relname = in_table and c1.relkind = 'p';\n\n            IF v_partition_key IS NOT NULL AND v_partition_key <> '' THEN\n              -- add partition clause\n              -- NOTE:  cannot specify default tablespace for partitioned relations\n              -- v_table_ddl := v_table_ddl || ') PARTITION BY ' || v_partition_key || ' ' || v_tablespace || ';' || E'\\n';\n              v_table_ddl := v_table_ddl || ') PARTITION BY ' || v_partition_key || ';' || E'\\n';\n            ELSEIF v_relopts <> '' THEN\n              v_table_ddl := v_table_ddl || ') ' || v_relopts || ' ' || v_tablespace || ';' || E'\\n';\n            ELSE\n              -- end the create definition\n              v_table_ddl := v_table_ddl || ') ' || v_tablespace || ';' || E'\\n';\n            END IF;\n          END IF;\n\n          IF bVerbose THEN RAISE NOTICE '(5)tabledef so far: %', v_table_ddl; END IF;\n\n          -- Add closing paren for regular tables\n          -- IF NOT bPartition THEN\n          -- v_table_ddl := v_table_ddl || ') ' || v_relopts || ' ' || v_tablespace || E';\\n';\n          -- END IF;\n          -- RAISE NOTICE 'ddlsofar3: %', v_table_ddl;\n\n          -- Issue#16 create the external PKEY def if indicated\n          IF v_pkey_def <> '' THEN\n              v_table_ddl := v_table_ddl || v_pkey_def || E'\\n';\n          END IF;\n\n          -- Issue#20\n          IF v_fkey_defs <> '' THEN\n                v_table_ddl := v_table_ddl || v_fkey_defs || E'\\n';\n          END IF;\n\n          IF bVerbose THEN RAISE NOTICE '(6)tabledef so far: %', v_table_ddl; END IF;\n\n          -- create indexes\n          FOR v_indexrec IN\n            SELECT indexdef, COALESCE(tablespace, 'pg_default') as tablespace, indexname FROM pg_indexes WHERE (schemaname, tablename) = (in_schema, in_table)\n          LOOP\n            -- RAISE NOTICE 'DEBUG6: indexname=%  indexdef=%', v_indexrec.indexname, v_indexrec.indexdef;\n            -- loop through constraints and skip ones already defined\n            bSkip = False;\n            FOREACH constraintelement IN ARRAY constraintarr\n            LOOP\n              IF constraintelement = v_indexrec.indexname THEN\n                  -- RAISE NOTICE 'DEBUG7: skipping index, %', v_indexrec.indexname;\n                  bSkip = True;\n                  EXIT;\n              END IF;\n            END LOOP;\n            if bSkip THEN CONTINUE; END IF;\n\n            -- Add IF NOT EXISTS clause so partition index additions will not be created if declarative partition in effect and index already created on parent\n            v_indexrec.indexdef := REPLACE(v_indexrec.indexdef, 'CREATE INDEX', 'CREATE INDEX IF NOT EXISTS');\n            -- Fix Issue#26: do it for unique/primary key indexes as well\n            v_indexrec.indexdef := REPLACE(v_indexrec.indexdef, 'CREATE UNIQUE INDEX', 'CREATE UNIQUE INDEX IF NOT EXISTS');\n            -- RAISE NOTICE 'DEBUG8: adding index, %', v_indexrec.indexname;\n\n            -- NOTE:  cannot specify default tablespace for partitioned relations\n            IF v_partition_key IS NOT NULL AND v_partition_key <> '' THEN\n                v_table_ddl := v_table_ddl || v_indexrec.indexdef || ';' || E'\\n';\n            ELSE\n                -- Issue#25: see if partial index or not\n                select CASE WHEN i.indpred IS NOT NULL THEN True ELSE False END INTO v_partial\n                FROM pg_index i JOIN pg_class c1 ON (i.indexrelid = c1.oid) JOIN pg_class c2 ON (i.indrelid = c2.oid)\n                WHERE c1.relnamespace::regnamespace::text = in_schema AND c2.relnamespace::regnamespace::text = in_schema AND c2.relname = in_table AND c1.relname = v_indexrec.indexname;\n                IF v_partial THEN\n                    -- Put tablespace def before WHERE CLAUSE\n                    v_temp = v_indexrec.indexdef;\n                    v_pos = POSITION(' WHERE ' IN v_temp);\n                    v_temp2 = SUBSTRING(v_temp, v_pos);\n                    v_temp  = SUBSTRING(v_temp, 1, v_pos);\n                    v_table_ddl := v_table_ddl || v_temp || ' TABLESPACE ' || v_indexrec.tablespace || v_temp2 || ';' || E'\\n';\n                ELSE\n                    v_table_ddl := v_table_ddl || v_indexrec.indexdef || ' TABLESPACE ' || v_indexrec.tablespace || ';' || E'\\n';\n                END IF;\n            END IF;\n\n          END LOOP;\n          IF bVerbose THEN RAISE NOTICE '(7)tabledef so far: %', v_table_ddl; END IF;\n\n          -- Issue#20: added logic for table and column comments\n          IF  cmtcnt > 0 THEN\n              FOR v_rec IN\n                SELECT c.relname, 'COMMENT ON ' || CASE WHEN c.relkind in ('r','p') AND a.attname IS NULL THEN 'TABLE ' WHEN c.relkind in ('r','p') AND a.attname IS NOT NULL THEN 'COLUMN ' WHEN c.relkind = 'f' THEN 'FOREIGN TABLE '\n                      WHEN c.relkind = 'm' THEN 'MATERIALIZED VIEW ' WHEN c.relkind = 'v' THEN 'VIEW ' WHEN c.relkind = 'i' THEN 'INDEX ' WHEN c.relkind = 'S' THEN 'SEQUENCE ' ELSE 'XX' END || n.nspname || '.' ||\n                      CASE WHEN c.relkind in ('r','p') AND a.attname IS NOT NULL THEN quote_ident(c.relname) || '.' || a.attname ELSE quote_ident(c.relname) END || ' IS '   || quote_literal(d.description) || ';' as ddl\n                FROM pg_class c JOIN pg_namespace n ON (n.oid = c.relnamespace) LEFT JOIN pg_description d ON (c.oid = d.objoid) LEFT JOIN pg_attribute a ON (c.oid = a.attrelid AND a.attnum > 0 and a.attnum = d.objsubid)\n                WHERE d.description IS NOT NULL AND n.nspname = in_schema AND c.relname = in_table ORDER BY 2 desc, ddl\n              LOOP\n                  --RAISE NOTICE 'comments:%', v_rec.ddl;\n                  v_table_ddl = v_table_ddl || v_rec.ddl || E'\\n';\n              END LOOP;\n          END IF;\n          IF bVerbose THEN RAISE NOTICE '(8)tabledef so far: %', v_table_ddl; END IF;\n\n          IF trigtype = 'INCLUDE_TRIGGERS' THEN\n            -- Issue#14: handle multiple triggers for a table\n            FOR v_trigrec IN\n                select pg_get_triggerdef(t.oid, True) || ';' as triggerdef FROM pg_trigger t, pg_class c, pg_namespace n\n                WHERE n.nspname = in_schema and n.oid = c.relnamespace and c.relname = in_table and c.relkind = 'r' and t.tgrelid = c.oid and NOT t.tgisinternal\n            LOOP\n                v_table_ddl := v_table_ddl || v_trigrec.triggerdef;\n                v_table_ddl := v_table_ddl || E'\\n';\n                IF bVerbose THEN RAISE NOTICE 'triggerdef = %', v_trigrec.triggerdef; END IF;\n            END LOOP;\n          END IF;\n\n          IF bVerbose THEN RAISE NOTICE '(9)tabledef so far: %', v_table_ddl; END IF;\n          -- add empty line\n          v_table_ddl := v_table_ddl || E'\\n';\n          IF bVerbose THEN RAISE NOTICE '(10)tabledef so far: %', v_table_ddl; END IF;\n\n          -- reset search_path back to what it was\n          IF search_path_old = '' THEN\n            SELECT set_config('search_path', '', false) into v_temp;\n          ELSE\n            EXECUTE 'SET search_path = ' || search_path_old;\n          END IF;\n\n          RETURN v_table_ddl;\n\n          EXCEPTION\n          WHEN others THEN\n          BEGIN\n            GET STACKED DIAGNOSTICS v_diag1 = MESSAGE_TEXT, v_diag2 = PG_EXCEPTION_DETAIL, v_diag3 = PG_EXCEPTION_HINT, v_diag4 = RETURNED_SQLSTATE, v_diag5 = PG_CONTEXT, v_diag6 = PG_EXCEPTION_CONTEXT;\n            -- v_ret := 'line=' || v_diag6 || '. '|| v_diag4 || '. ' || v_diag1 || ' .' || v_diag2 || ' .' || v_diag3;\n            v_ret := 'line=' || v_diag6 || '. '|| v_diag4 || '. ' || v_diag1;\n            RAISE EXCEPTION '%', v_ret;\n            -- put additional coding here if necessarY\n            RETURN '';\n          END;\n\n        END;\n      $$;",{compress:!0,removeAll:!0});var s=function(e){return e.NO_ACTION="a",e.RESTRICT="r",e.CASCADE="c",e.SET_NULL="n",e.SET_DEFAULT="d",e}({})},63004:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(47370).A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},66001:(e,t,n)=>{"use strict";n.d(t,{B:()=>i});var a=n(25222);let r={search:"",timestampStart:"",timestampEnd:"",filters:{}},s=e=>(0,a.Cp)({parse:t=>null!=t?t:e,serialize:e=>e||""}),l=e=>(0,a.Cp)({parse:t=>{if(!t)return e;try{return JSON.parse(t)}catch(t){return e}},serialize:e=>{if(!e)return"";try{return JSON.stringify(e)}catch(e){return""}}});function i(){let[e,t]=(0,a.ZA)("s",s(r.search)),[n,i]=(0,a.ZA)("its",s(r.timestampStart)),[o,c]=(0,a.ZA)("ite",s(r.timestampEnd)),[d,u]=(0,a.ZA)("log",s("")),[m,p]=(0,a.ZA)("f",l(r.filters)),_=e||r.search,E=n||r.timestampStart,h=o||r.timestampEnd,g=m||r.filters,f=e=>{t(e||r.search)},v=e=>{p(e||r.filters)};return{search:_,timestampStart:E,timestampEnd:h,selectedLogId:d||null,filters:g,setSearch:f,setTimeRange:(e,t)=>{i(e||r.timestampStart),c(t||r.timestampEnd)},setSelectedLogId:e=>{u(e||"")},setFilters:v,updateFilter:(e,t)=>{v({...g,[e]:t})},reset:()=>{f(r.search),i(r.timestampStart),c(r.timestampEnd),u(""),p(r.filters)}}}},71115:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>to});var a=n(80263),r=n(52385),s=n(53239),l=n(69610),i=n(96591),o=n(32144),c=n(42036),d=n(88712),u=n(37055),m=n(11352),p=n(30327),_=n(43717),E=n(3037),h=n.n(E),g=n(73969),f=n(82489),v=n(15631),N=n(12011),x=n(7724),b=n(29209),y=n(3807),I=n(70600),T=n(71433),S=n(23957),A=n(22392),R=n(36567),C=n(37589),L=n(94713),O=n(25718),j=n(83634),w=n(58897),D=n(34586),k=n(90206),F=n(11649),H=n(28128),M=n(58289),U=n(33887),P=n(29127),q=n(45248),W=n(79175),B=n(79210),G=n(2),K=n(3732),Y=n(33656),z=n(16601),Q=n(12532),X=n(73401),V=n(30263),$=n(16580),J=n(36212);let Z=e=>{let{visible:t,hasDestructiveOperations:n,hasUpdateWithoutWhere:r,onCancel:s,onConfirm:l}=e;return(0,a.jsxs)(J.A,{visible:t,size:"large",title:"Potential issue".concat(n&&r?"s":""," detected with your query"),confirmLabel:"Run this query",variant:"warning",alert:{base:{variant:"warning"},title:n&&r?"The following potential issues have been detected:":"The following potential issue has been detected:",description:"Ensure that these are intentional before executing this query"},onCancel:s,onConfirm:l,"data-sentry-element":"ConfirmationModal","data-sentry-component":"RunQueryWarningModal","data-sentry-source-file":"RunQueryWarningModal.tsx",children:[(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsxs)("ul",{className:"border rounded-md grid bg-surface-200",children:[n&&(0,a.jsxs)("li",{className:"grid pt-3 pb-2 px-4",children:[(0,a.jsx)("span",{className:"font-bold",children:"Query has destructive operation"}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:"Make sure you are not accidentally removing something important."})]}),n&&r&&(0,a.jsx)($.w,{}),r&&(0,a.jsxs)("li",{className:"grid pt-2 pb-3 px-4 gap-1",children:[(0,a.jsx)("span",{className:"font-bold",children:"Query uses update without a where clause"}),(0,a.jsxs)("span",{className:"text-foreground-lighter",children:["Without a ",(0,a.jsx)("code",{className:"text-xs",children:"where"})," clause, this could update all rows in the table."]})]})]})}),(0,a.jsx)("p",{className:"mt-4 text-sm text-foreground-light",children:"Please confirm that you would like to execute this query."})]})};var ee=n(12593),et=n(66021),en=n(48969),ea=n(45969),er=n(14602);function es(e){return e.replace(/^\"/,"").replace(/\"$/,"").replace(/\"\"/,'"')}function el(e){return e!=e.toLowerCase()?'"'.concat(e,'"'):e}var ei=n(2468),eo=n(56947),ec=n(77570),ed=n(68324);let eu=()=>"\nSELECT word FROM pg_get_keywords();\n".trim();async function em(e,t){let{projectRef:n,connectionString:a}=e,r=eu(),{result:s}=await (0,ec.E)({projectRef:n,connectionString:a,sql:r,queryKey:["keywords"]},t);return s.map(e=>e.word.toLocaleLowerCase())}let ep=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,eo.I)(ed.c.keywords(t),e=>{let{signal:a}=e;return em({projectRef:t,connectionString:n},a)},{enabled:a&&void 0!==t,...r})};var e_=n(15665),eE=n(90799),eh=n(89756);let eg=(e,t)=>{let{project:n}=(0,ea.Om)(),a=(0,q.aP)(),[r]=(0,eh.U)(w.rS.SQL_EDITOR_INTELLISENSE,!0),{data:l,isSuccess:i}=ep({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString},{enabled:r}),{data:o,isSuccess:c}=(0,ei.e)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString},{enabled:r}),{data:d,isSuccess:u}=(0,e_.w$)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString},{enabled:r}),{data:m,isSuccess:p}=(0,eE.HJ)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString},{enabled:r}),_=(0,s.useRef)(null),E=r&&p&&u&&i&&c;E&&(null===_.current&&(_.current={}),_.current.tableColumns=m,_.current.schemas=d,_.current.keywords=l,_.current.functions=o),(0,s.useEffect)(()=>{if(t){let n=t.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(t){let n=t.getValue(),r=(0,D.A)(n);return e&&a.setSql(e,r),[{range:t.getFullModelRange(),text:r}]}});return()=>n.dispose()}},[t]),(0,s.useEffect)(()=>{let e=null,n=null;E&&t&&E&&(e=t.languages.registerCompletionItemProvider("pgsql",function(e,t){return{triggerCharacters:[" ",".",'"'],provideCompletionItems:function(n,a,r){try{let o=new er.A(n,a.column-2,a.lineNumber-1);if('"'===r.triggerCharacter){var s=e,l=t,i=o;let n=[];if(!i.isFowardDQuote())return{suggestions:n};if(i.next(),i.isNextPeriod()){let e=i.readIdent(),t=!1;e.match(/^\".*?\"$/)&&(t=!0,e=es(e));let a=l.current.tableColumns.find(n=>t&&n.tablename===e||!t&&n.tablename.toLocaleLowerCase()==e.toLocaleLowerCase());if(!a)return{suggestions:n};a.columns.forEach(e=>{n.push({label:e.attname,kind:s.languages.CompletionItemKind.Property,detail:e.data_type,insertText:e.attname})})}else l.current.tableColumns.forEach(e=>{n.push({label:e.tablename,kind:s.languages.CompletionItemKind.Class,insertText:e.tablename})});return{suggestions:n}}if("."===r.triggerCharacter)return function(e,t,n){var a,r;let s=[],l=(a=n,r=3,a.readIdents(3).map(e=>{let t=!1;return e.match(/^\".*?\"$/)&&(t=!0,e=es(e)),{isQuoted:t,name:e}})),i=0,o=t.current.schemas.find(e=>{var t,n;let a=l&&l.length>i?l[i]:{};return a.isQuoted&&e.name===a.name||!a.isQuoted&&(null==(t=e.name)?void 0:t.toLocaleLowerCase())==(null==(n=a.name)?void 0:n.toLocaleLowerCase())});if(o?i++:o=t.current.schemas.find(e=>"public"==e.name),l.length==i)return t.current.tableColumns.forEach(t=>{t.schemaname==o.name&&s.push({label:t.tablename,kind:e.languages.CompletionItemKind.Class,detail:"public"!==t.schemaname?t.schemaname:null,insertText:el(t.tablename)})}),{suggestions:s};let c=t.current.tableColumns.find(e=>{var t,n;let a=l&&l.length>i?l[i]:{};return e.schemaname==o.name&&a.isQuoted&&e.tablename===a.name||!a.isQuoted&&(null==(t=e.tablename)?void 0:t.toLocaleLowerCase())==(null==(n=a.name)?void 0:n.toLocaleLowerCase())});return c&&c.columns.forEach(t=>{s.push({label:t.attname,kind:e.languages.CompletionItemKind.Property,detail:t.data_type,insertText:el(t.attname)})}),{suggestions:s}}(e,t,o);return function(e,t){var n,a,r,s;let l=[];return(null==(n=t.current.keywords)?void 0:n.length)>0&&t.current.keywords.forEach(t=>{l.push({label:t,kind:e.languages.CompletionItemKind.Keyword,insertText:t})}),(null==(a=t.current.schemas)?void 0:a.length)>0&&t.current.schemas.forEach(t=>{l.push({label:t.name,kind:e.languages.CompletionItemKind.Keyword,insertText:t.name})}),(null==(r=t.current.tableColumns)?void 0:r.length)>0&&t.current.tableColumns.forEach(t=>{let n="public"==t.schemaname?t.tablename:t.schemaname+"."+t.tablename;l.push({label:t.tablename,detail:"public"!==t.schemaname?t.schemaname:null,kind:t.is_table?e.languages.CompletionItemKind.Class:e.languages.CompletionItemKind.Interface,insertText:el(n)}),t.columns.forEach(n=>{if(!n)return;let a=l.find(t=>t.label===(null==n?void 0:n.attname)&&t.kind===e.languages.CompletionItemKind.Field&&t.detail===(null==n?void 0:n.data_type));a?(a.tables.push(t.tablename),a.tables.sort(),a.documentation=a.tables.join(", ")):l.push({label:n.attname,kind:e.languages.CompletionItemKind.Field,detail:n.data_type,documentation:t.tablename,tables:[t.tablename],insertText:el(n.attname)})})}),(null==(s=t.current.functions)?void 0:s.length)>0&&t.current.functions.forEach(t=>{l.push({label:t.name,kind:e.languages.CompletionItemKind.Function,detail:t.return_type,insertText:t.name})}),{suggestions:l}}(e,t)}catch(e){return{suggestions:[]}}}}}(t,_)),n=t.languages.registerSignatureHelpProvider("pgsql",{signatureHelpTriggerCharacters:["(",","],provideSignatureHelp:function(e,t){let n=new er.A(e,t.column-2,t.lineNumber-1),a=n.readArguments();if(a<0)return null;let r=n.readIdent();if(!r||r.match(/^\".*?\"$/))return null;let s=_.current.functions.find(e=>e.name.toLocaleLowerCase()===r.toLocaleLowerCase());if(!s||!s.args||s.args.length<a)return null;let l=Math.min(a,s.args.length-1),i=[];return i.push({label:"".concat(s.name,"(").concat(s.argument_types,")"),parameters:s.args.map(e=>({label:e.name}))}),{value:{signatures:i,activeSignature:0,activeParameter:l},dispose:()=>{}}}}));return()=>{null==e||e.dispose(),null==n||n.dispose()}},[E,t])};var ef=n(90720),ev=n(83041),eN=n(93479),ex=n(53434),eb=n.n(ex),ey=n(70598),eI=n(23278),eT=n(79319),eS=n(54045),eA=n(45168),eR=n(24726),eC=n(63320),eL=n.n(eC),eO=n(38952),ej=n(27863),ew=n(79295),eD=n(44728),ek=n(82942);let eF=(e,t)=>{var n;return(null==e||null==(n=e.rows)?void 0:n.length)?e.rows.reduce((e,n)=>{let a=e[e.length-1]||{};return[...e,{...n,[t.yKey]:(a[t.yKey]||0)+n[t.yKey]}]},[]):[]},eH=["number","string","date"],eM=e=>{let{results:t={rows:[]},config:n,onConfigChange:r}=e,{ref:l}=(0,f.g)(),i=(0,eR._)("reportsV2"),[o,c]=(0,eh.U)(w.rS.SQL_EDITOR_SQL_BLOCK_ACKNOWLEDGED(l),!1),d=(0,s.useMemo)(()=>Object.keys(t.rows[0]||{}).filter(e=>{let n=typeof t.rows[0][e];return eH.includes(n)}),[t]),u=(0,s.useMemo)(()=>t.rows[0]?Object.keys(t.rows[0]).filter(e=>{let n=t.rows[0][e];return"number"==typeof n||!isNaN(Number(n))}):[],[t]),m=n.xKey&&n.yKey,p=(0,s.useMemo)(()=>{var e,a;if(!m)return!1;let r=typeof(null==(e=t.rows[0])?void 0:e[n.xKey]),s=typeof(null==(a=t.rows[0])?void 0:a[n.yKey]);return"number"===r&&"number"===s},[m,t.rows,n.xKey,n.yKey]),_=(0,s.useMemo)(()=>eF(t,n),[t,n]),E=n.cumulative?_:t.rows,h=(e=>{var t;let n=(null==E||null==(t=E[0])?void 0:t[e])||"";return"number"==typeof n?"number":eb()(n).isValid()?"date":"string"})(n.xKey);return d.length?(0,a.jsxs)(B.HK,{direction:"horizontal",className:"flex-grow h-full","data-sentry-element":"ResizablePanelGroup","data-sentry-component":"ChartConfig","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(B.wV,{className:"p-4 h-full",defaultSize:75,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"ChartConfig.tsx",children:m?"bar"===n.type?(0,a.jsx)(eS.A,{showLegend:!0,size:"normal",xAxisIsDate:"date"===h,data:E,xAxisKey:n.xKey,yAxisKey:n.yKey,showGrid:n.showGrid,XAxisProps:{angle:0,interval:"preserveStart",hide:!n.showLabels,tickFormatter:e=>{let t=E[+e][n.xKey];return"date"===h?eb()(t).format("MMM D YYYY HH:mm"):t}},YAxisProps:{tickFormatter:e=>e.toLocaleString(),hide:!n.showLabels,domain:[0,"dataMax"]}}):null:(0,a.jsx)(B.wV,{className:"p-4 h-full",defaultSize:75,children:(0,a.jsx)(eA.A,{size:"normal",title:"Configure your chart",description:"Select your X and Y axis in the chart options panel"})})}),(0,a.jsx)(B.WM,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"ChartConfig.tsx"}),(0,a.jsxs)(B.wV,{defaultSize:25,minSize:15,className:"px-3 py-3 space-y-4 !overflow-y-auto","data-sentry-element":"ResizablePanel","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center h-5",children:[(0,a.jsx)("h2",{className:"text-sm text-foreground-lighter",children:"Chart options"}),n.xKey&&n.yKey&&(0,a.jsx)(eT.G,{type:"text",size:"tiny",onClick:()=>{let e=n.xKey,t=n.yKey;r({...n,xKey:t,yKey:e})},disabled:!p,icon:(0,a.jsx)(ey.A,{size:"15",className:"text-foreground-lighter"}),tooltip:{content:{side:"bottom",className:"w-64 text-center",text:p?"Swap X and Y axis":"Unable to swap X and Y axis - both axes need to numerical values"}},children:"Flip"})]}),i&&!o&&(0,a.jsxs)(ek.Z,{showIcon:!1,type:"tip",className:"p-2 relative group",children:[(0,a.jsxs)(K.m_,{children:[(0,a.jsx)(K.k$,{onClick:()=>c(!0),className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(eI.A,{size:14,className:"text-foreground-light"})}),(0,a.jsx)(K.ZI,{side:"bottom",children:"Dismiss"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(eO.E,{variant:"success",className:"text-xs rounded px-1",children:"NEW"}),(0,a.jsx)("p",{className:"text-xs",children:"Add this chart to custom reports"})]}),(0,a.jsx)("p",{className:"text-xs text-foreground-light mt-1",children:"SQL snippets can now be added and saved to your custom reports. Try it out now!"}),(0,a.jsx)(z.$,{asChild:!0,size:"tiny",type:"default",className:"mt-2",children:(0,a.jsx)(eL(),{href:"/project/".concat(l,"/reports"),children:"Head to Reports"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ej.J,{className:"text-xs text-foreground-light","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:"X Axis"}),(0,a.jsxs)(ew.l6,{value:n.xKey,onValueChange:e=>{r({...n,xKey:e})},"data-sentry-element":"Select_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(ew.bq,{"data-sentry-element":"SelectTrigger_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:n.xKey||"Select X Axis"}),(0,a.jsx)(ew.gC,{"data-sentry-element":"SelectContent_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:(0,a.jsx)(ew.s3,{"data-sentry-element":"SelectGroup_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:d.map(e=>(0,a.jsx)(ew.eb,{value:e,children:e},e))})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ej.J,{className:"text-xs text-foreground-light","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:"Y Axis"}),(0,a.jsxs)(ew.l6,{value:n.yKey,onValueChange:e=>{r({...n,yKey:e})},"data-sentry-element":"Select_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(ew.bq,{"data-sentry-element":"SelectTrigger_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:n.yKey||"Select Y Axis"}),(0,a.jsx)(ew.gC,{"data-sentry-element":"SelectContent_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:(0,a.jsx)(ew.s3,{"data-sentry-element":"SelectGroup_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:u.map(e=>(0,a.jsx)(ew.eb,{value:e,children:e},e))})})]})]}),(0,a.jsxs)("div",{className:"*:flex *:gap-2 *:items-center grid gap-2 *:text-foreground-light *:p-1.5 *:pl-0",children:[(0,a.jsxs)(ej.J,{className:"",htmlFor:"cumulative","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eD.S,{id:"cumulative",name:"cumulative",checked:n.cumulative,onClick:()=>r({...n,cumulative:!n.cumulative}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Cumulative"]}),(0,a.jsxs)(ej.J,{htmlFor:"showLabels","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eD.S,{id:"showLabels",name:"showLabels",checked:n.showLabels,onClick:()=>r({...n,showLabels:!n.showLabels}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Show labels"]}),(0,a.jsxs)(ej.J,{htmlFor:"showGrid","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eD.S,{id:"showGrid",name:"showGrid",checked:n.showGrid,onClick:()=>r({...n,showGrid:!n.showGrid}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Show grid"]})]})]})]}):(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(eA.A,{size:"normal",description:"Execute a query and configure the chart options."})})};var eU=n(78086);let eP=(0,n(47370).A)("Keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]);var eq=n(64238),eW=n(73634),eB=n(18911),eG=n(49440),eK=n(37518),eY=n(86262),ez=n(4771),eQ=n(65325),eX=n(62744);let eV=e=>{let{id:t}=e,{profile:n}=(0,F.xc)(),r=(0,q.aP)().snippets[t],s=(null==n?void 0:n.id)===(null==r?void 0:r.snippet.owner_id);return(0,a.jsx)(a.Fragment,{children:s?null:(0,a.jsx)(eO.E,{children:"Read-only"})})},e$=e=>{let{id:t}=e,{profile:n}=(0,F.xc)(),r=(0,q.aP)(),l=r.savingStates[t],i=(0,eX.Z)(l),[o,c]=(0,s.useState)(!1),d=r.snippets[t],u=(null==n?void 0:n.id)===(null==d?void 0:d.snippet.owner_id);return(0,s.useEffect)(()=>{let e=!1;return"UPDATING"===i&&"IDLE"===l&&(c(!0),setTimeout(()=>{e||c(!1)},5e3)),()=>{e=!0}},[l]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"mx-2 flex items-center gap-2",children:[u&&"UPDATING_FAILED"===l&&(0,a.jsx)(z.$,{type:"text",size:"tiny",icon:(0,a.jsx)(ez.A,{className:"text-gray-1100",strokeWidth:2}),onClick:()=>r.addNeedsSaving(t),children:"Retry"}),o?(0,a.jsxs)(K.m_,{children:[(0,a.jsx)(K.k$,{children:(0,a.jsx)(eq.A,{className:"text-brand",size:14,strokeWidth:3})}),(0,a.jsx)(K.ZI,{side:"bottom",children:"All changes saved"})]}):"UPDATING"===l?(0,a.jsxs)(K.m_,{children:[(0,a.jsx)(K.k$,{children:(0,a.jsx)(m.A,{className:"animate-spin",size:14,strokeWidth:2})}),(0,a.jsx)(K.ZI,{children:"Saving changes..."})]}):"UPDATING_FAILED"===l?u?(0,a.jsxs)(K.m_,{children:[(0,a.jsx)(K.k$,{children:(0,a.jsx)(eQ.A,{className:"text-red-900",size:14,strokeWidth:2})}),(0,a.jsx)(K.ZI,{children:"Failed to save changes"})]}):(0,a.jsx)(eV,{id:t}):null]})})},eJ=e=>{let{id:t,isExecuting:n=!1,isDisabled:r=!1,hasSelection:s,prettifyQuery:l,executeQuery:i}=e;(0,k.UX)();let{ref:o}=(0,f.g)(),c=(0,q.aP)(),[d]=(0,eh.U)(w.rS.SQL_EDITOR_AI_OPEN,!0),[u,m]=(0,eh.U)(w.rS.SQL_EDITOR_INTELLISENSE,!0),[p,_]=(0,eh.U)(w.rS.SQL_EDITOR_LAST_SELECTED_DB(o),""),E=c.snippets[t],h=void 0!==E&&E.snippet.favorite,v=()=>{m(!u),g.oR.success("Successfully ".concat(u?"disabled":"enabled"," intellisense. ").concat(u?"Please refresh your browser for changes to take place.":""))},N=()=>c.addFavorite(t),x=()=>c.removeFavorite(t);return(0,a.jsxs)("div",{className:"inline-flex items-center justify-end gap-x-2","data-sentry-component":"UtilityActions","data-sentry-source-file":"UtilityActions.tsx",children:[w.pe&&(0,a.jsx)(e$,{id:t}),(0,a.jsxs)(Y.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(Y.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsx)(z.$,{type:"default",className:(0,G.cn)("px-1",d?"block 2xl:hidden":"hidden"),icon:(0,a.jsx)(eU.A,{className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,a.jsxs)(Y.SQ,{className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsxs)(Y._2,{className:"justify-between",onClick:v,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsxs)("span",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(eP,{size:14,className:"text-foreground-light","data-sentry-element":"Keyboard","data-sentry-source-file":"UtilityActions.tsx"}),"Intellisense enabled"]}),u&&(0,a.jsx)(eq.A,{className:"text-brand",size:16})]}),(0,a.jsx)(Y.mB,{"data-sentry-element":"DropdownMenuSeparator","data-sentry-source-file":"UtilityActions.tsx"}),(0,a.jsxs)(Y._2,{className:"gap-x-2",onClick:()=>{h?x():N()},"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(eW.A,{size:14,strokeWidth:2,className:h?"fill-brand stroke-none":"fill-none stroke-foreground-light","data-sentry-element":"Heart","data-sentry-source-file":"UtilityActions.tsx"}),h?"Remove from":"Add to"," favorites"]}),(0,a.jsxs)(Y._2,{className:"gap-x-2",onClick:l,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(eB.A,{size:14,strokeWidth:2,className:"text-foreground-light","data-sentry-element":"AlignLeft","data-sentry-source-file":"UtilityActions.tsx"}),"Prettify SQL"]})]})]}),(0,a.jsxs)("div",{className:(0,G.cn)("items-center gap-x-2",d?"hidden 2xl:flex":"flex"),children:[(0,a.jsxs)(Y.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(Y.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsx)(z.$,{type:"text",className:"px-1",icon:(0,a.jsx)(eP,{className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,a.jsx)(Y.SQ,{className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsxs)(Y._2,{className:"justify-between",onClick:v,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:["Intellisense enabled",u&&(0,a.jsx)(eq.A,{className:"text-brand",size:16})]})})]}),w.pe&&(0,a.jsxs)(K.m_,{children:[(0,a.jsx)(K.k$,{asChild:!0,children:h?(0,a.jsx)(z.$,{type:"text",size:"tiny",onClick:x,className:"px-1",icon:(0,a.jsx)(eW.A,{className:"fill-brand stroke-none"})}):(0,a.jsx)(z.$,{type:"text",size:"tiny",onClick:N,className:"px-1",icon:(0,a.jsx)(eW.A,{className:"fill-none stroke-foreground-light"})})}),(0,a.jsxs)(K.ZI,{side:"bottom",children:[h?"Remove from":"Add to"," favorites"]})]}),(0,a.jsxs)(K.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(K.k$,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsx)(z.$,{type:"text",onClick:l,className:"px-1",icon:(0,a.jsx)(eB.A,{strokeWidth:2,className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,a.jsx)(K.ZI,{side:"bottom","data-sentry-element":"TooltipContent","data-sentry-source-file":"UtilityActions.tsx",children:"Prettify SQL"})]})]}),(0,a.jsx)("div",{className:"flex items-center justify-between gap-x-2",children:(0,a.jsxs)("div",{className:"flex items-center",children:[w.pe&&(0,a.jsx)(eK.A,{selectedDatabaseId:0===p.length?void 0:p,variant:"connected-on-right",onSelectId:e=>{c.resetResult(t),_(e)}}),(0,a.jsx)(eG.g,{serviceRoleLabel:"postgres",variant:w.pe?"connected-on-both":"connected-on-right","data-sentry-element":"RoleImpersonationPopover","data-sentry-source-file":"UtilityActions.tsx"}),(0,a.jsx)(eY.C,{isDisabled:r||n,isExecuting:n,className:"rounded-l-none min-w-[82px]",onClick:i,"data-sentry-element":"SqlRunButton","data-sentry-source-file":"UtilityActions.tsx"})]})})]})};var eZ=n(66452),e0=n(25222),e1=n(2081),e2=n(59129),e3=n(19061),e4=n(41013);let e7=(0,s.forwardRef)(e=>{var t,n,r,s,l,i,o,c,d,u,p,_,E;let{id:h,isExecuting:g,isDisabled:v,isDebugging:N,onDebug:x}=e,{ref:b}=(0,f.g)(),y=(0,U.RE)(),I=(0,O.a)(),T=(0,q.aP)(),[,S]=(0,e0.ZA)("showConnect",e0.cr.withDefault(!1)),R=null==(t=T.results[h])?void 0:t[0],{data:C}=(0,A.j5)({orgSlug:null==I?void 0:I.slug}),L=(0,X.BP)(C),j=(null==R||null==(r=R.error)||null==(n=r.message)?void 0:n.includes("canceling statement due to statement timeout"))||(null==R||null==(l=R.error)||null==(s=l.message)?void 0:s.includes("upstream request timeout"))||(null==R||null==(o=R.error)||null==(i=o.message)?void 0:i.includes("Query read timeout")),w=null==R||null==(d=R.error)||null==(c=d.message)?void 0:c.includes("EHOSTUNREACH");if(g)return(0,a.jsxs)("div",{className:"flex items-center gap-x-4 px-6 py-4 bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:[(0,a.jsx)(m.A,{size:14,className:"animate-spin"}),(0,a.jsx)("p",{className:"m-0 border-0 font-mono text-sm",children:"Running..."})]});if(null==R?void 0:R.error){let e=(null!=(E=null==(p=R.error)||null==(u=p.formattedError)?void 0:u.split("\n"))?E:[]).filter(e=>e.length>0),t=y.selectedDatabaseId!==b&&R.error.message.includes("in a read-only transaction"),n=R.error.message.includes("Query is too large to be run via the SQL Editor");return(0,a.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex flex-row justify-between items-start py-4 px-6 gap-x-4",children:[j?(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,a.jsx)("p",{className:"font-mono text-sm tracking-tight",children:"Error: SQL query ran into an upstream timeout"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["You can either"," ",(0,a.jsx)(e2.g,{href:"https://supabase.com/docs/guides/platform/performance#examining-query-performance",children:"optimize your query"}),", or"," ",(0,a.jsx)(e2.g,{href:"https://supabase.com/docs/guides/database/timeouts",children:"increase the statement timeout"})," or ",(0,a.jsx)("span",{className:(0,G.cn)(e2.L,"cursor-pointer"),onClick:()=>S(!0),children:"connect to your database directly"}),"."]})]}):(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[e.length>0?e.map((e,t)=>(0,a.jsx)("pre",{className:"font-mono text-sm text-wrap",children:e},"error-".concat(t))):(0,a.jsxs)("p",{className:"font-mono text-sm tracking-tight",children:["Error: ",null==(_=R.error)?void 0:_.message]}),!j&&!w&&R.autoLimit&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Note: A limit of ",R.autoLimit,' was applied to your query. If this was the cause of a syntax error, try selecting "No limit" instead and re-run the query.']}),t&&(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Note: Read replicas are for read only queries. Run write queries on the primary database instead."}),n&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light flex items-center gap-x-1",children:["Run this query by"," ",(0,a.jsxs)("span",{onClick:()=>S(!0),className:(0,G.cn)(e2.L,"flex items-center gap-x-1"),children:["connecting to your database directly",(0,a.jsx)(eZ.A,{size:12})]}),"."]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[t&&(0,a.jsx)(z.$,{className:"py-2",type:"default",onClick:()=>{y.setSelectedDatabaseId(b),T.resetResult(h)},children:"Switch to primary database"}),e.length>0&&(0,a.jsxs)(K.m_,{children:[(0,a.jsx)(K.k$,{children:(0,a.jsx)(e1.A,{iconOnly:!0,type:"default",text:e.join("\n")})}),(0,a.jsx)(K.ZI,{side:"bottom",align:"center",children:(0,a.jsx)("span",{children:"Copy error"})})]}),!L&&(0,a.jsx)(z.$,{icon:(0,a.jsx)(e3.M,{className:"scale-75 w-3 h-3",loading:N}),disabled:!!v||N,onClick:x,children:"Debug with Supabase AI"})]})]})})}return R?R.rows.length<=0?(0,a.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,a.jsx)("p",{className:"m-0 border-0 px-6 py-4 font-mono text-sm",children:"Success. No rows returned"})}):(0,a.jsx)(e4.A,{rows:R.rows}):(0,a.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,a.jsxs)("p",{className:"m-0 border-0 px-4 py-4 text-sm text-foreground-light",children:["Click ",(0,a.jsx)("code",{children:"Run"})," to execute your query."]})})});e7.displayName="UtilityTabResults";let e6={type:"bar",cumulative:!1,xKey:"",yKey:"",showLabels:!1,showGrid:!1},e9=e=>{var t,n;let{id:r,isExecuting:s,isDebugging:l,isDisabled:i,hasSelection:o,prettifyQuery:c,executeQuery:d,onDebug:u}=e,{ref:m}=(0,f.g)(),p=(0,O.a)(),_=(0,q.aP)(),E=null==(t=_.snippets[r])?void 0:t.snippet,h=null==(n=_.results[r])?void 0:n[0],{mutate:v}=(0,R.h)(),{mutate:N}=(0,ev.v)({invalidateQueriesOnSuccess:!1,onMutate:async e=>{let{payload:t}=e;if("sql"!==t.type||!("chart"in t.content))return;let n={...E,content:{...E.content,chart:t.content.chart}};_.updateSnippet({id:r,snippet:n})},onError:async(e,t,n)=>{g.oR.error("Failed to update chart. Please try again.")}}),x=function(){var e;return E&&"sql"===E.type&&(null==(e=E.content)?void 0:e.chart)?E.content.chart:e6}();return(0,a.jsxs)(eN.tU,{defaultValue:"results",className:"w-full h-full flex flex-col","data-sentry-element":"Tabs_Shadcn_","data-sentry-component":"UtilityPanel","data-sentry-source-file":"UtilityPanel.tsx",children:[(0,a.jsxs)(eN.j7,{className:"flex justify-between gap-2 px-4 overflow-x-auto min-h-[42px]","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(eN.Xi,{className:"py-3 text-xs",value:"results","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)("span",{className:"translate-y-[1px]",children:"Results"})}),(0,a.jsx)(eN.Xi,{className:"py-3 text-xs",value:"chart","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)("span",{className:"translate-y-[1px]",children:"Chart"})}),(null==h?void 0:h.rows)&&(0,a.jsx)(ef.b,{type:"text",results:h.rows,fileName:"Supabase Snippet ".concat(E.name),onDownloadAsCSV:()=>{var e;return v({action:"sql_editor_result_download_csv_clicked",groups:{project:null!=m?m:"",organization:null!=(e=null==p?void 0:p.slug)?e:""}})},onCopyAsMarkdown:()=>{var e;v({action:"sql_editor_result_copy_markdown_clicked",groups:{project:null!=m?m:"",organization:null!=(e=null==p?void 0:p.slug)?e:""}})},onCopyAsJSON:()=>{var e;v({action:"sql_editor_result_copy_json_clicked",groups:{project:null!=m?m:"",organization:null!=(e=null==p?void 0:p.slug)?e:""}})}})]}),(0,a.jsx)(eJ,{id:r,isExecuting:s,isDisabled:i,hasSelection:o,prettifyQuery:c,executeQuery:d,"data-sentry-element":"UtilityActions","data-sentry-source-file":"UtilityPanel.tsx"})]}),(0,a.jsx)(eN.av,{asChild:!0,value:"results",className:"mt-0 flex-grow","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)(e7,{id:r,isExecuting:s,isDisabled:i,onDebug:u,isDebugging:l,"data-sentry-element":"UtilityTabResults","data-sentry-source-file":"UtilityPanel.tsx"})}),(0,a.jsx)(eN.av,{asChild:!0,value:"chart",className:"mt-0 flex-grow","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)(eM,{results:h,config:x,onConfigChange:function(e){m&&(null==E?void 0:E.id)&&N({projectRef:m,payload:{...E,id:E.id,description:E.description||"",project_id:E.project_id||0,content:{...E.content,content_id:r,chart:e}}})},"data-sentry-element":"ChartConfig","data-sentry-source-file":"UtilityPanel.tsx"})})]})},e5=h()(()=>n.e(6900).then(n.bind(n,56900)),{loadableGenerated:{webpack:()=>[56900]},ssr:!1}),e8=h()(()=>Promise.resolve().then(n.bind(n,14360)).then(e=>{let{DiffEditor:t}=e;return t}),{loadableGenerated:{webpack:()=>[14360]},ssr:!1}),te=()=>{var e,t,n;let l=(0,k.UX)(),E=(0,r.useRouter)(),{ref:h,id:$}=(0,f.g)(),{profile:J}=(0,F.xc)(),ea=(0,j.KT)(),er=(0,O.a)(),es=(0,o.jE)(),el=(0,W.IT)(h),ei=(0,Q.s)(el),eo=(0,M.xd)(),ec=(0,q.aP)(),ed=(0,P.Qj)(),eu=(0,U.RE)(),em=(0,C.g)(),[ep]=(0,L.P)(null==ea?void 0:ea.ref),e_=em||!w.pe,eE=(0,i.Uq)(),{sourceSqlDiff:eh,setSourceSqlDiff:ef,selectedDiffType:ev,setSelectedDiffType:eN,setIsAcceptDiffLoading:ex,isDiffOpen:eb,defaultSqlDiff:ey,closeDiff:eI}=(0,V.yh)(),{promptState:eT,setPromptState:eS,promptInput:eA,setPromptInput:eR,resetPrompt:eC}=(0,V.tB)(),eL=(0,s.useRef)(null),eO=(0,s.useRef)(null),ej=(0,s.useRef)(null),ew=(0,s.useRef)(0),[eD,ek]=(0,s.useState)(!1),[eF,eH]=(0,s.useState)([]),[eM,eU]=(0,s.useState)(!1),[eP,eq]=(0,s.useState)(!1),[eW,eB]=(0,s.useState)(!1),[eG,eK]=(0,s.useState)(!1),[eY,ez]=(0,s.useState)(!1),eQ=(0,s.useMemo)(()=>(0,k.gZ)(),[$]),eX=$&&"new"!==$?$:eQ,eV=ec.limit,e$=null==(e=ec.results[eX])?void 0:e[0],eJ=!(eX in ec.snippets&&void 0!==ec.snippets[eX].snippet.content),eZ="new"!==$&&eJ;eg(eX,eO.current);let{data:e0}=(0,A.j5)({orgSlug:null==er?void 0:er.slug}),e1=(0,X.BP)(e0),{data:e2,isSuccess:e3}=(0,T.Vh)({projectRef:h}),{data:e4,refetch:e7}=(0,b.nz)({schemas:ep,projectRef:null==ea?void 0:ea.ref,connectionString:null==ea?void 0:ea.connectionString},{enabled:e_}),e6=e_?null==e4?void 0:e4.map(e=>e.sql.trim()):void 0,{mutateAsync:te}=(0,x.G)(),{mutate:tt}=(0,R.h)(),{mutate:tn,isLoading:ta}=(0,S.Y)({onSuccess(e,t){eX&&ec.addResult(eX,e.result,t.autoLimit),e7(),es.invalidateQueries(I.O.lint(h))},onError(e,t){if(eX){if(e.position&&eO.current){var n,a,r;let t=eL.current,s=eO.current,l=eD&&null!=(a=null==t||null==(n=t.getSelection())?void 0:n.startLineNumber)?a:0,i=null!=(r=e.formattedError)?r:"",o=i.slice(i.indexOf("LINE")),c=l+Number(o.slice(0,o.indexOf(":")).split(" ")[1]);if(!isNaN(c)){let e=null==t?void 0:t.deltaDecorations([],[{range:new s.Range(c,1,c,20),options:{isWholeLine:!0,inlineClassName:"bg-warning-400"}}]);e&&(null==t||t.revealLineInCenter(c),eH(e))}}ec.addResultError(eX,e,t.autoLimit)}}}),tr=(0,s.useCallback)(async(e,t)=>{try{let{title:n}=await te({sql:t});if(ec.renameSnippet({id:e,name:n}),eE&&h){let t=(0,W.lW)("sql",{id:e});(0,W.Nt)(h,t,{label:n})}}catch(e){}},[te,ec]),ts=(0,s.useCallback)(async()=>{if(eb)return;let e=(0,q.Lv)().snippets[eX];if(eL.current&&ea){var t,n,a,r,s,l;let i=eL.current,o=i.getSelection(),c=o?null==(t=i.getModel())?void 0:t.getValueInRange(o):void 0,d=e?null!=(l=c||(null==(n=eL.current)?void 0:n.getValue()))?l:null==(a=e.snippet.content)?void 0:a.sql:c||(null==(r=eL.current)?void 0:r.getValue()),u=(0,D.A)(d),m=null==eL||null==(s=eL.current)?void 0:s.getModel();eL.current&&m&&(eL.current.executeEdits("apply-prettify-edit",[{text:u,range:m.getFullModelRange()}]),ec.setSql(eX,u))}},[eX,eb,ea,ec]),tl=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(eb)return;let t=(0,q.Lv)().snippets[eX];if(null!==eL.current&&!ta&&void 0!==ea){var n,a,r,s,l,i,o;let c=eL.current,d=c.getSelection(),u=d?null==(n=c.getModel())?void 0:n.getValueInRange(d):void 0,m=t?null!=(i=u||(null==(a=eL.current)?void 0:a.getValue()))?i:null==(r=t.snippet.content)?void 0:r.sql:u||(null==(s=eL.current)?void 0:s.getValue()),p=!1,_=(0,en.rs)(m);!e&&_&&(eq(!0),eB(!0),p=!0);let E=(0,en.j8)(m);if(!e&&E&&(eq(!0),eK(!0),p=!0),p)return;e1||(null==t?void 0:t.snippet.name)!==ee.tO||tr(eX,m),eF.length>0&&(null==c||c.deltaDecorations(eF,[]),eH([]));let f=ed(),v=null==e2||null==(l=e2.find(e=>e.identifier===eu.selectedDatabaseId))?void 0:l.connectionString;if(w.pe&&!v)return g.oR.error("Unable to run query: Connection string is missing");let{appendAutoLimit:N}=(0,en.iD)(m,eV),x=(0,en.dZ)(m,eV);tn({projectRef:ea.ref,connectionString:v,sql:(0,H.Nf)(x,f),autoLimit:N?eV:void 0,isRoleImpersonationEnabled:(0,P._c)(f.role),contextualInvalidation:!0,handleError:e=>{throw e}}),tt({action:"sql_editor_query_run_button_clicked",groups:{project:null!=h?h:"Unknown",organization:null!=(o=null==er?void 0:er.slug)?o:"Unknown"}})}},[eb,eX,ta,ea,e1,tn,ed,tr,eu.selectedDatabaseId,e2,eV]),ti=(0,s.useCallback)(async(e,t)=>{if(!h)return console.error("Project ref is required");if(!J)return console.error("Profile is required");if(!ea)return console.error("Project is required");try{let n=(0,en.fW)({id:(0,k.gZ)(),name:t,sql:e,owner_id:J.id,project_id:ea.id});ec.addSnippet({projectRef:h,snippet:n}),ec.addNeedsSaving(n.id),E.push("/project/".concat(h,"/sql/").concat(n.id))}catch(e){g.oR.error("Failed to create new query: ".concat(e.message))}},[null==J?void 0:J.id,null==ea?void 0:ea.id,h,E,ec]),to=(0,s.useCallback)(async()=>{try{var e,t,n;let a=ec.snippets[eX],r=null==(e=ec.results[eX])?void 0:e[0];eo.newChat({name:"Debug SQL snippet",open:!0,sqlSnippets:[(null!=(n=null==(t=a.snippet.content)?void 0:t.sql)?n:"").replace(ee.Fl,"").trim()],initialInput:"Help me to debug the attached sql snippet which gives the following error: \n\n".concat(r.error.message)})}catch(e){(function(e){return!!e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message})(e)&&g.oR.error("Sorry, the assistant failed to debug your query! Please try again with a different one.")}},[e6,eX,ec.results,ec.snippets]),tc=(0,s.useCallback)(async()=>{try{var e;if(ex(!0),!eh||!eL.current||!ej.current)return;let t=eL.current.getModel(),n=ej.current.getModel();if(!t||!n)return;let a=n.modified.getValue();if(ev===et.s.NewSnippet){let{title:e}=await te({sql:a});await ti(a,e)}else eL.current.executeEdits("apply-ai-edit",[{text:a,range:t.getFullModelRange()}]);tt({action:"assistant_sql_diff_handler_evaluated",properties:{handlerAccepted:!0},groups:{project:null!=h?h:"Unknown",organization:null!=(e=null==er?void 0:er.slug)?e:"Unknown"}}),eN(et.s.Modification),eC(),eI()}finally{ex(!1)}},[eh,ev,ti,te,E,eX,ec]),td=(0,s.useCallback)(()=>{var e;tt({action:"assistant_sql_diff_handler_evaluated",properties:{handlerAccepted:!1},groups:{project:null!=h?h:"Unknown",organization:null!=(e=null==er?void 0:er.slug)?e:"Unknown"}}),eC(),eI()},[eI,eC,tt]),{complete:tu,completion:tm,isLoading:tp}=(0,c.sQ)({api:"".concat(w.o2,"/api/ai/sql/complete"),body:{projectRef:null==ea?void 0:ea.ref,connectionString:null==ea?void 0:ea.connectionString,includeSchemaMetadata:e_},onResponse:e=>{if(!e.ok)throw Error("Failed to generate completion")},onError:e=>{g.oR.error("Failed to generate SQL: ".concat(e.message))}}),t_=async(e,t)=>{try{var n;eS(e=>({...e,selection:t.selection,beforeSelection:t.beforeSelection,afterSelection:t.afterSelection}));let a=await (0,y.We)();await tu(e,{headers:{Authorization:null!=(n=a.get("Authorization"))?n:""},body:{completionMetadata:{textBeforeCursor:t.beforeSelection,textAfterCursor:t.afterSelection,language:"pgsql",prompt:e,selection:t.selection}}})}catch(e){eS(e=>({...e,isLoading:!1}))}};return(0,s.useEffect)(()=>(eX&&(eI(),eS(e=>({...e,isOpen:!1}))),()=>{if(h){let e=(0,W.lW)("sql",{id:eX});(0,W.Nt)(h,e,{scrollTop:ew.current})}}),[eI,eX]),(0,s.useEffect)(()=>{let e=e=>{if(eb||eT.isOpen)switch(e.key){case"Enter":("macos"===l?e.metaKey:e.ctrlKey)&&eb&&(tc(),eC());return;case"Escape":var t;eb&&td(),eC(),null==(t=eL.current)||t.focus();return}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l,eb,eT.isOpen,tc,td,eC]),(0,s.useEffect)(()=>{if(eb){let e=ej.current,t=null==e?void 0:e.getModel();if(t&&t.original&&t.modified){t.original.setValue(ey.original),t.modified.setValue(ey.modified);let n=e.getModifiedEditor(),a=eT.startLineNumber;n.revealLineInCenter(a)}}},[ev,eh]),(0,s.useEffect)(()=>{if(e3){let e=e2.find(e=>e.identifier===h);eu.setSelectedDatabaseId(null==e?void 0:e.identifier)}},[e3,e2,h]),(0,s.useEffect)(()=>{if(void 0!==ec.diffContent){var e,t,n,a,r;let{diffType:s,sql:l}=ec.diffContent,i=null==(e=eL.current)?void 0:e.getModel();i&&(0===(null!=(n=null==(t=eL.current)?void 0:t.getValue())?n:"").length?null==(a=eL.current)||a.executeEdits("apply-ai-message",[{text:"".concat(l),range:i.getFullModelRange()}]):(ef({original:(null==(r=eL.current)?void 0:r.getValue())||"",modified:l}),eN(s)))}},[ec.diffContent]),(0,s.useEffect)(()=>{if(!tm)return;let e=eT.beforeSelection+eT.selection+eT.afterSelection,t=eT.beforeSelection+tm+eT.afterSelection;tp&&(ef({original:e,modified:(0,D.A)(t)}),eN(et.s.Modification),eS(e=>({...e,isLoading:!1})))},[tm,eT.beforeSelection,eT.selection,eT.afterSelection,tp]),(0,s.useEffect)(()=>{if(eb){if(ej.current&&eM)return ez(!0),()=>ez(!1)}else eU(!1),ez(!1)},[eb,eM]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z,{visible:eP,hasDestructiveOperations:eW,hasUpdateWithoutWhere:eG,onCancel:()=>{eq(!1),eB(!1),eK(!1),setTimeout(()=>{var e;return null==(e=eL.current)?void 0:e.focus()},100)},onConfirm:()=>{eq(!1),tl(!0)},"data-sentry-element":"RunQueryWarningModal","data-sentry-source-file":"SQLEditor.tsx"}),(0,a.jsx)("div",{className:"flex h-full",children:(0,a.jsxs)(B.HK,{className:"relative",direction:"vertical",autoSaveId:w.rS.SQL_EDITOR_SPLIT_SIZE,"data-sentry-element":"ResizablePanelGroup","data-sentry-source-file":"SQLEditor.tsx",children:[(0,a.jsx)(B.wV,{maxSize:70,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:(0,a.jsx)("div",{className:"flex-grow overflow-y-auto border-b h-full",children:eZ?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(m.A,{className:"animate-spin text-brand"})}):(0,a.jsxs)(a.Fragment,{children:[eb&&(0,a.jsxs)("div",{className:"w-full h-full",children:[(0,a.jsx)(e8,{theme:"supabase",language:"pgsql",original:ey.original,modified:ey.modified,onMount:e=>{ej.current=e,eU(!0)},options:{fontSize:13,renderSideBySide:!1,minimap:{enabled:!1},wordWrap:"on",lineNumbers:"on",folding:!1,padding:{top:4},lineNumbersMinChars:3}}),eY&&(0,a.jsx)(v.A,{editor:ej.current,id:"ask-ai-diff",value:eA,onChange:eR,onSubmit:e=>{t_(e,{beforeSelection:eT.beforeSelection,selection:eT.selection||ey.modified,afterSelection:eT.afterSelection})},onAccept:tc,onReject:td,onCancel:eC,isDiffVisible:!0,isLoading:tp,startLineNumber:Math.max(0,eT.startLineNumber),endLineNumber:eT.endLineNumber})]}),(0,a.jsxs)("div",{className:"w-full h-full relative",children:[(0,a.jsx)(e5,{autoFocus:!0,id:eX,className:(0,G.cn)(eb&&"hidden"),editorRef:eL,monacoRef:eO,executeQuery:tl,onHasSelection:ek,onMount:e=>{let t=(0,W.lW)("sql",{id:eX}),n=ei.tabsMap[t];setTimeout(()=>{var t;(null==n||null==(t=n.metadata)?void 0:t.scrollTop)&&e.setScrollTop(n.metadata.scrollTop)},20),e.onDidScrollChange(e=>ew.current=e.scrollTop)},onPrompt:e=>{let{selection:t,beforeSelection:n,afterSelection:a,startLineNumber:r,endLineNumber:s}=e;eS(e=>({...e,isOpen:!0,selection:t,beforeSelection:n,afterSelection:a,startLineNumber:r,endLineNumber:s}))}}),eL.current&&eT.isOpen&&!eb&&(0,a.jsx)(v.A,{editor:eL.current,id:"ask-ai",value:eA,onChange:eR,onSubmit:e=>{t_(e,{beforeSelection:eT.beforeSelection,selection:eT.selection,afterSelection:eT.afterSelection})},onCancel:eC,isDiffVisible:!1,isLoading:tp,startLineNumber:Math.max(0,eT.startLineNumber),endLineNumber:eT.endLineNumber}),(0,a.jsx)(d.N,{children:!eT.isOpen&&!(null==(t=eL.current)?void 0:t.getValue())&&(0,a.jsxs)(u.P.p,{initial:{y:5,opacity:0},animate:{y:0,opacity:1},exit:{y:5,opacity:0},className:"text-foreground-lighter absolute bottom-4 left-4 z-10 font-mono text-xs flex items-center gap-1",children:["Hit ","macos"===l?(0,a.jsx)(p.A,{size:12}):"CTRL+","K to edit with the Assistant"]})})]},eX)]})})}),(0,a.jsx)(B.WM,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"SQLEditor.tsx"}),(0,a.jsx)(B.wV,{maxSize:70,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:eZ?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(m.A,{className:"animate-spin text-brand"})}):(0,a.jsx)(e9,{id:eX,isExecuting:ta,isDisabled:eb,hasSelection:eD,prettifyQuery:ts,executeQuery:tl,onDebug:to})}),(0,a.jsx)("div",{className:"max-h-9",children:(null==e$?void 0:e$.rows)!==void 0&&!ta&&(0,a.jsxs)(N.C,{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)(K.m_,{children:[(0,a.jsx)(K.k$,{children:(0,a.jsxs)("p",{className:"text-xs",children:[(0,a.jsxs)("span",{className:"text-foreground",children:[e$.rows.length," row",e$.rows.length>1?"s":""]}),(0,a.jsx)("span",{className:"text-foreground-lighter ml-1",children:void 0!==e$.autoLimit&&" (Limited to only ".concat(e$.autoLimit," rows)")})]})}),(0,a.jsx)(K.ZI,{className:"max-w-xs",children:(0,a.jsxs)("p",{className:"flex flex-col gap-y-1",children:[(0,a.jsx)("span",{children:"Results are automatically limited to preserve browser performance, in particular if your query returns an exceptionally large number of rows."}),(0,a.jsx)("span",{className:"text-foreground-light",children:"You may change or remove this limit from the dropdown on the right"})]})})]}),void 0!==e$.autoLimit&&(0,a.jsxs)(Y.rI,{children:[(0,a.jsx)(Y.ty,{asChild:!0,children:(0,a.jsxs)(z.$,{type:"default",iconRight:(0,a.jsx)(_.A,{size:14}),children:["Limit results to:"," ",null==(n=ee.Lo.find(e=>e.value===ec.limit))?void 0:n.label]})}),(0,a.jsx)(Y.SQ,{className:"w-40",align:"end",children:(0,a.jsx)(Y.Hr,{value:ec.limit.toString(),onValueChange:e=>ec.setLimit(Number(e)),children:ee.Lo.map(e=>(0,a.jsx)(Y.Ht,{value:e.value.toString(),children:e.label},e.label))})})]})]})})]})})]})};var tt=n(67397),tn=n(10670),ta=n(91284),tr=n(58149),ts=n(46312),tl=n(10170);let ti=()=>{let e=(0,r.useRouter)(),{id:t,ref:n,content:o,skip:c}=(0,l.g)(),d=(0,tl.qM)(),u=(0,q.aP)(),m=(0,q.wU)(n),{data:p}=(0,ts.K)({projectRef:n,id:t},{retry:!1,enabled:"new"!==t&&"function"==typeof u.addSnippet});(0,s.useEffect)(()=>{n&&p&&u.setSnippet(n,p)},[n,p]),(0,s.useEffect)(()=>{"new"===t&&"true"!==c&&void 0!==d.dashboardHistory.sql&&void 0===o&&void 0!==m.find(e=>e.id===d.dashboardHistory.sql)&&e.push("/project/".concat(n,"/sql/").concat(d.dashboardHistory.sql))},[t,m,o]);let _=(0,i.Uq)();return(0,s.useEffect)(()=>{if(_){if(!e.isReady||!t||"new"===t)return;let a=(0,W.lW)("sql",{id:t}),r=m.find(e=>e.id===t);(0,W.Hm)(n,{id:a,type:"sql",label:(null==r?void 0:r.name)||"Untitled Query",metadata:{sqlId:t,name:null==r?void 0:r.name}})}},[e.isReady,t,_]),(0,a.jsx)(te,{"data-sentry-element":"SQLEditor","data-sentry-component":"SqlEditor","data-sentry-source-file":"[id].tsx"})};ti.getLayout=e=>(0,a.jsx)(tt.A,{children:(0,a.jsx)(tn.$,{productMenu:(0,a.jsx)(tr.Z,{}),product:"SQL Editor",children:(0,a.jsx)(ta.A,{children:e})})});let to=ti},71391:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(47370).A)("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]])},78294:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(47370).A)("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]])},81028:(e,t,n)=>{"use strict";n.d(t,{m:()=>s});var a=n(92589),r=n(53239);let s=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r.useMemo)(()=>{var e;let[n,r]=t;if(!(null==(e=n[0])?void 0:e[r]))return{data:n,error:void 0,isError:!1};try{return{data:(0,a.mu)(...t).sort((e,n)=>new Date(e[t[1]])-new Date(n[t[1]])),error:void 0,isError:!1}}catch(e){return{data:[],error:e,isError:!0}}},[JSON.stringify(t[0]),...t])}},83455:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var a=n(80263),r=n(3732),s=n(16601),l=n(90235),i=n(2743),o=n(37427);let c=e=>{let{format:t,highlightedValue:n,highlightedLabel:c,title:d,minimalHeader:u=!1,hideChartType:m=!1,chartStyle:p="bar",onChartStyleChange:_,showMaxValue:E=!1,setShowMaxValue:h}=e,g=(0,a.jsx)("h3",{className:"text-foreground-lighter "+(u?"text-xs":"text-sm"),children:d}),f=(0,a.jsxs)("h4",{className:"text-foreground text-xl font-normal ".concat(u?"text-base":"text-2xl"),children:[void 0!==n&&n,"seconds"===t?" ":"",(0,a.jsx)("span",{className:"text-lg",children:"function"==typeof t?t(n):t})]}),v=(0,a.jsx)("h4",{className:"text-foreground-lighter text-xs",children:c});return u?(0,a.jsxs)("div",{className:"flex flex-row items-center gap-x-4",style:{minHeight:"1.8rem"},children:[d&&g,(0,a.jsxs)("div",{className:"flex flex-row items-baseline gap-x-2",children:[void 0!==n&&f,v]})]}):(0,a.jsxs)("div",{className:"flex-grow flex justify-between items-start min-h-16","data-sentry-component":"ChartHeader","data-sentry-source-file":"ChartHeader.tsx",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[d&&g,void 0!==n&&f,v]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[!m&&_&&(0,a.jsxs)(r.m_,{children:[(0,a.jsx)(r.k$,{asChild:!0,children:(0,a.jsx)(s.$,{type:"default",className:"px-1.5",icon:"bar"===p?(0,a.jsx)(l.A,{}):(0,a.jsx)(i.A,{}),onClick:()=>_("bar"===p?"line":"bar")})}),(0,a.jsxs)(r.ZI,{side:"left",align:"center",children:["View as ","bar"===p?"line chart":"bar chart"]})]}),h&&(0,a.jsxs)(r.m_,{children:[(0,a.jsx)(r.k$,{asChild:!0,children:(0,a.jsx)(s.$,{type:E?"default":"dashed",className:"px-1.5",icon:(0,a.jsx)(o.A,{className:E?"text-foreground":"text-foreground-lighter"}),onClick:()=>h(!E)})}),(0,a.jsxs)(r.ZI,{side:"left",align:"center",children:[E?"Hide":"Show"," limit"]})]})]})]})}},84430:(e,t,n)=>{"use strict";n.d(t,{BY:()=>h,Eg:()=>u,XO:()=>p,bk:()=>_,dQ:()=>E});var a=n(80263),r=n(53434),s=n.n(r),l=n(37361),i=n.n(l),o=n(53239),c=n(62099),d=n(9603);s().extend(i());let u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return m(e)?p(e,t):e.toLocaleString()},m=e=>String(e).includes("."),p=(e,t)=>{if(!m(e))return e.toLocaleString()+"."+"0".repeat(t);{let[n,a]=String(e).split(".");return Number(n).toLocaleString()+"."+a.slice(0,t)}},_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.C_.FULL,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?s().utc(e).format(t):s()(e).format(t)},E=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{tiny:76,small:96,normal:160,large:280},n=t[e];return{Container:(0,o.useMemo)(()=>e=>{let{className:t,children:r}=e;return(0,a.jsx)(c.u,{className:t,height:n,minHeight:n,width:"100%",children:r})},[e]),minHeight:n}},h=e=>{let{data:t,xAxisKey:n,yAxisKey:a,stackKey:r,variant:s="values"}=e,l=(0,o.useMemo)(()=>t?Object.entries(t.reduce((e,t)=>{let s=t[n],l=t[a],i=t[r];return e[s]||(e[s]={}),e[s][i]=l,e},{})).map(e=>{let[t,a]=e;return{...a,[n]:Number.isNaN(Number(t))?t:Number(t)}}):[],[JSON.stringify(t)]),i=(0,o.useMemo)(()=>Object.keys(l[0]||{}).filter(e=>e!==n&&e!==a).sort(),[JSON.stringify(l[0]||{})]),c=(0,o.useMemo)(()=>{if("percentages"===s)return l.map(e=>{let t=Object.entries(e),n=t.filter(e=>{let[t,n]=e;return i.includes(t)}).reduce((e,t)=>{let[n,a]=t;return e+a},0);return t.reduce((e,t)=>{let[a,r]=t;return i.includes(a)?{...e,[a]:0!==r?r/n:0}:{...e,[a]:r}},{})})},[JSON.stringify(l)]);return{dataKeys:i,stackedData:l,percentagesStackedData:c}}},87598:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(47370).A)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},90720:(e,t,n)=>{"use strict";n.d(t,{b:()=>g});var a=n(80263),r=n(95137),s=n.n(r),l=n(10822),i=n(68656),o=n(81372),c=n(77406),d=n(77191),u=n.n(d),m=n(53239),p=n(73969),_=n(90206),E=n(33656),h=n(16601);let g=e=>{let{iconOnly:t=!1,type:n="default",text:r="Export",align:d="start",results:g,fileName:f,onDownloadAsCSV:v,onCopyAsMarkdown:N,onCopyAsJSON:x}=e,b=g.map(e=>{let t={...e};return Object.keys(e).forEach(n=>{"object"==typeof e[n]&&(t[n]=JSON.stringify(e[n]))}),t}),y=(0,m.useMemo)(()=>{if(g){let e=Array.from(g)[0];if(e)return Object.keys(e)}},[g]),I=()=>{let e=new Blob([u().unparse(b,{columns:y})],{type:"text/csv;charset=utf-8;"});s()(e,"".concat(f,".csv")),p.oR.success("Downloading results as CSV"),null==v||v()};return(0,a.jsxs)(E.rI,{"data-sentry-element":"DropdownMenu","data-sentry-component":"DownloadResultsButton","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(E.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"DownloadResultsButton.tsx",children:(0,a.jsx)(h.$,{type:n,icon:t?(0,a.jsx)(l.A,{}):void 0,iconRight:t?void 0:(0,a.jsx)(i.A,{}),disabled:0===g.length,className:t?"w-7":"","data-sentry-element":"Button","data-sentry-source-file":"DownloadResultsButton.tsx",children:!t&&r})}),(0,a.jsxs)(E.SQ,{align:d,className:"w-44","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsxs)(E._2,{className:"gap-x-2",onClick:()=>I(),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(l.A,{size:14,"data-sentry-element":"Download","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Download CSV"})]}),(0,a.jsxs)(E._2,{onClick:()=>{if(navigator){0==b.length&&(0,p.oR)("Results are empty");let e=Object.keys(b[0]),t=b.map(t=>{let n=[];return e.forEach(e=>n.push(t[e])),n}),n=[e].concat(t),a=(0,c.Q)(n);(0,_.lW)(a,()=>{p.oR.success("Copied results to clipboard"),null==N||N()})}},className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(o.A,{size:14,"data-sentry-element":"Clipboard","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Copy as markdown"})]}),(0,a.jsxs)(E._2,{onClick:()=>{if(navigator){if(0===g.length)return(0,p.oR)("Results are empty");(0,_.lW)(JSON.stringify(g,null,2),()=>{p.oR.success("Copied results to clipboard"),null==x||x()})}},className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(o.A,{size:14,"data-sentry-element":"Clipboard","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Copy as JSON"})]})]})]})}},90799:(e,t,n)=>{"use strict";n.d(t,{HJ:()=>o});var a=n(56947),r=n(77570),s=n(68324);let l=e=>{let{table:t,schema:n}=e,a=[];t&&a.push("tablename = '".concat(t,"'")),n&&a.push("schemaname = '".concat(n,"'"));let r=a.length>0?"WHERE ".concat(a.join(" AND ")):"";return"\n  \n  SELECT\n    tbl.schemaname,\n    tbl.tablename,\n    tbl.quoted_name,\n    tbl.is_table,\n    json_agg(a) as columns\n  FROM\n    (\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        true as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind = 'r'\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n      union all\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        false as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind in ('v', 'm')\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n    ) as tbl\n    LEFT JOIN (\n      SELECT\n        attrelid,\n        attname,\n        format_type(atttypid, atttypmod) as data_type,\n        attnum,\n        attisdropped\n      FROM\n        pg_attribute\n    ) as a ON (\n      a.attrelid = tbl.quoted_name::regclass\n      AND a.attnum > 0\n      AND NOT a.attisdropped\n      AND has_column_privilege(tbl.quoted_name, a.attname, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n  ".concat(r,"\n  GROUP BY schemaname, tablename, quoted_name, is_table;\n").trim()};async function i(e,t){let{projectRef:n,connectionString:a,table:s,schema:i}=e,o=l({table:s,schema:i}),{result:c}=await (0,r.E)({projectRef:n,connectionString:a,sql:o,queryKey:["table-columns",i,s]},t);return c}let o=function(e){let{projectRef:t,connectionString:n,schema:r,table:l}=e,{enabled:o=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)(s.c.tableColumns(t,r,l),e=>{let{signal:a}=e;return i({projectRef:t,connectionString:n,schema:r,table:l},a)},{enabled:o&&void 0!==t,...c})}}},e=>{var t=t=>e(e.s=t);e.O(0,[89,9413,6110,3342,4376,2180,7990,8058,5513,5944,4346,2981,6835,7762,9067,2809,6692,6616,5927,6404,9016,2722,7397,886,1152,8601,8554,3131,9440,1469,6593,636,8792],()=>t(11426)),_N_E=e.O()}]);